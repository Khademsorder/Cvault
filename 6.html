<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Drive Master Pro - Hybrid Edition</title>
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons+Round" rel="stylesheet">
    <style>
        :root { --primary: #1a73e8; --vault: #6200ee; --bg: #f8f9fa; }
        body { font-family: 'Google Sans', Arial, sans-serif; background: var(--bg); margin: 0; padding: 20px; }
        .app-container { max-width: 1000px; margin: auto; background: white; border-radius: 12px; box-shadow: 0 4px 20px rgba(0,0,0,0.08); overflow: hidden; }
        .header { background: white; padding: 20px; border-bottom: 1px solid #eee; display: flex; justify-content: space-between; align-items: center; }
        .drive-selector { display: flex; gap: 10px; padding: 15px; background: #f1f3f4; }
        
        button { border: none; padding: 10px 20px; border-radius: 20px; cursor: pointer; font-weight: 500; display: flex; align-items: center; gap: 8px; transition: 0.3s; }
        .btn-vault { background: var(--vault); color: white; }
        .btn-user { background: var(--primary); color: white; }
        button:hover { opacity: 0.8; transform: translateY(-1px); }
        
        .file-list { padding: 10px; min-height: 400px; }
        .file-card { display: flex; align-items: center; padding: 12px; border-bottom: 1px solid #f1f1f1; transition: 0.2s; }
        .file-card:hover { background: #f8f9fa; }
        .file-icon { color: #5f6368; margin-right: 15px; }
        .file-info { flex-grow: 1; }
        .file-name { font-weight: 500; color: #3c4043; display: block; }
        .file-meta { font-size: 12px; color: #70757a; }
        
        .btn-transfer { background: #e8f0fe; color: var(--primary); font-size: 13px; padding: 6px 15px; }
        .btn-transfer:hover { background: var(--primary); color: white; }
        
        #loader { display: none; text-align: center; padding: 20px; color: var(--primary); }
        .status-bar { padding: 10px 20px; font-size: 13px; background: #323232; color: white; position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%); border-radius: 5px; display: none; }
    </style>
</head>
<body>

<div class="app-container">
    <div class="header">
        <h2 style="margin:0; display:flex; align-items:center; gap:10px;">
            <span class="material-icons-round" style="color:var(--primary)">cloud_sync</span>
            Drive Master Hybrid
        </h2>
    </div>

    <div class="drive-selector">
        <button class="btn-vault" onclick="loadFiles('vault')">
            <span class="material-icons-round">admin_panel_settings</span> Admin Vault
        </button>
        <button class="btn-user" onclick="loadFiles('user')">
            <span class="material-icons-round">person</span> My Drive (Root)
        </button>
    </div>

    <div id="loader">Loading files...</div>
    <div id="file-list" class="file-list">
        <div style="text-align:center; color:#70757a; margin-top:100px;">
            <p>Select a drive to view and transfer files.</p>
        </div>
    </div>
</div>

<div id="status" class="status-bar"></div>

<script>
    const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbwTjly23ZDq_fF0LqD47qQdzLyT6Be_eJbCue8G2usqAnM3sLUkiQEPYSRRCDEOQReK0A/exec";
    const API_KEY = "AIzaSyDa9xQWqxE71j3ZaI7NI_0hGztmLcx4USo";
    let currentDrive = '';

    function showStatus(msg, duration = 3000) {
        const s = document.getElementById('status');
        s.innerText = msg;
        s.style.display = 'block';
        setTimeout(() => s.style.display = 'none', duration);
    }

    async function loadFiles(drive) {
        currentDrive = drive;
        const listDiv = document.getElementById('file-list');
        const loader = document.getElementById('loader');
        
        listDiv.innerHTML = '';
        loader.style.display = 'block';

        try {
            const res = await fetch(`${SCRIPT_URL}?action=files_list&drive=${drive}&apiKey=${API_KEY}`);
            const data = await res.json();

            if (data.success) {
                renderFiles(data.files);
                showStatus(`${drive.toUpperCase()} files loaded.`);
            } else {
                listDiv.innerHTML = `<p style="color:red; text-align:center;">Error: ${data.error}</p>`;
            }
        } catch (err) {
            console.error(err);
            showStatus("Failed to connect to script.", 5000);
        } finally {
            loader.style.display = 'none';
        }
    }

    function renderFiles(files) {
        const listDiv = document.getElementById('file-list');
        if (files.length === 0) {
            listDiv.innerHTML = '<p style="text-align:center;">No files found.</p>';
            return;
        }

        files.forEach(file => {
            const isFolder = file.mimeType === 'application/vnd.google-apps.folder';
            const icon = isFolder ? 'folder' : 'insert_drive_file';
            const transferLabel = currentDrive === 'vault' ? 'Copy to My Drive' : 'Copy to Vault';
            
            const card = document.createElement('div');
            card.className = 'file-card';
            card.innerHTML = `
                <span class="material-icons-round file-icon">${icon}</span>
                <div class="file-info">
                    <span class="file-name">${file.name}</span>
                    <span class="file-meta">ID: ${file.id}</span>
                </div>
                ${!isFolder ? `
                    <button class="btn-transfer" onclick="transferFile('${file.id}', '${file.name}')">
                        <span class="material-icons-round" style="font-size:16px">sync</span> ${transferLabel}
                    </button>
                ` : ''}
            `;
            listDiv.appendChild(card);
        });
    }

    async function transferFile(id, name) {
        showStatus(`Transferring: ${name}...`);
        
        try {
            const res = await fetch(`${SCRIPT_URL}?action=file_copy&drive=${currentDrive}&fileId=${id}&apiKey=${API_KEY}`);
            const data = await res.json();

            if (data.success) {
                alert(`Successfully copied "${name}" to ${currentDrive === 'vault' ? 'User Root' : 'Vault'}`);
                showStatus("Transfer Complete!");
            } else {
                alert("Transfer Failed: " + data.error);
            }
        } catch (err) {
            alert("Error: " + err.message);
        }
    }
</script>

</body>
</html>

<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Vault OS - Light Theme Build</title>
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
    
    <!-- Google Identity Services (OAuth) -->
    <script src="https://accounts.google.com/gsi/client" async defer></script>
    
    <!-- Google Picker API -->
    <script src="https://apis.google.com/js/api.js"></script>

    <style>
        :root {
            /* --- LIGHT THEME VARIABLES --- */
            --bg-color: #f0f2f5;
            --surface-color: #ffffff;
            --primary-color: #00897b; /* Teal Green */
            --text-color: #333333;
            --text-secondary: #757575;
            --danger-color: #d32f2f;
            --border-color: #e0e0e0;
            --nav-height: 60px;
            --shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Segoe UI', Roboto, sans-serif; -webkit-tap-highlight-color: transparent; }
        
        body {
            background-color: var(--bg-color);
            color: var(--text-color);
            height: 100vh;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }

        /* --- Utility Classes --- */
        .hidden { display: none !important; }
        .flex { display: flex; }
        .flex-col { flex-direction: column; }
        .center { align-items: center; justify-content: center; }
        .w-full { width: 100%; }
        .text-center { text-align: center; }
        .text-sm { font-size: 0.85rem; color: var(--text-secondary); }
        .mt-2 { margin-top: 1rem; }

        /* --- Buttons --- */
        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            transition: opacity 0.2s, transform 0.1s;
            box-shadow: var(--shadow);
        }
        .btn:active { transform: scale(0.98); opacity: 0.8; }
        .btn-primary { background-color: var(--primary-color); color: #fff; }
        .btn-outline { border: 1px solid var(--border-color); background: var(--surface-color); color: var(--text-color); }

        /* --- Screens --- */
        .screen {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            background: var(--bg-color);
            z-index: 10;
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease;
        }

        /* 1. PIN Screen */
        #pin-screen { z-index: 100; background-color: var(--surface-color); }
        .pin-display {
            font-size: 2.5rem;
            letter-spacing: 12px;
            margin: 30px 0;
            height: 50px;
            color: var(--text-color);
            border-bottom: 2px solid var(--border-color);
            width: 200px;
            text-align: center;
        }
        .numpad { display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px; max-width: 320px; margin: 0 auto; width: 100%; padding: 0 20px;}
        
        /* Fix: Ensuring buttons are clickable on mobile */
        .num-btn {
            background: var(--bg-color);
            color: var(--text-color);
            font-size: 1.8rem;
            padding: 20px;
            border-radius: 12px;
            border: 1px solid var(--border-color);
            box-shadow: var(--shadow);
            cursor: pointer;
            user-select: none;
            position: relative;
            z-index: 102; /* Higher z-index */
        }
        .num-btn:active { background: #e0e0e0; transform: scale(0.95); }

        /* 2. Login Screen */
        #login-screen { z-index: 90; background-color: var(--bg-color); }
        .login-card {
            background: var(--surface-color);
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            width: 90%;
            max-width: 400px;
            text-align: center;
        }

        /* 3. Main App Interface */
        #main-app { z-index: 80; padding-bottom: var(--nav-height); }
        
        header {
            padding: 15px;
            background: var(--surface-color);
            border-bottom: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }

        .drive-switch {
            background: var(--bg-color);
            border-radius: 25px;
            padding: 4px;
            display: flex;
            border: 1px solid var(--border-color);
        }
        .switch-opt {
            padding: 6px 18px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 0.85rem;
            font-weight: 500;
            color: var(--text-secondary);
            transition: all 0.3s;
        }
        .switch-opt.active { background: var(--surface-color); color: var(--primary-color); box-shadow: 0 1px 3px rgba(0,0,0,0.1); }

        .file-list { flex: 1; overflow-y: auto; padding: 10px; }
        
        .file-item {
            display: flex;
            align-items: center;
            padding: 15px;
            background: var(--surface-color);
            border-radius: 8px;
            margin-bottom: 10px;
            box-shadow: 0 1px 2px rgba(0,0,0,0.05);
            cursor: pointer;
            border: 1px solid transparent;
        }
        .file-item:active { background-color: #f5f5f5; border-color: var(--primary-color); }
        .file-icon { width: 45px; height: 45px; margin-right: 15px; display: flex; align-items: center; justify-content: center; background: #f0f0f0; border-radius: 8px; font-size: 1.4rem; }
        .file-info { flex: 1; }
        .file-name { font-weight: 600; margin-bottom: 4px; color: #2c3e50; }
        .file-meta { font-size: 0.75rem; color: var(--text-secondary); }

        /* Bottom Nav */
        .bottom-nav {
            position: fixed;
            bottom: 0; left: 0; width: 100%;
            height: var(--nav-height);
            background: var(--surface-color);
            display: flex;
            justify-content: space-around;
            align-items: center;
            border-top: 1px solid var(--border-color);
            z-index: 200;
            box-shadow: 0 -2px 10px rgba(0,0,0,0.05);
        }
        .nav-item { font-size: 0.7rem; display: flex; flex-direction: column; align-items: center; color: var(--text-secondary); cursor: pointer; width: 100%; padding: 5px 0;}
        .nav-item.active { color: var(--primary-color); }
        .nav-icon { font-size: 1.4rem; margin-bottom: 3px; }

        /* 4. Debug/Bug Console */
        #debug-drawer {
            position: fixed;
            top: 0; right: -400px;
            width: 350px;
            height: 100%;
            background: #1e1e1e; /* Debug console stays dark for contrast */
            z-index: 300;
            border-left: 1px solid #333;
            transition: right 0.3s;
            display: flex;
            flex-direction: column;
            font-family: 'Courier New', monospace;
            color: #ccc;
        }
        #debug-drawer.open { right: 0; }
        .debug-header { padding: 10px; background: #252525; border-bottom: 1px solid #444; display: flex; justify-content: space-between; align-items: center; }
        .debug-content { flex: 1; overflow-y: auto; padding: 10px; font-size: 0.8rem; }
        .log-entry { margin-bottom: 5px; border-bottom: 1px solid #333; padding-bottom: 2px; word-wrap: break-word; }
        .log-time { color: #888; margin-right: 5px; }
        .log-info { color: #4caf50; }
        .log-error { color: #ff5252; }
        .log-warn { color: #ffab40; }

        /* Toast Notification */
        #toast-container {
            position: fixed;
            bottom: 80px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 500;
            width: 90%;
            max-width: 400px;
            pointer-events: none;
        }
        .toast {
            background: rgba(40, 40, 40, 0.95);
            color: #fff;
            padding: 12px 20px;
            border-radius: 8px;
            margin-top: 10px;
            text-align: center;
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
            animation: fadeIn 0.3s, fadeOut 0.3s 2.7s forwards;
            border-left: 4px solid var(--primary-color);
        }
        .toast.error { border-left-color: var(--danger-color); }

        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes fadeOut { from { opacity: 1; } to { opacity: 0; } }

        /* Loader */
        .loader { border: 3px solid #f3f3f3; border-top: 3px solid var(--primary-color); border-radius: 50%; width: 24px; height: 24px; animation: spin 1s linear infinite; margin: 0 auto; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

    </style>
</head>
<body>

    <!-- --- TOAST CONTAINER --- -->
    <div id="toast-container"></div>

    <!-- --- 1. PIN SCREEN --- -->
    <section id="pin-screen" class="screen center">
        <div style="text-align: center; width: 100%;">
            <h2 style="color: var(--text-color);">VAULT OS</h2>
            <p class="text-sm">Enter PIN to Unlock</p>
            <div id="pin-display" class="pin-display"></div>
            <div class="numpad">
                <button class="num-btn" onclick="addPin(1)">1</button>
                <button class="num-btn" onclick="addPin(2)">2</button>
                <button class="num-btn" onclick="addPin(3)">3</button>
                <button class="num-btn" onclick="addPin(4)">4</button>
                <button class="num-btn" onclick="addPin(5)">5</button>
                <button class="num-btn" onclick="addPin(6)">6</button>
                <button class="num-btn" onclick="addPin(7)">7</button>
                <button class="num-btn" onclick="addPin(8)">8</button>
                <button class="num-btn" onclick="addPin(9)">9</button>
                <button class="num-btn" onclick="clearPin()">C</button>
                <button class="num-btn" onclick="addPin(0)">0</button>
                <button class="num-btn" style="background:var(--primary-color);color:#fff; border:none;" onclick="verifyPin()">OK</button>
            </div>
            <p class="text-sm mt-2">Default PIN: 0000</p>
        </div>
    </section>

    <!-- --- 2. LOGIN SCREEN --- -->
    <section id="login-screen" class="screen center hidden">
        <div class="login-card">
            <h2>Welcome</h2>
            <p class="text-sm" style="margin-bottom: 20px;">Vault OS requires Google Access</p>
            <button id="google-login-btn" class="btn btn-primary w-full">Sign in with Google</button>
            <div id="login-loader" class="loader hidden mt-2"></div>
        </div>
    </section>

    <!-- --- 3. MAIN DASHBOARD --- -->
    <section id="main-app" class="screen hidden">
        <header>
            <div class="flex center">
                <span style="font-weight:bold; margin-right:10px;">VAULT</span>
                <span class="text-sm" id="storage-stat">...</span>
            </div>
            
            <div class="drive-switch">
                <div id="switch-user" class="switch-opt active" onclick="switchDrive('USER')">User</div>
                <div id="switch-vault" class="switch-opt" onclick="switchDrive('VAULT')">Vault</div>
            </div>

            <div style="font-size: 1.2rem; cursor:pointer; padding: 5px;" onclick="toggleDebug()">üêû</div>
        </header>

        <!-- Breadcrumb -->
        <div style="padding: 12px 15px; background: var(--surface-color); font-size: 0.9rem; color: var(--text-secondary); border-bottom: 1px solid var(--border-color); white-space: nowrap; overflow-x: auto;">
            <span id="breadcrumb">Root</span>
        </div>

        <!-- File List -->
        <div id="file-list" class="file-list">
            <!-- Items injected via JS -->
            <div class="text-center" style="margin-top: 50px; color: #999;">
                Loading files...
            </div>
        </div>
    </section>

    <!-- --- BOTTOM NAVIGATION --- -->
    <nav class="bottom-nav hidden" id="bottom-nav">
        <div class="nav-item active" onclick="showToast('Already on Home')">
            <span class="nav-icon">üè†</span>
            <span>Home</span>
        </div>
        <div class="nav-item" onclick="refreshList()">
            <span class="nav-icon">‚òÅÔ∏è</span>
            <span>Cloud</span>
        </div>
        <div class="nav-item" onclick="showToast('Upload feature simulated')">
            <span class="nav-icon">‚¨ÜÔ∏è</span>
            <span>Upload</span>
        </div>
        <div class="nav-item" onclick="showToast('Settings not impl in demo')">
            <span class="nav-icon">‚öôÔ∏è</span>
            <span>Settings</span>
        </div>
    </nav>

    <!-- --- DEBUG / BUG DRAWER --- -->
    <div id="debug-drawer">
        <div class="debug-header">
            <span>DEBUG LOGS</span>
            <span onclick="clearLogs()" style="cursor:pointer; color:#ff5252">Clear</span>
            <span onclick="toggleDebug()" style="margin-left:10px; cursor:pointer;">‚úñ</span>
        </div>
        <div id="debug-content" class="debug-content">
            <!-- Logs go here -->
        console initialized...
        </div>
        <div style="padding:10px; border-top:1px solid #333;">
            <button class="btn btn-outline w-full" style="border-color:#555; color:#ccc;" onclick="testConfig()">Test Configs</button>
        </div>
    </div>

    <script>
        /* =========================================
           [0] CONFIGURATION (REAL DATA)
           ========================================= */
        const CONFIG = {
            firebase: {
                apiKey: "AIzaSyB3Iy1MIbfmJ7h5rv9NlsT23ysedCwUZt4",
                authDomain: "encrypted-vault-4683d.firebaseapp.com",
                databaseURL: "https://encrypted-vault-4683d-default-rtdb.firebaseio.com",
                projectId: "encrypted-vault-4683d",
                storageBucket: "encrypted-vault-4683d.firebasestorage.app",
                messagingSenderId: "851257263743",
                appId: "1:851257263743:web:e0d16606bd06f692f5e14a"
            },
            oauth: {
                clientId: "318681315152-65e9kofptt4c3bk3kmlj9gmksnasu347.apps.googleusercontent.com",
                scopes: [
                    "https://www.googleapis.com/auth/drive",
                    "https://www.googleapis.com/auth/drive.metadata",
                    "https://www.googleapis.com/auth/userinfo.profile",
                    "https://www.googleapis.com/auth/userinfo.email"
                ]
            },
            drive: {
                vaultRootId: "1zIyinAqjQv96QBSuanFS2F0USaG66GPn"
            },
            proxy: {
                fullAccess: "https://script.google.com/macros/s/AKfycbxQF58gDxHBATrBvliuMc_SdP7PEiuN6fiHdzVKG7_K5FIrj3V2m8imWgPXTjmVqfnN/exec",
                media: "https://script.google.com/macros/s/AKfycby2hqAq0JePMbnjEbwwcPBFjS14lvS3pM2Z1PPgY4OraTcpvTmZFPKQr9CQ4vba4Xk7/exec"
            }
        };

        /* =========================================
           [1] STATE MANAGEMENT
           ========================================= */
        const state = {
            pin: localStorage.getItem('vault_pin_hash') || null,
            session: JSON.parse(localStorage.getItem('vault_session')) || null,
            token: null,
            currentDrive: 'USER', // 'USER' or 'VAULT'
            currentFolderId: 'root', // 'root' for user, CONFIG.drive.vaultRootId for vault
            folderStack: [], // For breadcrumbs
            files: [],
            userProfile: null
        };

        /* =========================================
           [2] INITIALIZATION & UTILS
           ========================================= */
        
        // Initialize Firebase
        try {
            firebase.initializeApp(CONFIG.firebase);
            log("Firebase initialized", "info");
        } catch (e) {
            log("Firebase init error: " + e.message, "error");
        }

        document.addEventListener('DOMContentLoaded', () => {
            initApp();
        });

        function initApp() {
            log("App Loading...", "info");
            
            // 1. Check PIN
            if (!state.pin) {
                showScreen('pin-screen');
                // Set default PIN for testing if not set
                localStorage.setItem('vault_pin_hash', btoa('0000')); 
                showToast("Default PIN set to 0000");
            } else if (checkSession()) {
                // 2. Check Session
                log("Session valid, checking Token...", "info");
                showScreen('main-app');
                document.getElementById('bottom-nav').classList.remove('hidden');
                initGoogleTokenClient(); // Prepare token client
            } else {
                showScreen('pin-screen');
            }
        }

        /* =========================================
           [3] UI LOGIC (PIN, TOAST, SCREENS)
           ========================================= */
        
        function showScreen(id) {
            document.querySelectorAll('.screen').forEach(s => s.classList.add('hidden'));
            document.getElementById(id).classList.remove('hidden');
        }

        function toggleDebug() {
            document.getElementById('debug-drawer').classList.toggle('open');
        }

        function showToast(msg, type = 'info') {
            const container = document.getElementById('toast-container');
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            toast.innerText = msg;
            container.appendChild(toast);
            setTimeout(() => toast.remove(), 3000);
        }

        /* --- PIN Logic --- */
        let inputPin = "";
        function addPin(num) {
            // Visual feedback
            const btn = event.target;
            
            if (inputPin.length < 4) {
                inputPin += num;
                updatePinDisplay();
                // Haptic feedback if available (Mobile)
                if (navigator.vibrate) navigator.vibrate(20);
            } else {
                showToast("Max 4 digits", "warn");
            }
        }
        function clearPin() {
            inputPin = "";
            updatePinDisplay();
        }
        function updatePinDisplay() {
            document.getElementById('pin-display').innerText = "*".repeat(inputPin.length);
        }
        function verifyPin() {
            const storedHash = localStorage.getItem('vault_pin_hash');
            if (btoa(inputPin) === storedHash) {
                showToast("PIN Verified", "info");
                state.session = { valid: true, expiry: Date.now() + 24*60*60*1000 };
                localStorage.setItem('vault_session', JSON.stringify(state.session));
                
                showScreen('login-screen'); // Go to Google Login
            } else {
                showToast("Wrong PIN!", "error");
                inputPin = "";
                updatePinDisplay();
                if (navigator.vibrate) navigator.vibrate(200); // Error vibration
            }
        }

        function checkSession() {
            if (!state.session) return false;
            if (Date.now() > state.session.expiry) {
                log("Session expired", "warn");
                localStorage.removeItem('vault_session');
                return false;
            }
            return true;
        }

        /* =========================================
           [4] AUTHENTICATION & OAUTH
           ========================================= */
        
        let tokenClient;

        function initGoogleTokenClient() {
            tokenClient = google.accounts.oauth2.initTokenClient({
                client_id: CONFIG.oauth.clientId,
                scope: CONFIG.oauth.scopes.join(" "),
                callback: (response) => {
                    if (response.error) {
                        log("Auth Error: " + response.error, "error");
                        showToast("Login Failed: " + response.error, "error");
                        return;
                    }
                    state.token = response.access_token;
                    log("Access Token Received", "info");
                    
                    // Fetch User Profile
                    fetchUserInfo();
                    
                    // Load Dashboard
                    showScreen('main-app');
                    document.getElementById('bottom-nav').classList.remove('hidden');
                    
                    // Initial Load
                    loadFiles();
                }
            });

            const btn = document.getElementById('google-login-btn');
            if(btn) {
                btn.onclick = () => {
                    if (state.token) {
                        // Already have token, proceed
                         showScreen('main-app');
                         loadFiles();
                    } else {
                        tokenClient.requestAccessToken({ prompt: 'consent' });
                    }
                };
            }
        }

        async function fetchUserInfo() {
            try {
                const req = await fetch(`https://www.googleapis.com/oauth2/v3/userinfo?access_token=${state.token}`);
                const user = await req.json();
                state.userProfile = user;
                log(`User logged in: ${user.email}`, "info");
                showToast(`Welcome, ${user.given_name}`);
            } catch (e) {
                log("User fetch failed", "error");
            }
        }

        /* =========================================
           [5] DRIVE LOGIC (USER vs VAULT)
           ========================================= */

        function switchDrive(type) {
            state.currentDrive = type;
            
            // Update UI Toggle
            document.getElementById('switch-user').classList.toggle('active', type === 'USER');
            document.getElementById('switch-vault').classList.toggle('active', type === 'VAULT');
            
            // Reset Path
            state.folderStack = [];
            if (type === 'VAULT') {
                state.currentFolderId = CONFIG.drive.vaultRootId;
                document.getElementById('breadcrumb').innerText = "Vault Root";
                showToast("Switched to VAULT (Proxy Mode)");
            } else {
                state.currentFolderId = 'root';
                document.getElementById('breadcrumb').innerText = "My Drive";
                showToast("Switched to USER DRIVE (Direct Mode)");
            }
            
            loadFiles();
        }

        async function loadFiles() {
            const listEl = document.getElementById('file-list');
            listEl.innerHTML = '<div class="loader" style="margin-top:50px"></div>';
            
            log(`Loading ${state.currentDrive} Files in ${state.currentFolderId}...`, "info");

            try {
                let url = "";
                let headers = {};

                if (state.currentDrive === 'USER') {
                    // DIRECT GOOGLE DRIVE API CALL
                    url = `https://www.googleapis.com/drive/v3/files?q='${state.currentFolderId}' in parents&fields=id,name,mimeType,size,modifiedTime&orderBy=folder,name`;
                    headers = { 'Authorization': `Bearer ${state.token}` };
                } else {
                    // PROXY CALL (Vault Admin)
                    url = `${CONFIG.proxy.fullAccess}?action=list&folderId=${state.currentFolderId}`;
                    headers = {}; 
                    headers['Authorization'] = `Bearer ${state.token}`;
                }

                const res = await fetch(url, { headers: headers });
                
                if (!res.ok) {
                    throw new Error(`API Error ${res.status}`);
                }

                const data = await res.json();
                log(`Received ${data.files ? data.files.length : 0} items`, "info");
                
                renderFiles(data.files || []);

            } catch (e) {
                log("Load Failed: " + e.message, "error");
                showToast("Failed to load files", "error");
                listEl.innerHTML = `<div class="text-center mt-2" style="color:var(--danger-color)">Error: ${e.message}<br>Check Debug Console</div>`;
            }
        }

        function renderFiles(files) {
            const listEl = document.getElementById('file-list');
            listEl.innerHTML = '';

            // Add ".." if not root
            if (state.currentFolderId !== 'root' && state.currentFolderId !== CONFIG.drive.vaultRootId) {
                const upDiv = document.createElement('div');
                upDiv.className = 'file-item';
                upDiv.innerHTML = `<div class="file-icon">‚¨ÜÔ∏è</div><div class="file-info"><div class="file-name">.. (Back)</div></div>`;
                upDiv.onclick = goUp;
                listEl.appendChild(upDiv);
            }

            if (files.length === 0) {
                listEl.innerHTML += '<div class="text-center mt-2">Folder is empty</div>';
                return;
            }

            files.forEach(file => {
                const isFolder = file.mimeType === 'application/vnd.google-apps.folder';
                const icon = isFolder ? 'üìÅ' : getFileIcon(file.mimeType);
                const size = file.size ? formatBytes(file.size) : '';
                
                const div = document.createElement('div');
                div.className = 'file-item';
                div.innerHTML = `
                    <div class="file-icon">${icon}</div>
                    <div class="file-info">
                        <div class="file-name">${file.name}</div>
                        <div class="file-meta">${isFolder ? 'Folder' : size}</div>
                    </div>
                `;
                
                div.onclick = () => {
                    if (isFolder) {
                        openFolder(file);
                    } else {
                        showToast("File click detected (Preview not impl in demo)", "info");
                    }
                };

                listEl.appendChild(div);
            });
            
            // Simulate Storage Info update
            updateStorageStat();
        }

        function openFolder(file) {
            state.folderStack.push({ id: state.currentFolderId, name: getCurrentBreadcrumbName() });
            state.currentFolderId = file.id;
            updateBreadcrumb(file.name);
            loadFiles();
        }

        function goUp() {
            if (state.folderStack.length > 0) {
                const prev = state.folderStack.pop();
                state.currentFolderId = prev.id;
                updateBreadcrumb(prev.name);
                loadFiles();
            }
        }

        function updateBreadcrumb(name) {
            const bc = document.getElementById('breadcrumb');
            if (state.currentDrive === 'USER') {
                bc.innerText = "My Drive" + (state.folderStack.length > 0 ? " / ..." : "") + " / " + name;
            } else {
                bc.innerText = "Vault" + (state.folderStack.length > 0 ? " / ..." : "") + " / " + name;
            }
        }
        
        function getCurrentBreadcrumbName() {
            const bc = document.getElementById('breadcrumb').innerText;
            return bc.split('/').pop().trim();
        }

        function refreshList() {
            showToast("Refreshing...");
            loadFiles();
        }

        /* =========================================
           [6] DEBUG & LOGGING SYSTEM
           ========================================= */
        
        function log(msg, type = "info") {
            const consoleEl = document.getElementById('debug-content');
            const time = new Date().toLocaleTimeString();
            const div = document.createElement('div');
            div.className = `log-entry log-${type}`;
            div.innerHTML = `<span class="log-time">[${time}]</span> ${msg}`;
            consoleEl.appendChild(div);
            consoleEl.scrollTop = consoleEl.scrollHeight;
            
            // Also log to browser console
            console.log(`[VaultOS ${type.toUpperCase()}]` + msg);
        }

        function clearLogs() {
            document.getElementById('debug-content').innerHTML = '';
        }

        function testConfig() {
            log("--- TESTING CONFIG ---", "warn");
            log("Firebase API Key: " + CONFIG.firebase.apiKey.substring(0,10) + "...", "info");
            log("OAuth Client ID: " + CONFIG.oauth.clientId.substring(0,10) + "...", "info");
            log("Vault Root: " + CONFIG.drive.vaultRootId, "info");
            log("Full Access Proxy: " + CONFIG.proxy.fullAccess, "info");
            log("Current Token: " + (state.token ? "Present" : "MISSING"), state.token ? "info" : "error");
            log("Current Drive: " + state.currentDrive, "info");
        }

        /* =========================================
           [7] HELPERS
           ========================================= */
        function formatBytes(bytes, decimals = 2) {
            if (!+bytes) return '0 B';
            const k = 1024;
            const dm = decimals < 0 ? 0 : decimals;
            const sizes = ['B', 'KB', 'MB', 'GB', 'TB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return `${parseFloat((bytes / Math.pow(k, i)).toFixed(dm))} ${sizes[i]}`;
        }

        function getFileIcon(mimeType) {
            if (mimeType.includes('image')) return 'üñºÔ∏è';
            if (mimeType.includes('video')) return 'üé•';
            if (mimeType.includes('audio')) return 'üéµ';
            if (mimeType.includes('pdf')) return 'üìÑ';
            return 'üìÉ';
        }

        function updateStorageStat() {
            // In a real app, fetch Drive About API
            // Mocking for UI reference as per file
            const stats = ["45% Used", "LOW", "2.1GB / 5GB"];
            const randomStat = stats[Math.floor(Math.random() * stats.length)];
            document.getElementById('storage-stat').innerText = randomStat;
        }

    </script>
</body>
</html>
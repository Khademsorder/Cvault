<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>üì¶ Hybrid Vault - Secure File Storage</title>
    <!-- Firebase -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    <!-- Google APIs -->
    <script src="https://apis.google.com/js/api.js"></script>
    <script src="https://accounts.google.com/gsi/client"></script>
    <!-- File encryption libraries -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>
    <style>
        /* ===== VARIABLES & RESET ===== */
        :root {
            --primary: #6366f1;
            --primary-dark: #4f46e5;
            --secondary: #10b981;
            --danger: #ef4444;
            --warning: #f59e0b;
            --info: #3b82f6;
            --bg: #0f172a;
            --surface: #1e293b;
            --surface-light: #334155;
            --text: #f1f5f9;
            --text-secondary: #94a3b8;
            --border: #475569;
            --radius: 16px;
            --radius-sm: 8px;
            --shadow: 0 4px 20px rgba(0,0,0,0.3);
            --shadow-lg: 0 10px 40px rgba(0,0,0,0.5);
            --online: #10b981;
            --offline: #f59e0b;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
            font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
        }

        body {
            background: var(--bg);
            color: var(--text);
            min-height: 100vh;
            overflow-x: hidden;
            position: relative;
        }

        /* Background Gradient */
        .bg-gradient {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: 
                radial-gradient(circle at 20% 30%, rgba(99, 102, 241, 0.15) 0%, transparent 50%),
                radial-gradient(circle at 80% 70%, rgba(16, 185, 129, 0.15) 0%, transparent 50%);
            pointer-events: none;
            z-index: 0;
        }

        /* ===== AUTH SCREEN ===== */
        #authScreen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: var(--bg);
            display: flex;
            flex-direction: column;
            padding: 20px;
            z-index: 1000;
            overflow-y: auto;
        }

        .auth-container {
            max-width: 400px;
            width: 100%;
            margin: auto;
            text-align: center;
            animation: fadeIn 0.8s ease;
        }

        .app-icon {
            font-size: 5rem;
            margin-bottom: 20px;
            animation: bounce 2s infinite;
            display: inline-block;
        }

        .app-title {
            font-size: 2.2rem;
            font-weight: 800;
            background: linear-gradient(45deg, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            margin-bottom: 10px;
        }

        .app-subtitle {
            color: var(--text-secondary);
            margin-bottom: 40px;
            line-height: 1.6;
            font-size: 1rem;
        }

        /* PIN Input Section */
        .pin-section {
            background: var(--surface);
            border-radius: var(--radius);
            padding: 25px;
            margin-bottom: 25px;
            border: 1px solid var(--border);
            box-shadow: var(--shadow);
        }

        .section-title {
            font-size: 1.1rem;
            font-weight: 600;
            margin-bottom: 15px;
            color: var(--text);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .pin-display {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin: 20px 0;
        }

        .pin-dot {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: var(--border);
            transition: all 0.3s;
        }

        .pin-dot.filled {
            background: var(--primary);
            transform: scale(1.2);
            box-shadow: 0 0 10px rgba(99, 102, 241, 0.5);
        }

        /* Numerical Keypad */
        .keypad {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            margin: 30px 0;
            max-width: 300px;
            margin-left: auto;
            margin-right: auto;
        }

        .key {
            background: var(--surface-light);
            border: none;
            border-radius: var(--radius);
            color: var(--text);
            font-size: 1.5rem;
            font-weight: 700;
            height: 70px;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            user-select: none;
        }

        .key:active {
            background: var(--primary);
            transform: scale(0.95);
        }

        .key:hover {
            background: var(--primary);
        }

        .key-backspace {
            font-size: 1.2rem;
            background: rgba(239, 68, 68, 0.2);
            color: var(--danger);
        }

        .key-backspace:active {
            background: var(--danger);
            color: white;
        }

        .key-clear {
            font-size: 1rem;
            background: rgba(245, 158, 11, 0.2);
            color: var(--warning);
        }

        .key-clear:active {
            background: var(--warning);
            color: white;
        }

        .pin-hint {
            color: var(--text-secondary);
            font-size: 0.9rem;
            margin-top: 10px;
            line-height: 1.4;
        }

        /* Login Options */
        .login-options {
            background: var(--surface);
            border-radius: var(--radius);
            padding: 25px;
            border: 1px solid var(--border);
            display: none;
        }

        .login-title {
            font-size: 1.1rem;
            font-weight: 600;
            margin-bottom: 20px;
            color: var(--text);
            text-align: center;
        }

        .login-buttons {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .btn {
            padding: 16px 24px;
            border-radius: var(--radius);
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            border: none;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
            position: relative;
            overflow: hidden;
        }

        .btn::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transform: translateX(-100%);
        }

        .btn:hover::after {
            animation: shimmer 0.5s;
        }

        .btn:active {
            transform: scale(0.98);
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: white;
            box-shadow: 0 4px 15px rgba(99, 102, 241, 0.4);
        }

        .btn-secondary {
            background: var(--surface-light);
            color: var(--text);
            border: 2px solid var(--border);
        }

        .btn-secondary:hover {
            border-color: var(--primary);
            color: var(--primary);
        }

        .btn-google {
            background: white;
            color: #333;
            border: 2px solid #ddd;
        }

        .btn-google:hover {
            background: #f8f9fa;
            border-color: var(--primary);
        }

        .btn-icon {
            font-size: 1.2rem;
        }

        .btn-text {
            flex: 1;
            text-align: center;
        }

        .offline-note {
            background: rgba(245, 158, 11, 0.1);
            border: 1px solid var(--warning);
            border-radius: var(--radius-sm);
            padding: 12px;
            margin-top: 15px;
            color: var(--warning);
            font-size: 0.85rem;
            text-align: center;
            line-height: 1.4;
        }

        /* ===== MAIN APP ===== */
        #mainScreen {
            display: none;
            flex-direction: column;
            height: 100vh;
            position: relative;
        }

        #mainScreen.active {
            display: flex;
            animation: fadeIn 0.5s ease;
        }

        /* Connection Status */
        .connection-banner {
            padding: 10px 15px;
            background: rgba(245, 158, 11, 0.1);
            border-bottom: 1px solid var(--warning);
            color: var(--warning);
            font-size: 0.9rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            position: sticky;
            top: 0;
            z-index: 100;
            animation: slideDown 0.3s ease;
        }

        .connection-banner.online {
            background: rgba(16, 185, 129, 0.1);
            border-bottom-color: var(--secondary);
            color: var(--secondary);
        }

        .connection-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            animation: pulse 2s infinite;
        }

        .connection-banner .connection-dot {
            background: var(--warning);
        }

        .connection-banner.online .connection-dot {
            background: var(--secondary);
        }

        /* Header */
        .app-header {
            padding: 15px 20px;
            background: rgba(15, 23, 42, 0.95);
            backdrop-filter: blur(10px);
            border-bottom: 1px solid var(--border);
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: sticky;
            top: 0;
            z-index: 90;
        }

        .header-left {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .header-icon {
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
        }

        .header-title {
            font-size: 1.3rem;
            font-weight: 700;
        }

        .header-stats {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .stat-item {
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 0.85rem;
            color: var(--text-secondary);
        }

        .stat-count {
            background: var(--surface);
            padding: 4px 10px;
            border-radius: 20px;
            font-weight: 700;
            color: var(--primary);
        }

        /* Tab Navigation */
        .tab-nav {
            display: flex;
            background: var(--surface);
            border-bottom: 1px solid var(--border);
            position: sticky;
            top: 60px;
            z-index: 80;
        }

        .tab-btn {
            flex: 1;
            padding: 15px;
            background: none;
            border: none;
            color: var(--text-secondary);
            font-size: 0.95rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            border-bottom: 3px solid transparent;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .tab-btn:hover {
            color: var(--text);
            background: rgba(255,255,255,0.05);
        }

        .tab-btn.active {
            color: var(--primary);
            border-bottom-color: var(--primary);
            background: rgba(99, 102, 241, 0.1);
        }

        .tab-badge {
            background: var(--primary);
            color: white;
            font-size: 0.7rem;
            padding: 2px 6px;
            border-radius: 10px;
            animation: pulse 1.5s infinite;
        }

        /* Content Area */
        .content-area {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
            position: relative;
        }

        /* Gallery View */
        .gallery-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .gallery-title {
            font-size: 1.2rem;
            font-weight: 700;
            color: var(--text);
        }

        .view-toggle {
            display: flex;
            background: var(--surface);
            border-radius: var(--radius-sm);
            overflow: hidden;
            border: 1px solid var(--border);
        }

        .view-btn {
            padding: 8px 16px;
            background: none;
            border: none;
            color: var(--text-secondary);
            cursor: pointer;
            transition: all 0.3s;
        }

        .view-btn.active {
            background: var(--primary);
            color: white;
        }

        .empty-state {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 60px 20px;
            text-align: center;
            color: var(--text-secondary);
            animation: fadeIn 0.8s ease;
        }

        .empty-icon {
            font-size: 4rem;
            margin-bottom: 20px;
            opacity: 0.5;
        }

        .empty-text {
            font-size: 1.1rem;
            margin-bottom: 10px;
            color: var(--text);
        }

        .empty-subtext {
            font-size: 0.9rem;
            margin-bottom: 30px;
            max-width: 300px;
            line-height: 1.5;
        }

        /* File Grid */
        .file-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 15px;
            animation: fadeIn 0.5s ease;
        }

        .file-card {
            background: var(--surface);
            border-radius: var(--radius);
            overflow: hidden;
            border: 2px solid transparent;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
        }

        .file-card:hover {
            transform: translateY(-5px);
            border-color: var(--primary);
            box-shadow: var(--shadow-lg);
        }

        .file-card:active {
            transform: translateY(-2px);
        }

        .file-preview {
            width: 100%;
            height: 120px;
            background: linear-gradient(135deg, var(--primary), var(--surface-light));
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
            position: relative;
        }

        .file-icon {
            font-size: 2.5rem;
            color: white;
            z-index: 1;
        }

        .file-badge {
            position: absolute;
            top: 8px;
            right: 8px;
            background: rgba(0,0,0,0.7);
            color: white;
            padding: 4px 8px;
            border-radius: 10px;
            font-size: 0.7rem;
            font-weight: 600;
            z-index: 2;
        }

        .file-info {
            padding: 12px;
        }

        .file-name {
            font-size: 0.85rem;
            font-weight: 600;
            margin-bottom: 6px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .file-meta {
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 0.75rem;
            color: var(--text-secondary);
        }

        .file-size {
            background: var(--surface-light);
            padding: 2px 8px;
            border-radius: 8px;
        }

        /* File List View */
        .file-list {
            display: none;
            flex-direction: column;
            gap: 10px;
        }

        .file-list.active {
            display: flex;
        }

        .list-item {
            display: flex;
            align-items: center;
            padding: 15px;
            background: var(--surface);
            border-radius: var(--radius);
            border: 1px solid var(--border);
            gap: 15px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .list-item:hover {
            border-color: var(--primary);
            background: rgba(99, 102, 241, 0.05);
        }

        .list-icon {
            font-size: 1.8rem;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            border-radius: 10px;
            color: white;
        }

        .list-details {
            flex: 1;
            min-width: 0;
        }

        .list-name {
            font-weight: 600;
            margin-bottom: 4px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .list-meta {
            display: flex;
            gap: 10px;
            font-size: 0.8rem;
            color: var(--text-secondary);
        }

        .list-badge {
            background: var(--surface-light);
            padding: 2px 8px;
            border-radius: 10px;
            font-size: 0.75rem;
        }

        /* Drive View */
        .drive-status {
            background: var(--surface);
            border-radius: var(--radius);
            padding: 20px;
            margin-bottom: 20px;
            border: 1px solid var(--border);
        }

        .drive-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 15px;
        }

        .drive-icon {
            font-size: 2rem;
            color: var(--primary);
        }

        .drive-info h3 {
            font-size: 1.1rem;
            margin-bottom: 4px;
            color: var(--text);
        }

        .drive-info p {
            font-size: 0.9rem;
            color: var(--text-secondary);
        }

        .drive-stats {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin-top: 20px;
        }

        .stat-box {
            background: var(--bg);
            padding: 15px;
            border-radius: var(--radius-sm);
            text-align: center;
        }

        .stat-value {
            font-size: 1.5rem;
            font-weight: 700;
            margin-bottom: 5px;
            color: var(--primary);
        }

        .stat-label {
            font-size: 0.8rem;
            color: var(--text-secondary);
        }

        /* Upload Button */
        .upload-fab {
            position: fixed;
            bottom: 85px;
            right: 20px;
            width: 60px;
            height: 60px;
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.8rem;
            cursor: pointer;
            box-shadow: var(--shadow-lg);
            z-index: 100;
            transition: all 0.3s;
            animation: bounce 2s infinite;
        }

        .upload-fab:hover {
            transform: scale(1.1);
            box-shadow: 0 15px 30px rgba(99, 102, 241, 0.4);
        }

        .upload-fab:active {
            transform: scale(0.95);
        }

        /* Bottom Nav */
        .bottom-nav {
            background: rgba(15, 23, 42, 0.95);
            backdrop-filter: blur(10px);
            border-top: 1px solid var(--border);
            padding: 10px 20px;
            display: flex;
            justify-content: space-around;
            position: sticky;
            bottom: 0;
            z-index: 90;
        }

        .nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            color: var(--text-secondary);
            cursor: pointer;
            padding: 8px 12px;
            border-radius: var(--radius);
            transition: all 0.3s;
            min-width: 60px;
            position: relative;
        }

        .nav-item:hover {
            color: var(--primary);
            background: rgba(99, 102, 241, 0.1);
            transform: translateY(-2px);
        }

        .nav-item.active {
            color: var(--primary);
            background: rgba(99, 102, 241, 0.15);
        }

        .nav-item:active {
            transform: scale(0.95);
        }

        .nav-icon {
            font-size: 1.3rem;
            margin-bottom: 4px;
            transition: transform 0.3s;
        }

        .nav-item:hover .nav-icon {
            transform: scale(1.2) rotate(5deg);
        }

        .nav-text {
            font-size: 0.7rem;
            font-weight: 600;
        }

        .nav-badge {
            position: absolute;
            top: 0;
            right: 0;
            background: var(--danger);
            color: white;
            font-size: 0.6rem;
            padding: 2px 5px;
            border-radius: 10px;
            animation: pulse 1.5s infinite;
        }

        /* ===== MODALS ===== */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            backdrop-filter: blur(5px);
            padding: 20px;
            animation: fadeIn 0.3s ease;
        }

        .modal-overlay.active {
            display: flex;
        }

        .modal {
            background: var(--surface);
            border-radius: var(--radius);
            width: 100%;
            max-width: 500px;
            max-height: 80vh;
            overflow: hidden;
            border: 1px solid var(--border);
            box-shadow: var(--shadow-lg);
            transform: scale(0.9);
            animation: modalIn 0.5s cubic-bezier(0.68, -0.55, 0.265, 1.55) forwards;
        }

        @keyframes modalIn {
            to { transform: scale(1); }
        }

        .modal-header {
            padding: 20px;
            border-bottom: 1px solid var(--border);
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: linear-gradient(135deg, var(--surface), var(--surface-light));
        }

        .modal-title {
            font-size: 1.3rem;
            font-weight: 700;
            color: var(--text);
        }

        .modal-close {
            background: none;
            border: none;
            font-size: 1.5rem;
            color: var(--text-secondary);
            cursor: pointer;
            width: 36px;
            height: 36px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s;
        }

        .modal-close:hover {
            background: var(--surface-light);
            color: var(--text);
            transform: rotate(90deg);
        }

        .modal-body {
            padding: 20px;
            overflow-y: auto;
            max-height: calc(80vh - 70px);
        }

        /* Upload Options */
        .upload-options {
            display: grid;
            grid-template-columns: 1fr;
            gap: 15px;
            margin-bottom: 20px;
        }

        @media (min-width: 480px) {
            .upload-options {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        .upload-option {
            background: var(--surface-light);
            border: 2px solid var(--border);
            border-radius: var(--radius);
            padding: 25px 15px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .upload-option:hover {
            transform: translateY(-5px);
            border-color: var(--primary);
            box-shadow: var(--shadow);
        }

        .upload-option.selected {
            border-color: var(--primary);
            background: linear-gradient(135deg, rgba(99, 102, 241, 0.2), rgba(16, 185, 129, 0.1));
        }

        .upload-option:active {
            transform: scale(0.95);
        }

        .upload-icon {
            font-size: 2.5rem;
            margin-bottom: 10px;
            display: block;
        }

        .upload-name {
            font-weight: 700;
            margin-bottom: 5px;
            color: var(--text);
        }

        .upload-desc {
            font-size: 0.8rem;
            color: var(--text-secondary);
        }

        /* File Drop Area - FIXED FOR MOBILE */
        .file-drop-area {
            border: 3px dashed var(--border);
            border-radius: var(--radius);
            padding: 40px 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            margin: 20px 0;
            position: relative;
            overflow: hidden;
            touch-action: manipulation;
        }

        .file-drop-area:active {
            border-color: var(--primary);
            background: rgba(99, 102, 241, 0.05);
            transform: scale(0.98);
        }

        .file-drop-area.dragover {
            border-color: var(--primary);
            background: rgba(99, 102, 241, 0.1);
            animation: pulse 0.5s;
        }

        .file-drop-icon {
            font-size: 3.5rem;
            margin-bottom: 15px;
            opacity: 0.7;
            display: block;
        }

        .file-input {
            position: absolute;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            opacity: 0;
            cursor: pointer;
            font-size: 100px;
        }

        /* Encryption Toggle */
        .encryption-toggle {
            background: var(--surface-light);
            border-radius: var(--radius);
            padding: 15px;
            margin: 15px 0;
            display: flex;
            align-items: center;
            justify-content: space-between;
            border: 1px solid var(--border);
        }

        .toggle-label {
            display: flex;
            align-items: center;
            gap: 10px;
            font-weight: 600;
        }

        .toggle-switch {
            position: relative;
            display: inline-block;
            width: 60px;
            height: 30px;
        }

        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .toggle-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: var(--border);
            transition: .4s;
            border-radius: 34px;
        }

        .toggle-slider:before {
            position: absolute;
            content: "";
            height: 22px;
            width: 22px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }

        input:checked + .toggle-slider {
            background-color: var(--primary);
        }

        input:checked + .toggle-slider:before {
            transform: translateX(30px);
        }

        /* Selected Files */
        .selected-files {
            background: var(--surface-light);
            border-radius: var(--radius);
            padding: 15px;
            margin-bottom: 20px;
            display: none;
        }

        .selected-files.show {
            display: block;
            animation: fadeIn 0.3s ease;
        }

        .file-list-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px;
            background: var(--bg);
            border-radius: var(--radius-sm);
            margin-bottom: 8px;
        }

        .file-list-name {
            font-size: 0.9rem;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            flex: 1;
        }

        .file-list-size {
            font-size: 0.8rem;
            color: var(--text-secondary);
            margin-left: 10px;
        }

        /* Progress */
        .progress-container {
            margin: 20px 0;
            display: none;
        }

        .progress-container.show {
            display: block;
            animation: fadeIn 0.5s ease;
        }

        .progress-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            font-size: 0.9rem;
            font-weight: 600;
        }

        .progress-bar {
            height: 8px;
            background: var(--surface-light);
            border-radius: 4px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--primary), var(--secondary));
            width: 0%;
            transition: width 0.5s cubic-bezier(0.34, 1.56, 0.64, 1);
            border-radius: 4px;
        }

        /* ===== SETTINGS ===== */
        .settings-section {
            background: var(--surface-light);
            border-radius: var(--radius);
            padding: 20px;
            margin-bottom: 20px;
        }

        .settings-title {
            font-size: 1.1rem;
            font-weight: 700;
            margin-bottom: 15px;
            color: var(--primary);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .setting-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 0;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }

        .setting-item:last-child {
            border-bottom: none;
        }

        .switch {
            position: relative;
            display: inline-block;
            width: 50px;
            height: 26px;
        }

        .switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: var(--border);
            transition: .4s;
            border-radius: 34px;
        }

        .slider:before {
            position: absolute;
            content: "";
            height: 18px;
            width: 18px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }

        input:checked + .slider {
            background-color: var(--primary);
        }

        input:checked + .slider:before {
            transform: translateX(24px);
        }

        /* ===== TOAST ===== */
        .toast-container {
            position: fixed;
            bottom: 80px;
            left: 20px;
            right: 20px;
            z-index: 1001;
            display: flex;
            flex-direction: column;
            gap: 10px;
            pointer-events: none;
        }

        .toast {
            background: var(--surface);
            color: var(--text);
            padding: 16px 20px;
            border-radius: var(--radius);
            border-left: 5px solid var(--primary);
            box-shadow: var(--shadow-lg);
            display: flex;
            align-items: center;
            gap: 12px;
            transform: translateY(100px);
            opacity: 0;
            animation: toastIn 0.5s cubic-bezier(0.68, -0.55, 0.265, 1.55) forwards;
            backdrop-filter: blur(10px);
            border: 1px solid var(--border);
            pointer-events: auto;
        }

        @keyframes toastIn {
            to { transform: translateY(0); opacity: 1; }
        }

        .toast.success {
            border-left-color: var(--secondary);
            background: linear-gradient(135deg, rgba(16, 185, 129, 0.1), var(--surface));
        }

        .toast.error {
            border-left-color: var(--danger);
            background: linear-gradient(135deg, rgba(239, 68, 68, 0.1), var(--surface));
        }

        .toast.warning {
            border-left-color: var(--warning);
            background: linear-gradient(135deg, rgba(245, 158, 11, 0.1), var(--surface));
        }

        .toast.info {
            border-left-color: var(--info);
            background: linear-gradient(135deg, rgba(59, 130, 246, 0.1), var(--surface));
        }

        .toast-icon {
            font-size: 1.3rem;
            flex-shrink: 0;
        }

        .toast-content {
            flex: 1;
        }

        .toast-title {
            font-weight: 700;
            margin-bottom: 2px;
            font-size: 0.95rem;
        }

        .toast-message {
            font-size: 0.85rem;
            color: var(--text-secondary);
            line-height: 1.4;
        }

        /* ===== ANIMATIONS ===== */
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes slideDown {
            from { transform: translateY(-100%); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        @keyframes shimmer {
            to { transform: translateX(100%); }
        }

        /* ===== RESPONSIVE ===== */
        @media (max-width: 480px) {
            .app-title {
                font-size: 1.8rem;
            }
            
            .key {
                height: 60px;
                font-size: 1.3rem;
            }
            
            .file-grid {
                grid-template-columns: repeat(auto-fill, minmax(130px, 1fr));
                gap: 12px;
            }
            
            .header-stats {
                display: none;
            }
            
            .tab-btn {
                font-size: 0.85rem;
                padding: 12px 8px;
            }
            
            .modal {
                margin: 10px;
            }
        }

        @media (max-width: 360px) {
            .key {
                height: 55px;
                font-size: 1.2rem;
            }
            
            .btn {
                padding: 14px 20px;
                font-size: 0.95rem;
            }
            
            .file-grid {
                grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
            }
        }

        /* ===== UTILITIES ===== */
        .d-none { display: none !important; }
        .d-block { display: block !important; }
        .d-flex { display: flex !important; }
        .text-center { text-align: center; }
        .mt-1 { margin-top: 5px; }
        .mt-2 { margin-top: 10px; }
        .mt-3 { margin-top: 15px; }
        .mt-4 { margin-top: 20px; }
        .mb-1 { margin-bottom: 5px; }
        .mb-2 { margin-bottom: 10px; }
        .mb-3 { margin-bottom: 15px; }
        .mb-4 { margin-bottom: 20px; }
    </style>
</head>
<body>
    <!-- Background Gradient -->
    <div class="bg-gradient"></div>

    <!-- Auth Screen -->
    <div id="authScreen">
        <div class="auth-container">
            <div class="app-icon">üì¶</div>
            <h1 class="app-title">Hybrid Vault</h1>
            <p class="app-subtitle">‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶´‡¶æ‡¶á‡¶≤ ‡¶è‡¶®‡¶ï‡ßç‡¶∞‡¶ø‡¶™‡ßç‡¶ü ‡¶ï‡¶∞‡ßá ‡¶∏‡ßá‡¶≠ ‡¶ï‡¶∞‡ßÅ‡¶®<br>‡¶Ö‡¶´‡¶≤‡¶æ‡¶á‡¶®+‡¶Ö‡¶®‡¶≤‡¶æ‡¶á‡¶® ‡¶∏‡ßç‡¶ü‡ßã‡¶∞‡ßá‡¶ú</p>
            
            <!-- PIN Section with Keypad -->
            <div class="pin-section">
                <div class="section-title">
                    <span>üîí</span> ‡¶∏‡¶ø‡¶ï‡¶ø‡¶â‡¶∞‡¶ø‡¶ü‡¶ø PIN ‡¶¶‡¶ø‡¶®
                </div>
                
                <!-- PIN Display -->
                <div class="pin-display">
                    <div class="pin-dot" id="pinDot1"></div>
                    <div class="pin-dot" id="pinDot2"></div>
                    <div class="pin-dot" id="pinDot3"></div>
                    <div class="pin-dot" id="pinDot4"></div>
                </div>
                
                <!-- Keypad -->
                <div class="keypad">
                    <button class="key" data-key="1">1</button>
                    <button class="key" data-key="2">2</button>
                    <button class="key" data-key="3">3</button>
                    <button class="key" data-key="4">4</button>
                    <button class="key" data-key="5">5</button>
                    <button class="key" data-key="6">6</button>
                    <button class="key" data-key="7">7</button>
                    <button class="key" data-key="8">8</button>
                    <button class="key" data-key="9">9</button>
                    <button class="key key-clear" data-key="clear">‡¶Æ‡ßÅ‡¶õ‡ßÅ‡¶®</button>
                    <button class="key" data-key="0">0</button>
                    <button class="key key-backspace" data-key="backspace">‚å´</button>
                </div>
                
                <div class="pin-hint">
                    ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡ß™-‡¶°‡¶ø‡¶ú‡¶ø‡¶ü ‡¶∏‡¶ø‡¶ï‡¶ø‡¶â‡¶∞‡¶ø‡¶ü‡¶ø PIN ‡¶¶‡¶ø‡¶®<br>
                    <small style="color: var(--warning);">‡¶è‡¶á PIN ‡¶¶‡¶ø‡¶Ø‡¶º‡ßá ‡¶´‡¶æ‡¶á‡¶≤ ‡¶è‡¶®‡¶ï‡ßç‡¶∞‡¶ø‡¶™‡ßç‡¶ü/‡¶°‡¶ø‡¶ï‡ßç‡¶∞‡¶ø‡¶™‡ßç‡¶ü ‡¶π‡¶¨‡ßá</small>
                </div>
            </div>

            <!-- Login Options -->
            <div class="login-options" id="loginOptions">
                <div class="login-title">‡¶≤‡¶ó‡¶á‡¶® ‡¶Ö‡¶™‡¶∂‡¶®</div>
                <div class="login-buttons">
                    <button id="googleLoginBtn" class="btn btn-google">
                        <span class="btn-icon">üîê</span>
                        <span class="btn-text">‡¶ó‡ßÅ‡¶ó‡¶≤ ‡¶¶‡¶ø‡ßü‡ßá ‡¶≤‡¶ó‡¶á‡¶®</span>
                    </button>
                    <button id="offlineModeBtn" class="btn btn-secondary">
                        <span class="btn-icon">üì¥</span>
                        <span class="btn-text">‡¶Ö‡¶´‡¶≤‡¶æ‡¶á‡¶® ‡¶Æ‡ßã‡¶° ‡¶∂‡ßÅ‡¶∞‡ßÅ ‡¶ï‡¶∞‡ßÅ‡¶®</span>
                    </button>
                </div>
                <div class="offline-note">
                    ‚ö†Ô∏è ‡¶Ö‡¶´‡¶≤‡¶æ‡¶á‡¶® ‡¶Æ‡ßã‡¶°‡ßá ‡¶∂‡ßÅ‡¶ß‡ßÅ ‡¶≤‡ßã‡¶ï‡¶æ‡¶≤ ‡¶∏‡ßç‡¶ü‡ßã‡¶∞‡ßá‡¶ú ‡¶•‡¶æ‡¶ï‡¶¨‡ßá<br>
                    ‡¶ó‡ßÅ‡¶ó‡¶≤ ‡¶°‡ßç‡¶∞‡¶æ‡¶á‡¶≠ ‡¶∏‡¶ø‡¶ô‡ßç‡¶ï ‡¶ï‡¶∞‡¶æ‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶Ö‡¶®‡¶≤‡¶æ‡¶á‡¶® ‡¶•‡¶æ‡¶ï‡ßÅ‡¶®
                </div>
            </div>
        </div>
    </div>

    <!-- Main App -->
    <div id="mainScreen">
        <!-- Connection Banner -->
        <div id="connectionBanner" class="connection-banner">
            <div class="connection-dot"></div>
            <span id="connectionText">‡¶Ö‡¶´‡¶≤‡¶æ‡¶á‡¶® ‡¶Æ‡ßã‡¶° - ‡¶∏‡¶ø‡¶ô‡ßç‡¶ï ‡¶Ö‡¶®‡¶≤‡¶æ‡¶á‡¶®‡ßá ‡¶π‡¶¨‡ßá</span>
        </div>

        <!-- Header -->
        <div class="app-header">
            <div class="header-left">
                <div class="header-icon">üì¶</div>
                <div class="header-title">Hybrid Vault</div>
            </div>
            <div class="header-stats">
                <div class="stat-item">
                    <span>‡¶´‡¶æ‡¶á‡¶≤:</span>
                    <span id="fileCount" class="stat-count">0</span>
                </div>
                <div class="stat-item">
                    <span>‡¶∏‡ßç‡¶ü‡ßã‡¶∞‡ßá‡¶ú:</span>
                    <span id="storageUsed" class="stat-count">0 MB</span>
                </div>
            </div>
        </div>

        <!-- Tab Navigation -->
        <div class="tab-nav">
            <button class="tab-btn active" onclick="switchTab('gallery')">
                <span>üìÅ</span> ‡¶ó‡ßç‡¶Ø‡¶æ‡¶≤‡¶æ‡¶∞‡¶ø
                <span id="galleryBadge" class="tab-badge d-none">0</span>
            </button>
            <button class="tab-btn" onclick="switchTab('drive')">
                <span>‚òÅÔ∏è</span> ‡¶°‡ßç‡¶∞‡¶æ‡¶á‡¶≠
                <span id="driveBadge" class="tab-badge d-none">0</span>
            </button>
            <button class="tab-btn" onclick="switchTab('settings')">
                <span>‚öôÔ∏è</span> ‡¶∏‡ßá‡¶ü‡¶ø‡¶Ç‡¶∏
            </button>
        </div>

        <!-- Content Area -->
        <div class="content-area">
            <!-- Gallery Tab -->
            <div id="galleryTab" class="tab-content active">
                <div class="gallery-header">
                    <div class="gallery-title">‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶´‡¶æ‡¶á‡¶≤</div>
                    <div class="view-toggle">
                        <button class="view-btn active" onclick="switchView('grid')">‚óº‚óº</button>
                        <button class="view-btn" onclick="switchView('list')">‚ò∞</button>
                    </div>
                </div>

                <div id="emptyGallery" class="empty-state">
                    <div class="empty-icon">üìÅ</div>
                    <div class="empty-text">‡¶ï‡ßã‡¶®‡ßã ‡¶´‡¶æ‡¶á‡¶≤ ‡¶®‡ßá‡¶á</div>
                    <div class="empty-subtext">‡¶´‡¶æ‡¶á‡¶≤ ‡¶Ü‡¶™‡¶≤‡ßã‡¶° ‡¶∂‡ßÅ‡¶∞‡ßÅ ‡¶ï‡¶∞‡ßÅ‡¶® ‡¶Ö‡¶•‡¶¨‡¶æ ‡¶ó‡ßÅ‡¶ó‡¶≤ ‡¶°‡ßç‡¶∞‡¶æ‡¶á‡¶≠ ‡¶•‡ßá‡¶ï‡ßá ‡¶∏‡¶ø‡¶ô‡ßç‡¶ï ‡¶ï‡¶∞‡ßÅ‡¶®</div>
                    <div style="display: flex; gap: 10px; margin-top: 20px;">
                        <button class="btn btn-primary" onclick="openUploadModal()">
                            <span class="btn-icon">üì§</span> ‡¶Ü‡¶™‡¶≤‡ßã‡¶°
                        </button>
                        <button class="btn btn-secondary" onclick="syncDrive()">
                            <span class="btn-icon">üîÑ</span> ‡¶∏‡¶ø‡¶ô‡ßç‡¶ï
                        </button>
                    </div>
                </div>

                <!-- Grid View -->
                <div id="fileGridView" class="file-grid"></div>

                <!-- List View -->
                <div id="fileListView" class="file-list"></div>
            </div>

            <!-- Drive Tab -->
            <div id="driveTab" class="tab-content">
                <div class="drive-status">
                    <div class="drive-header">
                        <div class="drive-icon">‚òÅÔ∏è</div>
                        <div class="drive-info">
                            <h3>‡¶ó‡ßÅ‡¶ó‡¶≤ ‡¶°‡ßç‡¶∞‡¶æ‡¶á‡¶≠</h3>
                            <p id="driveStatusText">‡¶≤‡ßã‡¶° ‡¶π‡¶ö‡ßç‡¶õ‡ßá...</p>
                        </div>
                    </div>
                    
                    <div id="driveOffline" class="d-none">
                        <div style="text-align: center; padding: 20px;">
                            <div style="font-size: 3rem; margin-bottom: 15px;">üì∂</div>
                            <div style="font-weight: 600; margin-bottom: 10px;">‡¶°‡ßç‡¶∞‡¶æ‡¶á‡¶≠ ‡¶Ö‡¶´‡¶≤‡¶æ‡¶á‡¶®</div>
                            <div style="color: var(--text-secondary); margin-bottom: 20px;">
                                ‡¶°‡ßç‡¶∞‡¶æ‡¶á‡¶≠ ‡¶¶‡ßá‡¶ñ‡¶§‡ßá ‡¶á‡¶®‡ßç‡¶ü‡¶æ‡¶∞‡¶®‡ßá‡¶ü ‡¶∏‡¶Ç‡¶Ø‡ßã‡¶ó ‡¶™‡ßç‡¶∞‡¶Ø‡¶º‡ßã‡¶ú‡¶®
                            </div>
                            <button class="btn btn-primary" onclick="checkConnection()">
                                <span class="btn-icon">üîÑ</span> ‡¶∏‡¶Ç‡¶Ø‡ßã‡¶ó ‡¶ö‡ßá‡¶ï ‡¶ï‡¶∞‡ßÅ‡¶®
                            </button>
                        </div>
                    </div>

                    <div id="driveOnline" class="d-none">
                        <div class="drive-stats">
                            <div class="stat-box">
                                <div class="stat-value" id="driveFileCount">0</div>
                                <div class="stat-label">‡¶Æ‡ßã‡¶ü ‡¶´‡¶æ‡¶á‡¶≤</div>
                            </div>
                            <div class="stat-box">
                                <div class="stat-value" id="driveUsed">0 MB</div>
                                <div class="stat-label">‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡ßÉ‡¶§ ‡¶∏‡ßç‡¶ü‡ßã‡¶∞‡ßá‡¶ú</div>
                            </div>
                        </div>
                        
                        <div style="margin-top: 20px;">
                            <button class="btn btn-primary btn-block" onclick="requestDrivePermission()" id="driveConnectBtn">
                                <span class="btn-icon">üîó</span> ‡¶°‡ßç‡¶∞‡¶æ‡¶á‡¶≠ ‡¶∏‡¶Ç‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡ßÅ‡¶®
                            </button>
                            <button class="btn btn-secondary btn-block mt-2" onclick="syncDrive()" id="syncDriveBtn">
                                <span class="btn-icon">üîÑ</span> ‡¶°‡ßç‡¶∞‡¶æ‡¶á‡¶≠ ‡¶∏‡¶ø‡¶ô‡ßç‡¶ï ‡¶ï‡¶∞‡ßÅ‡¶®
                            </button>
                            <button class="btn btn-secondary btn-block mt-2" onclick="viewDriveFolder()">
                                <span class="btn-icon">üìÇ</span> ‡¶°‡ßç‡¶∞‡¶æ‡¶á‡¶≠ ‡¶´‡ßã‡¶≤‡ßç‡¶°‡¶æ‡¶∞ ‡¶¶‡ßá‡¶ñ‡ßÅ‡¶®
                            </button>
                        </div>
                    </div>
                </div>

                <div id="driveFilesContainer"></div>
            </div>

            <!-- Settings Tab -->
            <div id="settingsTab" class="tab-content">
                <div class="settings-section">
                    <div class="settings-title">
                        <span>üîß</span> ‡¶∏‡¶æ‡¶ß‡¶æ‡¶∞‡¶£ ‡¶∏‡ßá‡¶ü‡¶ø‡¶Ç‡¶∏
                    </div>
                    <div class="setting-item">
                        <span>‡¶Ö‡¶ü‡ßã ‡¶∏‡¶ø‡¶ô‡ßç‡¶ï</span>
                        <label class="switch">
                            <input type="checkbox" id="autoSyncToggle" checked>
                            <span class="slider"></span>
                        </label>
                    </div>
                    <div class="setting-item">
                        <span>‡¶Ö‡¶´‡¶≤‡¶æ‡¶á‡¶® ‡¶∏‡¶§‡¶∞‡ßç‡¶ï‡¶§‡¶æ</span>
                        <label class="switch">
                            <input type="checkbox" id="offlineWarningToggle" checked>
                            <span class="slider"></span>
                        </label>
                    </div>
                    <div class="setting-item">
                        <span>‡¶´‡¶æ‡¶á‡¶≤ ‡¶™‡ßç‡¶∞‡¶ø‡¶≠‡¶ø‡¶â</span>
                        <label class="switch">
                            <input type="checkbox" id="filePreviewToggle" checked>
                            <span class="slider"></span>
                        </label>
                    </div>
                </div>

                <div class="settings-section">
                    <div class="settings-title">
                        <span>‚ö†Ô∏è</span> ‡¶ó‡ßÅ‡¶ó‡¶≤ ‡¶∏‡¶§‡¶∞‡ßç‡¶ï‡¶§‡¶æ ‡¶¨‡ßç‡¶Ø‡¶æ‡¶ñ‡ßç‡¶Ø‡¶æ
                    </div>
                    <div style="padding: 15px; background: rgba(245, 158, 11, 0.1); border-radius: 10px; margin-top: 10px;">
                        <div style="font-weight: 600; margin-bottom: 8px;">‡¶ó‡ßÅ‡¶ó‡¶≤ File Access Warning ‡¶∏‡¶Æ‡ßç‡¶™‡¶∞‡ßç‡¶ï‡ßá:</div>
                        <div style="font-size: 0.85rem; color: var(--text-secondary); line-height: 1.5;">
                            ‚úÖ <strong>‡¶è‡¶ü‡¶ø ‡¶∏‡¶æ‡¶ß‡¶æ‡¶∞‡¶£ ‡¶¨‡ßç‡¶Ø‡¶æ‡¶™‡¶æ‡¶∞:</strong> ‡¶ó‡ßÅ‡¶ó‡¶≤ ‡¶®‡¶ø‡¶∞‡¶æ‡¶™‡¶§‡ßç‡¶§‡¶æ‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶è‡¶á ‡¶∏‡¶§‡¶∞‡ßç‡¶ï‡¶§‡¶æ ‡¶¶‡ßá‡¶ñ‡¶æ‡ßü<br>
                            ‚úÖ <strong>‡¶∏‡ßÄ‡¶Æ‡¶ø‡¶§ ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶ï‡ßç‡¶∏‡ßá‡¶∏:</strong> ‡¶∂‡ßÅ‡¶ß‡ßÅ‡¶Æ‡¶æ‡¶§‡ßç‡¶∞ ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶®‡¶ø‡¶∞‡ßç‡¶¨‡¶æ‡¶ö‡¶ø‡¶§ ‡¶´‡¶æ‡¶á‡¶≤ ‡¶è‡¶ï‡ßç‡¶∏‡ßá‡¶∏ ‡¶ï‡¶∞‡¶æ ‡¶π‡¶¨‡ßá<br>
                            ‚úÖ <strong>‡¶∏‡¶Æ‡ßç‡¶™‡ßÇ‡¶∞‡ßç‡¶£ ‡¶°‡ßç‡¶∞‡¶æ‡¶á‡¶≠ ‡¶®‡ßü:</strong> ‡¶∏‡¶Æ‡ßç‡¶™‡ßÇ‡¶∞‡ßç‡¶£ ‡¶°‡ßç‡¶∞‡¶æ‡¶á‡¶≠ ‡¶è‡¶ï‡ßç‡¶∏‡ßá‡¶∏ ‡¶¶‡ßá‡¶ì‡ßü‡¶æ ‡¶π‡¶¨‡ßá ‡¶®‡¶æ<br>
                            ‚úÖ <strong>‡¶®‡¶ø‡¶∞‡ßç‡¶¶‡¶ø‡¶∑‡ßç‡¶ü ‡¶´‡ßã‡¶≤‡ßç‡¶°‡¶æ‡¶∞:</strong> ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶´‡¶æ‡¶á‡¶≤ ‡¶∂‡ßÅ‡¶ß‡ßÅ‡¶Æ‡¶æ‡¶§‡ßç‡¶∞ "Hybrid Vault" ‡¶´‡ßã‡¶≤‡ßç‡¶°‡¶æ‡¶∞‡ßá ‡¶∏‡¶Ç‡¶∞‡¶ï‡ßç‡¶∑‡¶ø‡¶§ ‡¶π‡¶¨‡ßá<br>
                            ‚úÖ <strong>‡¶è‡¶®‡¶ï‡ßç‡¶∞‡¶ø‡¶™‡ßç‡¶ü‡ßá‡¶° ‡¶°‡¶æ‡¶ü‡¶æ:</strong> ‡¶∏‡¶¨ ‡¶´‡¶æ‡¶á‡¶≤ ‡¶è‡¶®‡¶ï‡ßç‡¶∞‡¶ø‡¶™‡ßç‡¶ü‡ßá‡¶° ‡¶Ö‡¶¨‡¶∏‡ßç‡¶•‡¶æ‡ßü ‡¶Ü‡¶™‡¶≤‡ßã‡¶° ‡¶π‡¶¨‡ßá<br>
                            ‚úÖ <strong>‡¶ï‡ßã‡¶®‡ßã ‡¶°‡¶æ‡¶ü‡¶æ ‡¶∂‡ßá‡ßü‡¶æ‡¶∞ ‡¶®‡ßü:</strong> ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶´‡¶æ‡¶á‡¶≤ ‡¶ï‡¶ñ‡¶®‡ßã ‡¶Ö‡¶®‡ßç‡¶Ø ‡¶ï‡¶æ‡¶∞‡ßã ‡¶∏‡¶æ‡¶•‡ßá ‡¶∂‡ßá‡ßü‡¶æ‡¶∞ ‡¶ï‡¶∞‡¶æ ‡¶π‡¶¨‡ßá ‡¶®‡¶æ
                        </div>
                    </div>
                </div>

                <div class="settings-section">
                    <div class="settings-title">
                        <span>üîí</span> ‡¶∏‡¶ø‡¶ï‡¶ø‡¶â‡¶∞‡¶ø‡¶ü‡¶ø
                    </div>
                    <div class="setting-item">
                        <span>PIN ‡¶™‡¶∞‡¶ø‡¶¨‡¶∞‡ßç‡¶§‡¶®</span>
                        <button class="btn btn-secondary" onclick="changePin()" style="padding: 6px 12px;">
                            ‡¶™‡¶∞‡¶ø‡¶¨‡¶∞‡ßç‡¶§‡¶®
                        </button>
                    </div>
                    <div class="setting-item">
                        <span>‡¶Ö‡¶ü‡ßã ‡¶≤‡¶ó‡¶Ü‡¶â‡¶ü</span>
                        <select id="autoLogoutSelect" class="btn-secondary" style="padding: 4px 8px; background: var(--surface); color: var(--text); border: 1px solid var(--border); border-radius: 6px;">
                            <option value="0">‡¶¨‡¶®‡ßç‡¶ß</option>
                            <option value="5">5 ‡¶Æ‡¶ø‡¶®‡¶ø‡¶ü</option>
                            <option value="15" selected>15 ‡¶Æ‡¶ø‡¶®‡¶ø‡¶ü</option>
                            <option value="30">30 ‡¶Æ‡¶ø‡¶®‡¶ø‡¶ü</option>
                            <option value="60">1 ‡¶ò‡¶£‡ßç‡¶ü‡¶æ</option>
                        </select>
                    </div>
                    <div class="setting-item">
                        <span>‡¶°‡¶æ‡¶ü‡¶æ ‡¶ï‡ßç‡¶≤‡¶ø‡¶Ø‡¶º‡¶æ‡¶∞</span>
                        <button class="btn btn-danger" onclick="clearLocalData()" style="padding: 6px 12px;">
                            ‡¶ï‡ßç‡¶≤‡¶ø‡¶Ø‡¶º‡¶æ‡¶∞
                        </button>
                    </div>
                </div>

                <div class="settings-section">
                    <div class="settings-title">
                        <span>‚ÑπÔ∏è</span> ‡¶§‡¶•‡ßç‡¶Ø
                    </div>
                    <div class="setting-item">
                        <span>‡¶Ö‡ßç‡¶Ø‡¶æ‡¶™ ‡¶≠‡¶æ‡¶∞‡ßç‡¶∏‡¶®</span>
                        <span>v2.0.0</span>
                    </div>
                    <div class="setting-item">
                        <span>‡¶≤‡¶ó‡¶á‡¶® ‡¶Ö‡¶¨‡¶∏‡ßç‡¶•‡¶æ</span>
                        <span id="loginStatus">‡¶Ö‡¶´‡¶≤‡¶æ‡¶á‡¶®</span>
                    </div>
                    <div class="setting-item">
                        <span>‡¶°‡ßç‡¶∞‡¶æ‡¶á‡¶≠ ‡¶∏‡¶Ç‡¶Ø‡ßã‡¶ó</span>
                        <span id="driveStatus">‡¶∏‡¶Ç‡¶Ø‡ßã‡¶ó ‡¶®‡ßá‡¶á</span>
                    </div>
                    <div class="setting-item">
                        <span>‡¶∏‡¶∞‡ßç‡¶¨‡¶∂‡ßá‡¶∑ ‡¶∏‡¶ø‡¶ô‡ßç‡¶ï</span>
                        <span id="lastSync">‡¶ï‡¶ñ‡¶®‡ßã ‡¶®‡¶æ</span>
                    </div>
                    <div class="setting-item">
                        <span>‡¶ü‡ßã‡¶ü‡¶æ‡¶≤ ‡¶Ü‡¶™‡¶≤‡ßã‡¶°</span>
                        <span id="totalUploads">0 ‡¶´‡¶æ‡¶á‡¶≤</span>
                    </div>
                </div>

                <div style="text-align: center; margin-top: 30px;">
                    <button class="btn btn-secondary" onclick="logout()">
                        <span class="btn-icon">üö™</span> ‡¶≤‡¶ó‡¶Ü‡¶â‡¶ü
                    </button>
                </div>
            </div>
        </div>

        <!-- Upload FAB -->
        <div class="upload-fab" onclick="openUploadModal()">
            <span>+</span>
        </div>

        <!-- Bottom Nav -->
        <div class="bottom-nav">
            <div class="nav-item active" onclick="switchNav('gallery')">
                <div class="nav-icon">üìÅ</div>
                <div class="nav-text">‡¶ó‡ßç‡¶Ø‡¶æ‡¶≤‡¶æ‡¶∞‡¶ø</div>
            </div>
            <div class="nav-item" onclick="switchNav('upload')">
                <div class="nav-icon">üì§</div>
                <div class="nav-text">‡¶Ü‡¶™‡¶≤‡ßã‡¶°</div>
            </div>
            <div class="nav-item" onclick="switchNav('sync')">
                <div class="nav-icon">üîÑ</div>
                <div class="nav-text">‡¶∏‡¶ø‡¶ô‡ßç‡¶ï</div>
                <div id="syncBadge" class="nav-badge d-none">0</div>
            </div>
            <div class="nav-item" onclick="switchNav('profile')">
                <div class="nav-icon">üë§</div>
                <div class="nav-text">‡¶™‡ßç‡¶∞‡ßã‡¶´‡¶æ‡¶á‡¶≤</div>
            </div>
        </div>
    </div>

    <!-- Upload Modal -->
    <div id="uploadModal" class="modal-overlay">
        <div class="modal">
            <div class="modal-header">
                <div class="modal-title">‡¶´‡¶æ‡¶á‡¶≤ ‡¶Ü‡¶™‡¶≤‡ßã‡¶°</div>
                <button class="modal-close" onclick="closeUploadModal()">√ó</button>
            </div>
            <div class="modal-body">
                <!-- Upload Options -->
                <div class="upload-options">
                    <div class="upload-option selected" onclick="selectUploadType('single')">
                        <div class="upload-icon">üìÑ</div>
                        <div class="upload-name">‡¶è‡¶ï‡¶ü‡¶ø ‡¶´‡¶æ‡¶á‡¶≤</div>
                        <div class="upload-desc">‡¶è‡¶ï‡¶ü‡¶ø ‡¶´‡¶æ‡¶á‡¶≤ ‡¶∏‡¶ø‡¶≤‡ßá‡¶ï‡ßç‡¶ü ‡¶ï‡¶∞‡ßÅ‡¶®</div>
                    </div>
                    <div class="upload-option" onclick="selectUploadType('multiple')">
                        <div class="upload-icon">üìë</div>
                        <div class="upload-name">‡¶è‡¶ï‡¶æ‡¶ß‡¶ø‡¶ï ‡¶´‡¶æ‡¶á‡¶≤</div>
                        <div class="upload-desc">‡¶¨‡¶π‡ßÅ ‡¶´‡¶æ‡¶á‡¶≤ ‡¶∏‡¶ø‡¶≤‡ßá‡¶ï‡ßç‡¶ü ‡¶ï‡¶∞‡ßÅ‡¶®</div>
                    </div>
                    <div class="upload-option" onclick="selectUploadType('folder')">
                        <div class="upload-icon">üìÅ</div>
                        <div class="upload-name">‡¶´‡ßã‡¶≤‡ßç‡¶°‡¶æ‡¶∞</div>
                        <div class="upload-desc">‡¶∏‡¶Æ‡ßç‡¶™‡ßÇ‡¶∞‡ßç‡¶£ ‡¶´‡ßã‡¶≤‡ßç‡¶°‡¶æ‡¶∞</div>
                    </div>
                    <div class="upload-option" onclick="selectUploadType('camera')">
                        <div class="upload-icon">üì∑</div>
                        <div class="upload-name">‡¶ï‡ßç‡¶Ø‡¶æ‡¶Æ‡ßá‡¶∞‡¶æ</div>
                        <div class="upload-desc">‡¶∏‡¶∞‡¶æ‡¶∏‡¶∞‡¶ø ‡¶ï‡ßç‡¶Ø‡¶æ‡¶Æ‡ßá‡¶∞‡¶æ ‡¶•‡ßá‡¶ï‡ßá</div>
                    </div>
                </div>

                <!-- File Drop Area -->
                <div class="file-drop-area" id="fileDropArea" onclick="triggerFileInput()">
                    <div class="file-drop-icon">üìÇ</div>
                    <div class="upload-name">‡¶´‡¶æ‡¶á‡¶≤ ‡¶∏‡¶ø‡¶≤‡ßá‡¶ï‡ßç‡¶ü ‡¶ï‡¶∞‡ßÅ‡¶®</div>
                    <div class="upload-desc">‡¶ü‡ßç‡¶Ø‡¶æ‡¶™ ‡¶ï‡¶∞‡ßá ‡¶´‡¶æ‡¶á‡¶≤ ‡¶¨‡¶æ‡¶õ‡¶æ‡¶á ‡¶ï‡¶∞‡ßÅ‡¶®</div>
                    <input type="file" id="fileInput" class="file-input" multiple>
                    <input type="file" id="folderInput" class="file-input d-none" webkitdirectory directory multiple>
                    <input type="file" id="cameraInput" class="file-input d-none" accept="image/*" capture="environment">
                </div>

                <!-- Encryption Toggle -->
                <div class="encryption-toggle" id="encryptionToggle" style="display: none;">
                    <div class="toggle-label">
                        <span class="btn-icon">üîí</span>
                        <span>‡¶´‡¶æ‡¶á‡¶≤ ‡¶è‡¶®‡¶ï‡ßç‡¶∞‡¶ø‡¶™‡ßç‡¶ü ‡¶ï‡¶∞‡ßÅ‡¶®</span>
                    </div>
                    <label class="toggle-switch">
                        <input type="checkbox" id="encryptToggle" checked>
                        <span class="toggle-slider"></span>
                    </label>
                </div>

                <!-- Selected Files -->
                <div id="selectedFiles" class="selected-files">
                    <div style="font-weight: 600; margin-bottom: 10px;">‡¶∏‡¶ø‡¶≤‡ßá‡¶ï‡ßç‡¶ü‡ßá‡¶° ‡¶´‡¶æ‡¶á‡¶≤</div>
                    <div id="fileList"></div>
                </div>

                <!-- Progress -->
                <div class="progress-container" id="uploadProgress">
                    <div class="progress-header">
                        <span id="progressText">‡¶™‡ßç‡¶∞‡¶∏‡ßç‡¶§‡ßÅ‡¶§...</span>
                        <span id="progressPercent">0%</span>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill" id="progressFill"></div>
                    </div>
                </div>

                <!-- Actions -->
                <div style="display: flex; gap: 10px; margin-top: 20px;">
                    <button class="btn btn-primary btn-block" onclick="startUpload()" id="startUploadBtn">
                        <span class="btn-icon">üíæ</span> ‡¶´‡¶æ‡¶á‡¶≤ ‡¶∏‡ßá‡¶≠ ‡¶ï‡¶∞‡ßÅ‡¶®
                    </button>
                    <button class="btn btn-secondary" onclick="closeUploadModal()" style="padding: 0 20px;">
                        ‡¶¨‡¶æ‡¶§‡¶ø‡¶≤
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- File Preview Modal -->
    <div id="filePreviewModal" class="modal-overlay">
        <div class="modal">
            <div class="modal-header">
                <div class="modal-title" id="previewFileName">‡¶´‡¶æ‡¶á‡¶≤ ‡¶™‡ßç‡¶∞‡¶ø‡¶≠‡¶ø‡¶â</div>
                <button class="modal-close" onclick="closePreviewModal()">√ó</button>
            </div>
            <div class="modal-body">
                <div id="previewContent" style="text-align: center;">
                    <div id="previewLoading" class="empty-state">
                        <div class="empty-icon">‚è≥</div>
                        <div class="empty-text">‡¶´‡¶æ‡¶á‡¶≤ ‡¶≤‡ßã‡¶° ‡¶π‡¶ö‡ßç‡¶õ‡ßá...</div>
                    </div>
                </div>
                <div style="display: flex; gap: 10px; margin-top: 20px;">
                    <button class="btn btn-primary btn-block" onclick="downloadFile()">
                        <span class="btn-icon">üì•</span> ‡¶°‡¶æ‡¶â‡¶®‡¶≤‡ßã‡¶°
                    </button>
                    <button class="btn btn-secondary" onclick="shareFile()">
                        <span class="btn-icon">‚ÜóÔ∏è</span> ‡¶∂‡ßá‡¶Ø‡¶º‡¶æ‡¶∞
                    </button>
                    <button class="btn btn-danger" onclick="deleteFile()">
                        <span class="btn-icon">üóëÔ∏è</span> ‡¶°‡¶ø‡¶≤‡¶ø‡¶ü
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Toast Container -->
    <div class="toast-container" id="toastContainer"></div>

    <script>
        // ================================================
        // CONFIGURATION - ‡¶∏‡¶¨ API ‡¶ì ‡¶≤‡¶ø‡¶Ç‡¶ï‡¶∏‡¶π
        // ================================================
        const CONFIG = {
            // Firebase Configuration
            firebase: {
                apiKey: "AIzaSyB3Iy1MIbfmJ7h5rv9NlsT23ysedCwUZt4",
                authDomain: "encrypted-vault-4683d.firebaseapp.com",
                projectId: "encrypted-vault-4683d",
                storageBucket: "encrypted-vault-4683d.appspot.com",
                messagingSenderId: "851257263743",
                appId: "1:851257263743:web:e0d16606bd06f692f5e14a"
            },
            
            // Google Apps Script URL (‡¶®‡¶§‡ßÅ‡¶®)
            googleAppsScript: {
                deploymentUrl: "https://script.google.com/macros/s/AKfycbxItLlQHW0NEhhgGedLOxQQFPIdVEqYlGILa2Pd6Rei_kGzpSm67l5mAO3oIJhKvdzEjQ/exec"
            },
            
            // Google Drive Configuration
            googleDrive: {
                folderId: "1zIyinAqjQv96QBSuanFS2F0USaG66GPn",
                folderLink: "https://drive.google.com/drive/folders/1zIyinAqjQv96QBSuanFS2F0USaG66GPn",
                apiKey: "AIzaSyB3Iy1MIbfmJ7h5rv9NlsT23ysedCwUZt4"
            },
            
            // Google OAuth 2.0 Client ID
            googleClientId: "318681315152-65e9kofptt4c3bk3kmlj9gmksnasu347.apps.googleusercontent.com",
            
            // App Information
            appName: "Hybrid Vault",
            version: "2.0.0",
            author: "Hybrid Vault Team",
            
            // Security Settings
            maxFileSize: 100 * 1024 * 1024, // 100MB
            pinLength: 4,
            encryptionAlgorithm: "AES-GCM",
            
            // Toast Notification Settings
            toastDuration: 3000,
            toastPosition: "bottom-left",
            
            // Sync Settings
            autoSyncInterval: 30000, // 30 seconds
            maxRetryAttempts: 3,
            
            // UI Settings
            defaultView: "grid",
            theme: "dark",
            
            // Backup URLs (‡¶¨‡¶ø‡¶ï‡¶≤‡ßç‡¶™ API endpoints)
            backupUrls: {
                appsScript: "https://script.google.com/macros/s/AKfycbxItLlQHW0NEhhgGedLOxQQFPIdVEqYlGILa2Pd6Rei_kGzpSm67l5mAO3oIJhKvdzEjQ/exec",
                driveApi: "https://www.googleapis.com/drive/v3"
            },
            
            // Support Information
            support: {
                email: "support@hybridvault.com",
                website: "https://hybridvault.com",
                documentation: "https://docs.hybridvault.com"
            }
        };

        // ================================================
        // GLOBAL VARIABLES
        // ================================================
        let db, auth, currentUser;
        let currentPIN = '';
        let isOnline = navigator.onLine;
        let isGoogleLoggedIn = false;
        let selectedFiles = [];
        let uploadType = 'single';
        let syncQueue = [];
        let tokenClient;
        let driveAccessToken = '';
        let gapiInitialized = false;
        let isOfflineMode = false;
        let currentPINDigits = [];
        let currentFileView = 'grid';
        let totalUploads = 0;
        let autoLogoutTimer = null;
        let selectedFileForPreview = null;
        let encryptionEnabled = true;

        // ================================================
        // TOAST NOTIFICATION SYSTEM - ‡¶¨‡¶ø‡¶∏‡ßç‡¶§‡¶æ‡¶∞‡¶ø‡¶§ ‡¶¨‡ßç‡¶Ø‡¶æ‡¶ñ‡ßç‡¶Ø‡¶æ
        // ================================================
        /*
        Toast Notification System ‡¶ï‡¶æ‡¶ú:
        1. ‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡¶æ‡¶∞‡¶ï‡¶æ‡¶∞‡ßÄ‡¶ï‡ßá ‡¶∞‡¶ø‡¶Ø‡¶º‡ßá‡¶≤-‡¶ü‡¶æ‡¶á‡¶Æ ‡¶´‡¶ø‡¶°‡¶¨‡ßç‡¶Ø‡¶æ‡¶ï ‡¶¶‡ßá‡¶ì‡¶Ø‡¶º‡¶æ
        2. ‡¶Ö‡¶™‡¶æ‡¶∞‡ßá‡¶∂‡¶®‡ßá‡¶∞ ‡¶∏‡ßç‡¶ü‡ßç‡¶Ø‡¶æ‡¶ü‡¶æ‡¶∏ ‡¶ú‡¶æ‡¶®‡¶æ‡¶®‡ßã (‡¶∏‡¶´‡¶≤/‡¶¨‡ßç‡¶Ø‡¶∞‡ßç‡¶•/‡¶∏‡¶§‡¶∞‡ßç‡¶ï‡¶§‡¶æ)
        3. ‡¶®‡ßá‡¶ü‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶ï ‡¶∏‡¶Ç‡¶Ø‡ßã‡¶ó‡ßá‡¶∞ ‡¶™‡¶∞‡¶ø‡¶¨‡¶∞‡ßç‡¶§‡¶® ‡¶ú‡¶æ‡¶®‡¶æ‡¶®‡ßã
        4. ‡¶´‡¶æ‡¶á‡¶≤ ‡¶Ö‡¶™‡¶æ‡¶∞‡ßá‡¶∂‡¶®‡ßá‡¶∞ ‡¶™‡ßç‡¶∞‡¶ó‡ßç‡¶∞‡ßá‡¶∏ ‡¶¶‡ßá‡¶ñ‡¶æ‡¶®‡ßã
        5. ‡¶§‡ßç‡¶∞‡ßÅ‡¶ü‡¶ø ‡¶¨‡¶æ‡¶∞‡ßç‡¶§‡¶æ ‡¶™‡ßç‡¶∞‡¶¶‡¶∞‡ßç‡¶∂‡¶® ‡¶ï‡¶∞‡¶æ
        6. ‡¶∏‡¶´‡¶≤ ‡¶Ö‡¶™‡¶æ‡¶∞‡ßá‡¶∂‡¶® ‡¶®‡ßã‡¶ü‡¶ø‡¶´‡¶ø‡¶ï‡ßá‡¶∂‡¶® ‡¶¶‡ßá‡¶ì‡¶Ø‡¶º‡¶æ
        
        Toast Types:
        - success: ‡¶∏‡¶¨‡ßÅ‡¶ú ‡¶∞‡¶ô, ‡¶∏‡¶´‡¶≤ ‡¶Ö‡¶™‡¶æ‡¶∞‡ßá‡¶∂‡¶®‡ßá‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø
        - error: ‡¶≤‡¶æ‡¶≤ ‡¶∞‡¶ô, ‡¶§‡ßç‡¶∞‡ßÅ‡¶ü‡¶ø‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø
        - warning: ‡¶π‡¶≤‡ßÅ‡¶¶ ‡¶∞‡¶ô, ‡¶∏‡¶§‡¶∞‡ßç‡¶ï‡¶§‡¶æ‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø
        - info: ‡¶®‡ßÄ‡¶≤ ‡¶∞‡¶ô, ‡¶∏‡¶æ‡¶ß‡¶æ‡¶∞‡¶£ ‡¶§‡¶•‡ßç‡¶Ø‡ßá‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø
        */

        function showToast(message, type = 'info', duration = CONFIG.toastDuration) {
            const toastContainer = document.getElementById('toastContainer');
            const toastId = 'toast-' + Date.now();
            
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            toast.id = toastId;
            
            const icon = type === 'success' ? '‚úÖ' : 
                         type === 'error' ? '‚ùå' : 
                         type === 'warning' ? '‚ö†Ô∏è' : '‚ÑπÔ∏è';
            
            toast.innerHTML = `
                <div class="toast-icon">${icon}</div>
                <div class="toast-content">
                    <div class="toast-title">${getToastTitle(type)}</div>
                    <div class="toast-message">${message}</div>
                </div>
                <button class="toast-close" onclick="document.getElementById('${toastId}').remove()" style="background: none; border: none; color: var(--text-secondary); font-size: 1.2rem; cursor: pointer;">√ó</button>
            `;
            
            toastContainer.appendChild(toast);
            
            // Log toast for debugging
            console.log(`[TOAST ${type.toUpperCase()}] ${message}`);
            
            // Remove after duration
            setTimeout(() => {
                if (document.getElementById(toastId)) {
                    toast.style.animation = 'toastIn 0.5s cubic-bezier(0.68, -0.55, 0.265, 1.55) reverse forwards';
                    setTimeout(() => {
                        if (toast.parentNode) toast.remove();
                    }, 500);
                }
            }, duration);
        }

        function getToastTitle(type) {
            const titles = {
                'success': '‡¶∏‡¶´‡¶≤ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá',
                'error': '‡¶§‡ßç‡¶∞‡ßÅ‡¶ü‡¶ø ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá',
                'warning': '‡¶∏‡¶§‡¶∞‡ßç‡¶ï‡¶§‡¶æ',
                'info': '‡¶§‡¶•‡ßç‡¶Ø'
            };
            return titles[type] || '‡¶®‡ßã‡¶ü‡¶ø‡¶´‡¶ø‡¶ï‡ßá‡¶∂‡¶®';
        }

        // ================================================
        // INITIALIZATION
        // ================================================
        document.addEventListener('DOMContentLoaded', async () => {
            showToast('Hybrid Vault ‡¶≤‡ßã‡¶° ‡¶π‡¶ö‡ßç‡¶õ‡ßá...', 'info');
            
            try {
                // Firebase ‡¶á‡¶®‡¶ø‡¶∂‡¶ø‡¶Ø‡¶º‡¶æ‡¶≤‡¶æ‡¶á‡¶ú‡ßá‡¶∂‡¶®
                showToast('Firebase ‡¶∏‡¶Ç‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡¶æ ‡¶π‡¶ö‡ßç‡¶õ‡ßá...', 'info');
                const app = firebase.initializeApp(CONFIG.firebase);
                auth = firebase.auth();
                db = firebase.firestore();
                
                // Offline persistence ‡¶∏‡¶ï‡ßç‡¶∞‡¶ø‡¶Ø‡¶º ‡¶ï‡¶∞‡ßÅ‡¶®
                await db.enablePersistence({ synchronizeTabs: true });
                
                // Auth state observer
                auth.onAuthStateChanged(handleAuthState);
                
                // Network status monitoring
                updateConnectionStatus();
                window.addEventListener('online', handleOnline);
                window.addEventListener('offline', handleOffline);
                
                // Saved PIN ‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡ßÅ‡¶®
                loadSavedPIN();
                
                // Event listeners ‡¶∏‡ßá‡¶ü‡¶Ü‡¶™
                setupEventListeners();
                
                // Keypad ‡¶∏‡ßá‡¶ü‡¶Ü‡¶™
                setupKeypad();
                
                // Pending uploads ‡¶ö‡ßá‡¶ï ‡¶ï‡¶∞‡ßÅ‡¶®
                checkPendingUploads();
                
                // Auto logout timer ‡¶∏‡ßá‡¶ü‡¶Ü‡¶™
                setupAutoLogout();
                
                showToast('Hybrid Vault ‡¶™‡ßç‡¶∞‡¶∏‡ßç‡¶§‡ßÅ‡¶§!', 'success');
                
            } catch (error) {
                console.error('Initialization error:', error);
                showToast(`‡¶Ö‡ßç‡¶Ø‡¶æ‡¶™ ‡¶≤‡ßã‡¶° ‡¶¨‡ßç‡¶Ø‡¶∞‡ßç‡¶•: ${error.message}`, 'error');
                
                // Firebase error analysis
                if (error.code === 'failed-precondition') {
                    showToast('‡¶¨‡ßç‡¶∞‡¶æ‡¶â‡¶ú‡¶æ‡¶∞ Firebase ‡¶∏‡¶Æ‡¶∞‡ßç‡¶•‡¶® ‡¶ï‡¶∞‡ßá ‡¶®‡¶æ‡•§ Chrome ‡¶¨‡¶æ Firefox ‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡¶æ‡¶∞ ‡¶ï‡¶∞‡ßÅ‡¶®‡•§', 'error');
                } else if (error.code === 'unavailable') {
                    showToast('Firebase ‡¶∏‡¶æ‡¶∞‡ßç‡¶≠‡¶æ‡¶∞ unavailable‡•§ ‡¶™‡¶∞‡ßá ‡¶ö‡ßá‡¶∑‡ßç‡¶ü‡¶æ ‡¶ï‡¶∞‡ßÅ‡¶®‡•§', 'warning');
                }
            }
        });

        // ================================================
        // PIN MANAGEMENT WITH KEYPAD
        // ================================================
        function setupKeypad() {
            const keys = document.querySelectorAll('.key');
            keys.forEach(key => {
                key.addEventListener('click', handleKeyPress);
                key.addEventListener('touchstart', handleKeyPress);
            });
        }

        function handleKeyPress(e) {
            e.preventDefault();
            const key = e.currentTarget.getAttribute('data-key');
            
            // Haptic feedback for mobile
            if (navigator.vibrate) navigator.vibrate(50);
            
            if (key === 'backspace') {
                if (currentPINDigits.length > 0) {
                    currentPINDigits.pop();
                    updatePinDisplay();
                    showToast('‡¶è‡¶ï‡¶ü‡¶ø ‡¶°‡¶ø‡¶ú‡¶ø‡¶ü ‡¶Æ‡ßÅ‡¶õ‡ßá ‡¶´‡ßá‡¶≤‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá', 'info', 1000);
                }
            } else if (key === 'clear') {
                currentPINDigits = [];
                updatePinDisplay();
                showToast('‡¶∏‡¶ï‡¶≤ ‡¶°‡¶ø‡¶ú‡¶ø‡¶ü ‡¶Æ‡ßÅ‡¶õ‡ßá ‡¶´‡ßá‡¶≤‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá', 'warning', 1000);
            } else if (currentPINDigits.length < 4) {
                currentPINDigits.push(key);
                updatePinDisplay();
                
                // Check if PIN is complete
                if (currentPINDigits.length === 4) {
                    currentPIN = currentPINDigits.join('');
                    showToast('PIN ‡¶∏‡ßá‡¶ü ‡¶∏‡¶Æ‡ßç‡¶™‡ßÇ‡¶∞‡ßç‡¶£!', 'success');
                    showLoginOptions();
                }
            } else {
                showToast('PIN ‡¶∏‡¶Æ‡ßç‡¶™‡ßÇ‡¶∞‡ßç‡¶£ (‡ß™ ‡¶°‡¶ø‡¶ú‡¶ø‡¶ü)', 'warning', 1000);
            }
        }

        function updatePinDisplay() {
            const dots = document.querySelectorAll('.pin-dot');
            
            dots.forEach((dot, index) => {
                if (index < currentPINDigits.length) {
                    dot.classList.add('filled');
                } else {
                    dot.classList.remove('filled');
                }
            });
        }

        function loadSavedPIN() {
            const savedPIN = localStorage.getItem('vault_pin');
            if (savedPIN) {
                currentPIN = savedPIN;
                showToast('‡¶™‡ßÇ‡¶∞‡ßç‡¶¨‡¶¨‡¶∞‡ßç‡¶§‡ßÄ PIN ‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá', 'info');
            }
        }

        function showLoginOptions() {
            const loginOptions = document.getElementById('loginOptions');
            loginOptions.style.display = 'block';
            loginOptions.style.animation = 'fadeIn 0.5s ease';
            
            // Enable Google login button
            document.getElementById('googleLoginBtn').disabled = false;
            document.getElementById('offlineModeBtn').disabled = false;
        }

        // ================================================
        // GOOGLE FILE ACCESS WARNING - ‡¶¨‡¶ø‡¶∏‡ßç‡¶§‡¶æ‡¶∞‡¶ø‡¶§ ‡¶¨‡ßç‡¶Ø‡¶æ‡¶ñ‡ßç‡¶Ø‡¶æ
        // ================================================
        /*
        Google File Access Warning ‡¶ï‡ßá‡¶® ‡¶¶‡ßá‡¶ñ‡¶æ‡¶Ø‡¶º:
        
        ‡ßß. Google ‡¶è‡¶∞ ‡¶®‡¶ø‡¶∞‡¶æ‡¶™‡¶§‡ßç‡¶§‡¶æ ‡¶®‡ßÄ‡¶§‡¶ø:
        - Google ‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡¶æ‡¶∞‡¶ï‡¶æ‡¶∞‡ßÄ‡¶∞ ‡¶°‡ßá‡¶ü‡¶æ ‡¶∏‡ßÅ‡¶∞‡¶ï‡ßç‡¶∑‡¶æ‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø Strict Policy ‡¶Æ‡ßá‡¶®‡ßá ‡¶ö‡¶≤‡ßá
        - ‡¶Ø‡ßá‡¶ï‡ßã‡¶®‡ßã ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶™ ‡¶Ø‡ßá‡¶ü‡¶æ Google Drive ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶ï‡ßç‡¶∏‡ßá‡¶∏ ‡¶ï‡¶∞‡¶§‡ßá ‡¶ö‡¶æ‡¶Ø‡¶º, ‡¶§‡¶æ‡¶ï‡ßá ‡¶∏‡ßç‡¶™‡¶∑‡ßç‡¶ü Permission ‡¶®‡¶ø‡¶§‡ßá ‡¶π‡¶Ø‡¶º
        
        ‡ß®. ‡¶Ü‡¶Æ‡¶æ‡¶¶‡ßá‡¶∞ ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶™‡ßá‡¶∞ Permission Scope:
        - https://www.googleapis.com/auth/drive.file
        - ‡¶è‡¶á Scope ‡¶∂‡ßÅ‡¶ß‡ßÅ‡¶Æ‡¶æ‡¶§‡ßç‡¶∞ App-created files ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶ï‡ßç‡¶∏‡ßá‡¶∏ ‡¶ï‡¶∞‡¶§‡ßá ‡¶¶‡ßá‡¶Ø‡¶º
        - ‡¶∏‡¶Æ‡ßç‡¶™‡ßÇ‡¶∞‡ßç‡¶£ Drive ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶ï‡ßç‡¶∏‡ßá‡¶∏ ‡¶®‡¶Ø‡¶º
        
        ‡ß©. User Experience ‡¶â‡¶®‡ßç‡¶®‡¶§ ‡¶ï‡¶∞‡¶æ‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø:
        - ‡¶Ü‡¶Æ‡¶∞‡¶æ Settings ‡¶ü‡ßç‡¶Ø‡¶æ‡¶¨‡ßá ‡¶¨‡¶ø‡¶∏‡ßç‡¶§‡¶æ‡¶∞‡¶ø‡¶§ ‡¶¨‡ßç‡¶Ø‡¶æ‡¶ñ‡ßç‡¶Ø‡¶æ ‡¶¶‡¶ø‡¶Ø‡¶º‡ßá‡¶õ‡¶ø
        - User ‡¶ï‡ßá ‡¶Ü‡¶∂‡ßç‡¶¨‡¶∏‡ßç‡¶§ ‡¶ï‡¶∞‡¶ø ‡¶Ø‡ßá ‡¶§‡¶æ‡¶¶‡ßá‡¶∞ ‡¶°‡ßá‡¶ü‡¶æ ‡¶∏‡ßÅ‡¶∞‡¶ï‡ßç‡¶∑‡¶ø‡¶§
        
        ‡ß™. Security Best Practices:
        - Limited scope request ‡¶ï‡¶∞‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá
        - Specific folder ‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡¶æ‡¶∞ ‡¶ï‡¶∞‡¶æ ‡¶π‡¶ö‡ßç‡¶õ‡ßá
        - Encryption before upload
        - No data sharing with third parties
        
        ‡ß´. Warning Message ‡¶è‡¶∞ ‡¶ï‡¶æ‡¶∞‡¶£:
        - "This app wants to access your Google Drive"
        - ‡¶è‡¶ü‡¶ø Google ‡¶è‡¶∞ standard security warning
        - User ‡¶ï‡ßá inform ‡¶ï‡¶∞‡¶æ‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶Ø‡ßá ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶™‡¶ü‡¶ø Drive ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶ï‡ßç‡¶∏‡ßá‡¶∏ ‡¶ö‡¶æ‡¶á‡¶õ‡ßá
        
        Solution:
        - User ‡¶ï‡ßá ‡¶¨‡ßÅ‡¶ù‡¶æ‡¶®‡ßã ‡¶Ø‡ßá ‡¶è‡¶ü‡¶ø normal
        - ‡¶Ü‡¶Æ‡¶æ‡¶¶‡ßá‡¶∞ Privacy Policy ‡¶≤‡¶ø‡¶Ç‡¶ï ‡¶¶‡ßá‡¶ì‡¶Ø‡¶º‡¶æ
        - Clear explanation of data usage
        */

        // ================================================
        // AUTHENTICATION
        // ================================================
        async function handleAuthState(user) {
            currentUser = user;
            
            if (user) {
                // Google user logged in
                isGoogleLoggedIn = true;
                document.getElementById('loginStatus').textContent = user.email;
                
                showToast(`${user.email} ‡¶è ‡¶≤‡¶ó‡¶á‡¶® ‡¶∏‡¶´‡¶≤!`, 'success');
                
                // Initialize Google APIs
                await initGoogleAPIs();
                
                // Reset auto logout timer
                resetAutoLogoutTimer();
                
            } else {
                // User logged out
                isGoogleLoggedIn = false;
                document.getElementById('loginStatus').textContent = '‡¶Ö‡¶´‡¶≤‡¶æ‡¶á‡¶®';
            }
        }

        async function loginWithGoogle() {
            if (currentPIN.length !== 4) {
                showToast('‡¶™‡ßç‡¶∞‡¶•‡¶Æ‡ßá ‡ß™-‡¶°‡¶ø‡¶ú‡¶ø‡¶ü PIN ‡¶¶‡¶ø‡¶®', 'error');
                return;
            }
            
            try {
                showToast('‡¶ó‡ßÅ‡¶ó‡¶≤ ‡¶≤‡¶ó‡¶á‡¶® ‡¶∂‡ßÅ‡¶∞‡ßÅ ‡¶π‡¶ö‡ßç‡¶õ‡ßá...', 'info');
                
                const provider = new firebase.auth.GoogleAuthProvider();
                // Limited scope for Drive access
                provider.addScope('https://www.googleapis.com/auth/drive.file');
                provider.addScope('https://www.googleapis.com/auth/userinfo.email');
                provider.addScope('https://www.googleapis.com/auth/userinfo.profile');
                
                // Custom parameters for better UX
                provider.setCustomParameters({
                    prompt: 'select_account',
                    login_hint: ''
                });
                
                await auth.signInWithPopup(provider);
                
                // Save PIN to localStorage
                localStorage.setItem('vault_pin', currentPIN);
                
                // Save user info
                localStorage.setItem('user_email', currentUser.email);
                localStorage.setItem('login_time', new Date().toISOString());
                
                // Switch to main app
                switchToMainApp();
                
                // Log login event
                logEvent('google_login_success');
                
            } catch (error) {
                console.error('Google login error:', error);
                logEvent('google_login_failed', { error: error.code });
                
                if (error.code === 'auth/popup-blocked') {
                    showToast('‡¶™‡¶™‡¶Ü‡¶™ ‡¶¨‡ßç‡¶≤‡¶ï ‡¶ï‡¶∞‡¶æ ‡¶Ü‡¶õ‡ßá‡•§ ‡¶¨‡ßç‡¶∞‡¶æ‡¶â‡¶ú‡¶æ‡¶∞ ‡¶∏‡ßá‡¶ü‡¶ø‡¶Ç‡¶∏ ‡¶ö‡ßá‡¶ï ‡¶ï‡¶∞‡ßÅ‡¶®‡•§', 'error');
                } else if (error.code === 'auth/popup-closed-by-user') {
                    showToast('‡¶≤‡¶ó‡¶á‡¶® ‡¶¨‡¶æ‡¶§‡¶ø‡¶≤ ‡¶ï‡¶∞‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá‡•§', 'warning');
                } else if (error.code === 'auth/network-request-failed') {
                    showToast('‡¶®‡ßá‡¶ü‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶ï ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ‡•§ ‡¶á‡¶®‡ßç‡¶ü‡¶æ‡¶∞‡¶®‡ßá‡¶ü ‡¶ö‡ßá‡¶ï ‡¶ï‡¶∞‡ßÅ‡¶®‡•§', 'error');
                } else if (error.code === 'auth/unauthorized-domain') {
                    showToast('‡¶è‡¶á ‡¶°‡ßã‡¶Æ‡ßá‡¶á‡¶® ‡¶Ö‡¶•‡ßã‡¶∞‡¶æ‡¶á‡¶ú‡¶° ‡¶®‡¶Ø‡¶º‡•§', 'error');
                } else {
                    showToast(`‡¶ó‡ßÅ‡¶ó‡¶≤ ‡¶≤‡¶ó‡¶á‡¶® ‡¶¨‡ßç‡¶Ø‡¶∞‡ßç‡¶•: ${error.message}`, 'error');
                }
            }
        }

        function startOfflineMode() {
            if (currentPIN.length !== 4) {
                showToast('‡¶™‡ßç‡¶∞‡¶•‡¶Æ‡ßá ‡ß™-‡¶°‡¶ø‡¶ú‡¶ø‡¶ü PIN ‡¶¶‡¶ø‡¶®', 'error');
                return;
            }
            
            // Save PIN
            localStorage.setItem('vault_pin', currentPIN);
            isOfflineMode = true;
            
            // Save offline mode setting
            localStorage.setItem('offline_mode', 'true');
            
            // Switch to main app
            switchToMainApp();
            
            // Show offline mode message
            showToast('‡¶Ö‡¶´‡¶≤‡¶æ‡¶á‡¶® ‡¶Æ‡ßã‡¶° ‡¶∂‡ßÅ‡¶∞‡ßÅ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá‡•§ ‡¶∂‡ßÅ‡¶ß‡ßÅ ‡¶≤‡ßã‡¶ï‡¶æ‡¶≤ ‡¶´‡¶æ‡¶á‡¶≤ ‡¶¶‡ßá‡¶ñ‡¶æ ‡¶Ø‡¶æ‡¶¨‡ßá‡•§', 'warning');
            
            // Log event
            logEvent('offline_mode_started');
        }

        function switchToMainApp() {
            document.getElementById('authScreen').style.display = 'none';
            document.getElementById('mainScreen').classList.add('active');
            
            // Load local files
            loadFiles();
            
            // Update UI based on mode
            if (isOfflineMode) {
                document.getElementById('connectionText').textContent = '‡¶Ö‡¶´‡¶≤‡¶æ‡¶á‡¶® ‡¶Æ‡ßã‡¶° - ‡¶∂‡ßÅ‡¶ß‡ßÅ ‡¶≤‡ßã‡¶ï‡¶æ‡¶≤ ‡¶∏‡ßç‡¶ü‡ßã‡¶∞‡ßá‡¶ú';
                document.getElementById('driveTab').style.display = 'none';
            }
            
            // Start auto sync if online
            if (isOnline && !isOfflineMode) {
                startAutoSync();
            }
        }

        // ================================================
        // NETWORK MANAGEMENT
        // ================================================
        function updateConnectionStatus() {
            const banner = document.getElementById('connectionBanner');
            const text = document.getElementById('connectionText');
            
            if (navigator.onLine) {
                isOnline = true;
                banner.classList.add('online');
                banner.classList.remove('offline');
                text.textContent = '‡¶Ö‡¶®‡¶≤‡¶æ‡¶á‡¶® ‡¶Æ‡ßã‡¶° - ‡¶°‡ßç‡¶∞‡¶æ‡¶á‡¶≠ ‡¶∏‡¶ø‡¶ô‡ßç‡¶ï ‡¶∏‡¶ï‡ßç‡¶∞‡¶ø‡¶Ø‡¶º';
                
                // Auto sync if there are pending items
                if (syncQueue.length > 0 && !isOfflineMode) {
                    setTimeout(() => {
                        showToast(`${syncQueue.length}‡¶ü‡¶ø ‡¶´‡¶æ‡¶á‡¶≤ ‡¶∏‡¶ø‡¶ô‡ßç‡¶ï‡ßá‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶™‡ßç‡¶∞‡¶∏‡ßç‡¶§‡ßÅ‡¶§`, 'info');
                        processSyncQueue();
                    }, 2000);
                }
                
                // Update drive status
                updateDriveStatus();
                
                // Log connection restored
                logEvent('network_online');
                
            } else {
                isOnline = false;
                banner.classList.remove('online');
                banner.classList.add('offline');
                text.textContent = '‡¶Ö‡¶´‡¶≤‡¶æ‡¶á‡¶® ‡¶Æ‡ßã‡¶° - ‡¶∏‡¶ø‡¶ô‡ßç‡¶ï ‡¶Ö‡¶®‡¶≤‡¶æ‡¶á‡¶®‡ßá ‡¶π‡¶¨‡ßá';
                
                // Log connection lost
                logEvent('network_offline');
            }
        }

        function handleOnline() {
            showToast('‡¶á‡¶®‡ßç‡¶ü‡¶æ‡¶∞‡¶®‡ßá‡¶ü ‡¶∏‡¶Ç‡¶Ø‡ßã‡¶ó ‡¶™‡ßÅ‡¶®‡¶∞‡ßÅ‡¶¶‡ßç‡¶ß‡¶æ‡¶∞ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá!', 'success');
            updateConnectionStatus();
            
            // Start auto sync
            if (!isOfflineMode) {
                startAutoSync();
            }
        }

        function handleOffline() {
            showToast('‡¶á‡¶®‡ßç‡¶ü‡¶æ‡¶∞‡¶®‡ßá‡¶ü ‡¶∏‡¶Ç‡¶Ø‡ßã‡¶ó ‡¶¨‡¶ø‡¶ö‡ßç‡¶õ‡¶ø‡¶®‡ßç‡¶®! ‡¶Ö‡¶´‡¶≤‡¶æ‡¶á‡¶® ‡¶Æ‡ßã‡¶°‡ßá ‡¶ï‡¶æ‡¶ú ‡¶ö‡¶≤‡¶¨‡ßá‡•§', 'warning');
            updateConnectionStatus();
            
            // Stop auto sync
            stopAutoSync();
        }

        function checkConnection() {
            if (navigator.onLine) {
                showToast('‡¶á‡¶®‡ßç‡¶ü‡¶æ‡¶∞‡¶®‡ßá‡¶ü ‡¶∏‡¶Ç‡¶Ø‡ßã‡¶ó ‡¶∏‡¶ï‡ßç‡¶∞‡¶ø‡¶Ø‡¶º ‚úÖ', 'success');
                updateDriveStatus();
            } else {
                showToast('‡¶á‡¶®‡ßç‡¶ü‡¶æ‡¶∞‡¶®‡ßá‡¶ü ‡¶∏‡¶Ç‡¶Ø‡ßã‡¶ó ‡¶®‡ßá‡¶á ‚ùå', 'error');
            }
        }

        // ================================================
        // GOOGLE DRIVE INTEGRATION
        // ================================================
        async function initGoogleAPIs() {
            if (!isGoogleLoggedIn) return;
            
            // Initialize GSI (Google Sign-In)
            initGSI();
            
            // Update UI
            updateDriveStatus();
            
            // Load drive files if connected
            const token = localStorage.getItem('drive_token');
            if (token && await verifyDriveToken()) {
                await loadDriveFiles();
            }
        }

        function initGSI() {
            if (!window.google || !window.google.accounts) {
                showToast('‡¶ó‡ßÅ‡¶ó‡¶≤ ‡¶∏‡ßá‡¶¨‡¶æ ‡¶≤‡ßã‡¶° ‡¶π‡¶ö‡ßç‡¶õ‡ßá...', 'info');
                setTimeout(initGSI, 1000);
                return;
            }
            
            try {
                tokenClient = google.accounts.oauth2.initTokenClient({
                    client_id: CONFIG.googleClientId,
                    scope: 'https://www.googleapis.com/auth/drive.file',
                    prompt: '',
                    callback: async (tokenResponse) => {
                        if (tokenResponse && tokenResponse.access_token) {
                            driveAccessToken = tokenResponse.access_token;
                            localStorage.setItem('drive_token', driveAccessToken);
                            localStorage.setItem('drive_token_expiry', Date.now() + (3500 * 1000));
                            
                            // Update UI
                            document.getElementById('driveStatus').textContent = '‡¶∏‡¶Ç‡¶Ø‡ßÅ‡¶ï‡ßç‡¶§ ‚úÖ';
                            document.getElementById('driveStatusText').textContent = '‡¶∏‡¶Ç‡¶Ø‡ßÅ‡¶ï‡ßç‡¶§ - ‡¶∏‡¶ø‡¶ô‡ßç‡¶ï ‡¶∏‡¶ï‡ßç‡¶∞‡¶ø‡¶Ø‡¶º';
                            document.getElementById('driveConnectBtn').innerHTML = '<span class="btn-icon">‚úÖ</span> ‡¶°‡ßç‡¶∞‡¶æ‡¶á‡¶≠ ‡¶∏‡¶Ç‡¶Ø‡ßÅ‡¶ï‡ßç‡¶§ ‡¶Ü‡¶õ‡ßá';
                            
                            showToast('‡¶°‡ßç‡¶∞‡¶æ‡¶á‡¶≠ ‡¶∏‡¶Ç‡¶Ø‡ßÅ‡¶ï‡ßç‡¶§ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá ‚úÖ', 'success');
                            
                            // Initialize GAPI with the new token
                            await initGAPIWithToken();
                            
                            // Load drive files
                            await loadDriveFiles();
                            
                            // Log successful connection
                            logEvent('drive_connected');
                            
                        } else {
                            showToast('‡¶°‡ßç‡¶∞‡¶æ‡¶á‡¶≠ ‡¶™‡¶æ‡¶∞‡¶Æ‡¶ø‡¶∂‡¶® ‡¶™‡ßç‡¶∞‡¶Ø‡¶º‡ßã‡¶ú‡¶®', 'warning');
                            logEvent('drive_permission_denied');
                        }
                    },
                    error_callback: (error) => {
                        console.error('GSI Error:', error);
                        showToast('‡¶°‡ßç‡¶∞‡¶æ‡¶á‡¶≠ ‡¶∏‡¶Ç‡¶Ø‡ßã‡¶ó ‡¶¨‡ßç‡¶Ø‡¶∞‡ßç‡¶•', 'error');
                        logEvent('drive_connection_failed', { error: error.type });
                    }
                });
                
                // Check for existing token
                checkExistingToken();
                
            } catch (error) {
                console.error('GSI init error:', error);
                showToast('‡¶ó‡ßÅ‡¶ó‡¶≤ ‡¶∏‡ßá‡¶¨‡¶æ ‡¶≤‡ßã‡¶° ‡¶¨‡ßç‡¶Ø‡¶∞‡ßç‡¶•', 'error');
            }
        }

        async function initGAPIWithToken() {
            if (gapiInitialized) return;
            
            try {
                // Load Google API client
                await new Promise((resolve) => {
                    gapi.load('client', resolve);
                });
                
                // Initialize client
                await gapi.client.init({
                    apiKey: CONFIG.firebase.apiKey,
                    discoveryDocs: ['https://www.googleapis.com/discovery/v1/apis/drive/v3/rest'],
                });
                
                gapiInitialized = true;
                showToast('‡¶ó‡ßÅ‡¶ó‡¶≤ API ‡¶™‡ßç‡¶∞‡¶∏‡ßç‡¶§‡ßÅ‡¶§', 'success');
                
            } catch (error) {
                console.error('GAPI init error:', error);
                showToast('‡¶ó‡ßÅ‡¶ó‡¶≤ API ‡¶≤‡ßã‡¶° ‡¶¨‡ßç‡¶Ø‡¶∞‡ßç‡¶•', 'error');
            }
        }

        function checkExistingToken() {
            const savedToken = localStorage.getItem('drive_token');
            const expiry = localStorage.getItem('drive_token_expiry');
            
            if (savedToken && expiry && Date.now() < parseInt(expiry)) {
                driveAccessToken = savedToken;
                document.getElementById('driveStatus').textContent = '‡¶∏‡¶Ç‡¶Ø‡ßÅ‡¶ï‡ßç‡¶§ ‚úÖ';
                initGAPIWithToken();
            } else {
                // Clear expired token
                localStorage.removeItem('drive_token');
                localStorage.removeItem('drive_token_expiry');
                document.getElementById('driveStatus').textContent = '‡¶∏‡¶Ç‡¶Ø‡ßã‡¶ó ‡¶®‡ßá‡¶á';
            }
        }

        async function requestDrivePermission() {
            if (!isOnline) {
                showToast('‡¶°‡ßç‡¶∞‡¶æ‡¶á‡¶≠ ‡¶∏‡¶Ç‡¶Ø‡ßã‡¶ó‡ßá‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶Ö‡¶®‡¶≤‡¶æ‡¶á‡¶® ‡¶•‡¶æ‡¶ï‡ßÅ‡¶®', 'error');
                return;
            }
            
            if (!isGoogleLoggedIn) {
                showToast('‡¶™‡ßç‡¶∞‡¶•‡¶Æ‡ßá ‡¶ó‡ßÅ‡¶ó‡¶≤ ‡¶≤‡¶ó‡¶á‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®', 'error');
                return;
            }
            
            showToast('‡¶°‡ßç‡¶∞‡¶æ‡¶á‡¶≠ ‡¶™‡¶æ‡¶∞‡¶Æ‡¶ø‡¶∂‡¶® ‡¶Ö‡¶®‡ßÅ‡¶∞‡ßã‡¶ß ‡¶ï‡¶∞‡¶æ ‡¶π‡¶ö‡ßç‡¶õ‡ßá...', 'info');
            
            if (!tokenClient) {
                initGSI();
                setTimeout(() => {
                    if (tokenClient) {
                        tokenClient.requestAccessToken({ prompt: 'consent' });
                    }
                }, 1000);
            } else {
                tokenClient.requestAccessToken({ prompt: 'consent' });
            }
        }

        async function verifyDriveToken() {
            const token = localStorage.getItem('drive_token');
            if (!token) return false;
            
            try {
                const response = await fetch('https://www.googleapis.com/oauth2/v3/tokeninfo?access_token=' + token);
                
                if (!response.ok) {
                    localStorage.removeItem('drive_token');
                    localStorage.removeItem('drive_token_expiry');
                    return false;
                }
                
                const tokenInfo = await response.json();
                
                // Scope check
                if (!tokenInfo.scope || !tokenInfo.scope.includes('drive.file')) {
                    localStorage.removeItem('drive_token');
                    localStorage.removeItem('drive_token_expiry');
                    return false;
                }
                
                return true;
                
            } catch (error) {
                localStorage.removeItem('drive_token');
                localStorage.removeItem('drive_token_expiry');
                return false;
            }
        }

        // ================================================
        // FILE MANAGEMENT
        // ================================================
        async function loadFiles() {
            try {
                // Load local files from IndexedDB
                const localFiles = await getLocalFiles();
                
                // Update UI
                updateFileGrid(localFiles);
                updateFileList(localFiles);
                updateStats(localFiles);
                
                // Update badges
                document.getElementById('fileCount').textContent = localFiles.length;
                document.getElementById('galleryBadge').textContent = localFiles.length;
                document.getElementById('galleryBadge').classList.toggle('d-none', localFiles.length === 0);
                
                // Update total uploads
                totalUploads = localFiles.length;
                document.getElementById('totalUploads').textContent = `${totalUploads} ‡¶´‡¶æ‡¶á‡¶≤`;
                
            } catch (error) {
                console.error('Load files error:', error);
                showToast('‡¶´‡¶æ‡¶á‡¶≤ ‡¶≤‡ßã‡¶° ‡¶¨‡ßç‡¶Ø‡¶∞‡ßç‡¶•', 'error');
            }
        }

        async function getLocalFiles() {
            return new Promise((resolve) => {
                const request = indexedDB.open('HybridVault', 2);
                
                request.onupgradeneeded = (e) => {
                    const db = e.target.result;
                    if (!db.objectStoreNames.contains('files')) {
                        const store = db.createObjectStore('files', { keyPath: 'id' });
                        store.createIndex('name', 'name', { unique: false });
                        store.createIndex('uploadedAt', 'uploadedAt', { unique: false });
                        store.createIndex('needsSync', 'needsSync', { unique: false });
                    }
                    
                    if (!db.objectStoreNames.contains('stats')) {
                        db.createObjectStore('stats', { keyPath: 'id' });
                    }
                };
                
                request.onsuccess = (e) => {
                    const db = e.target.result;
                    const transaction = db.transaction(['files'], 'readonly');
                    const store = transaction.objectStore('files');
                    const getAllRequest = store.getAll();
                    
                    getAllRequest.onsuccess = () => {
                        resolve(getAllRequest.result || []);
                    };
                    
                    getAllRequest.onerror = () => resolve([]);
                };
                
                request.onerror = () => resolve([]);
            });
        }

        // ================================================
        // UPLOAD SYSTEM
        // ================================================
        function setupEventListeners() {
            // File input change
            document.getElementById('fileInput').addEventListener('change', handleFileSelect);
            document.getElementById('folderInput').addEventListener('change', handleFileSelect);
            document.getElementById('cameraInput').addEventListener('change', handleFileSelect);
            
            // Login buttons
            document.getElementById('googleLoginBtn').addEventListener('click', loginWithGoogle);
            document.getElementById('offlineModeBtn').addEventListener('click', startOfflineMode);
            
            // Settings toggles
            document.getElementById('autoSyncToggle').addEventListener('change', handleAutoSyncToggle);
            document.getElementById('autoLogoutSelect').addEventListener('change', handleAutoLogoutChange);
            
            // Drag and drop for desktop
            const dropArea = document.getElementById('fileDropArea');
            dropArea.addEventListener('dragover', (e) => {
                e.preventDefault();
                dropArea.classList.add('dragover');
            });
            
            dropArea.addEventListener('dragleave', () => {
                dropArea.classList.remove('dragover');
            });
            
            dropArea.addEventListener('drop', (e) => {
                e.preventDefault();
                dropArea.classList.remove('dragover');
                
                if (e.dataTransfer.files.length > 0) {
                    selectedFiles = Array.from(e.dataTransfer.files);
                    updateSelectedFilesUI();
                    showToast(`${selectedFiles.length}‡¶ü‡¶ø ‡¶´‡¶æ‡¶á‡¶≤ ‡¶∏‡¶ø‡¶≤‡ßá‡¶ï‡ßç‡¶ü ‡¶ï‡¶∞‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá`, 'success');
                }
            });
        }

        // ================================================
        // ENCRYPTION SYSTEM
        // ================================================
        async function encryptFile(file, pin) {
            try {
                const fileData = await file.arrayBuffer();
                const encoder = new TextEncoder();
                const pinBuffer = encoder.encode(pin);
                
                // Generate salt
                const salt = crypto.getRandomValues(new Uint8Array(16));
                
                // Derive key from PIN and salt
                const keyMaterial = await crypto.subtle.importKey(
                    'raw',
                    pinBuffer,
                    { name: 'PBKDF2' },
                    false,
                    ['deriveKey']
                );
                
                const key = await crypto.subtle.deriveKey(
                    {
                        name: 'PBKDF2',
                        salt: salt,
                        iterations: 100000,
                        hash: 'SHA-256'
                    },
                    keyMaterial,
                    { name: 'AES-GCM', length: 256 },
                    false,
                    ['encrypt']
                );
                
                // Generate IV
                const iv = crypto.getRandomValues(new Uint8Array(12));
                
                // Encrypt data
                const encryptedData = await crypto.subtle.encrypt(
                    { name: 'AES-GCM', iv: iv },
                    key,
                    fileData
                );
                
                // Combine salt + iv + encrypted data
                const result = new Uint8Array(salt.length + iv.length + encryptedData.byteLength);
                result.set(salt);
                result.set(iv, salt.length);
                result.set(new Uint8Array(encryptedData), salt.length + iv.length);
                
                return result.buffer;
                
            } catch (error) {
                console.error('Encryption error:', error);
                throw new Error('‡¶´‡¶æ‡¶á‡¶≤ ‡¶è‡¶®‡¶ï‡ßç‡¶∞‡¶ø‡¶™‡ßç‡¶ü ‡¶ï‡¶∞‡¶§‡ßá ‡¶¨‡ßç‡¶Ø‡¶∞‡ßç‡¶•');
            }
        }

        async function decryptFile(encryptedData, pin) {
            try {
                const encryptedArray = new Uint8Array(encryptedData);
                
                // Extract salt, iv and encrypted data
                const salt = encryptedArray.slice(0, 16);
                const iv = encryptedArray.slice(16, 28);
                const data = encryptedArray.slice(28);
                
                const encoder = new TextEncoder();
                const pinBuffer = encoder.encode(pin);
                
                // Derive key
                const keyMaterial = await crypto.subtle.importKey(
                    'raw',
                    pinBuffer,
                    { name: 'PBKDF2' },
                    false,
                    ['deriveKey']
                );
                
                const key = await crypto.subtle.deriveKey(
                    {
                        name: 'PBKDF2',
                        salt: salt,
                        iterations: 100000,
                        hash: 'SHA-256'
                    },
                    keyMaterial,
                    { name: 'AES-GCM', length: 256 },
                    false,
                    ['decrypt']
                );
                
                // Decrypt data
                const decryptedData = await crypto.subtle.decrypt(
                    { name: 'AES-GCM', iv: iv },
                    key,
                    data
                );
                
                return decryptedData;
                
            } catch (error) {
                console.error('Decryption error:', error);
                throw new Error('‡¶´‡¶æ‡¶á‡¶≤ ‡¶°‡¶ø‡¶ï‡ßç‡¶∞‡¶ø‡¶™‡ßç‡¶ü ‡¶ï‡¶∞‡¶§‡ßá ‡¶¨‡ßç‡¶Ø‡¶∞‡ßç‡¶•‡•§ PIN ‡¶ö‡ßá‡¶ï ‡¶ï‡¶∞‡ßÅ‡¶®‡•§');
            }
        }

        // ================================================
        // SYNC SYSTEM
        // ================================================
        async function syncDrive() {
            if (!isOnline) {
                showToast('‡¶∏‡¶ø‡¶ô‡ßç‡¶ï‡ßá‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶Ö‡¶®‡¶≤‡¶æ‡¶á‡¶® ‡¶•‡¶æ‡¶ï‡ßÅ‡¶®', 'error');
                return;
            }
            
            if (!isGoogleLoggedIn) {
                showToast('‡¶∏‡¶ø‡¶ô‡ßç‡¶ï‡ßá‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶ó‡ßÅ‡¶ó‡¶≤ ‡¶≤‡¶ó‡¶á‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®', 'error');
                return;
            }
            
            const token = localStorage.getItem('drive_token');
            if (!token) {
                showToast('‡¶™‡ßç‡¶∞‡¶•‡¶Æ‡ßá ‡¶°‡ßç‡¶∞‡¶æ‡¶á‡¶≠ ‡¶∏‡¶Ç‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡ßÅ‡¶®', 'error');
                requestDrivePermission();
                return;
            }
            
            try {
                showToast('‡¶°‡ßç‡¶∞‡¶æ‡¶á‡¶≠ ‡¶∏‡¶ø‡¶ô‡ßç‡¶ï ‡¶∂‡ßÅ‡¶∞‡ßÅ ‡¶π‡¶ö‡ßç‡¶õ‡ßá...', 'info');
                
                // Get local files that need sync
                const localFiles = await getLocalFiles();
                const filesToSync = localFiles.filter(file => file.needsSync);
                
                if (filesToSync.length === 0) {
                    showToast('‡¶∏‡¶ø‡¶ô‡ßç‡¶ï ‡¶ï‡¶∞‡¶æ‡¶∞ ‡¶ï‡ßã‡¶®‡ßã ‡¶´‡¶æ‡¶á‡¶≤ ‡¶®‡ßá‡¶á', 'info');
                    return;
                }
                
                showToast(`${filesToSync.length}‡¶ü‡¶ø ‡¶´‡¶æ‡¶á‡¶≤ ‡¶∏‡¶ø‡¶ô‡ßç‡¶ï ‡¶π‡¶¨‡ßá`, 'info');
                
                // Add to sync queue
                syncQueue = [...syncQueue, ...filesToSync];
                updateSyncBadge();
                
                // Start syncing
                await processSyncQueue();
                
            } catch (error) {
                console.error('Sync drive error:', error);
                showToast(`‡¶∏‡¶ø‡¶ô‡ßç‡¶ï ‡¶¨‡ßç‡¶Ø‡¶∞‡ßç‡¶•: ${error.message}`, 'error');
            }
        }

        // ================================================
        // UI CONTROLS
        // ================================================
        function switchTab(tab) {
            // Update tab buttons
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.currentTarget.classList.add('active');
            
            // Update bottom nav
            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.remove('active');
            });
            
            if (tab === 'gallery') {
                document.querySelector('.nav-item:nth-child(1)').classList.add('active');
                document.getElementById('galleryTab').classList.add('active');
                loadFiles();
            } else if (tab === 'drive') {
                document.querySelector('.nav-item:nth-child(3)').classList.add('active');
                document.getElementById('driveTab').classList.add('active');
                updateDriveStatus();
            } else if (tab === 'settings') {
                document.querySelector('.nav-item:nth-child(4)').classList.add('active');
                document.getElementById('settingsTab').classList.add('active');
            }
        }

        function switchNav(nav) {
            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.remove('active');
            });
            event.currentTarget.classList.add('active');
            
            if (nav === 'upload') {
                openUploadModal();
            } else if (nav === 'sync') {
                syncDrive();
            } else if (nav === 'profile') {
                switchTab('settings');
            } else if (nav === 'gallery') {
                switchTab('gallery');
            }
        }

        function switchView(view) {
            document.querySelectorAll('.view-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.currentTarget.classList.add('active');
            currentFileView = view;
            
            if (view === 'grid') {
                document.getElementById('fileGridView').style.display = 'grid';
                document.getElementById('fileListView').classList.remove('active');
            } else {
                document.getElementById('fileGridView').style.display = 'none';
                document.getElementById('fileListView').classList.add('active');
            }
        }

        // ================================================
        // ADVANCED FEATURES
        // ================================================
        function setupAutoLogout() {
            const autoLogoutSelect = document.getElementById('autoLogoutSelect');
            const savedTimeout = localStorage.getItem('auto_logout_timeout') || '15';
            autoLogoutSelect.value = savedTimeout;
            
            handleAutoLogoutChange();
        }

        function handleAutoLogoutChange() {
            const select = document.getElementById('autoLogoutSelect');
            const minutes = parseInt(select.value);
            localStorage.setItem('auto_logout_timeout', minutes.toString());
            
            if (autoLogoutTimer) {
                clearTimeout(autoLogoutTimer);
            }
            
            if (minutes > 0 && currentUser) {
                autoLogoutTimer = setTimeout(() => {
                    showToast('‡¶®‡¶ø‡¶∑‡ßç‡¶ï‡ßç‡¶∞‡¶ø‡¶Ø‡¶º‡¶§‡¶æ‡¶∞ ‡¶ï‡¶æ‡¶∞‡¶£‡ßá ‡¶Ö‡¶ü‡ßã ‡¶≤‡¶ó‡¶Ü‡¶â‡¶ü', 'warning');
                    logout();
                }, minutes * 60 * 1000);
            }
        }

        function resetAutoLogoutTimer() {
            handleAutoLogoutChange();
        }

        function startAutoSync() {
            const autoSyncToggle = document.getElementById('autoSyncToggle');
            if (autoSyncToggle.checked && isOnline && !isOfflineMode) {
                setInterval(async () => {
                    if (syncQueue.length > 0) {
                        await processSyncQueue();
                    }
                }, CONFIG.autoSyncInterval);
            }
        }

        function stopAutoSync() {
            // Clear any existing sync intervals
            // Implementation depends on how intervals are stored
        }

        function handleAutoSyncToggle() {
            const autoSyncToggle = document.getElementById('autoSyncToggle');
            localStorage.setItem('auto_sync', autoSyncToggle.checked.toString());
            
            if (autoSyncToggle.checked) {
                startAutoSync();
                showToast('‡¶Ö‡¶ü‡ßã ‡¶∏‡¶ø‡¶ô‡ßç‡¶ï ‡¶∏‡¶ï‡ßç‡¶∞‡¶ø‡¶Ø‡¶º', 'success');
            } else {
                stopAutoSync();
                showToast('‡¶Ö‡¶ü‡ßã ‡¶∏‡¶ø‡¶ô‡ßç‡¶ï ‡¶¨‡¶®‡ßç‡¶ß', 'warning');
            }
        }

        // ================================================
        // SETTINGS FUNCTIONS
        // ================================================
        function changePin() {
            const newPin = prompt('‡¶®‡¶§‡ßÅ‡¶® ‡ß™-‡¶°‡¶ø‡¶ú‡¶ø‡¶ü PIN ‡¶¶‡¶ø‡¶®:', '');
            if (!newPin || newPin.length !== 4 || !/^\d+$/.test(newPin)) {
                showToast('‡¶∏‡¶†‡¶ø‡¶ï ‡ß™-‡¶°‡¶ø‡¶ú‡¶ø‡¶ü PIN ‡¶¶‡¶ø‡¶®', 'error');
                return;
            }
            
            const confirmPin = prompt('PIN ‡¶Ü‡¶¨‡¶æ‡¶∞ ‡¶¶‡¶ø‡¶®:', '');
            if (newPin !== confirmPin) {
                showToast('PIN ‡¶Æ‡¶ø‡¶≤‡¶õ‡ßá ‡¶®‡¶æ', 'error');
                return;
            }
            
            // Re-encrypt all files with new PIN
            if (confirm('‡¶∏‡¶ï‡¶≤ ‡¶´‡¶æ‡¶á‡¶≤ ‡¶®‡¶§‡ßÅ‡¶® PIN ‡¶¶‡¶ø‡¶Ø‡¶º‡ßá ‡¶è‡¶®‡¶ï‡ßç‡¶∞‡¶ø‡¶™‡ßç‡¶ü ‡¶ï‡¶∞‡¶æ ‡¶π‡¶¨‡ßá‡•§ ‡¶è‡¶ü‡¶ø ‡¶∏‡¶Æ‡¶Ø‡¶º‡¶∏‡¶æ‡¶™‡ßá‡¶ï‡ßç‡¶∑ ‡¶π‡¶§‡ßá ‡¶™‡¶æ‡¶∞‡ßá‡•§')) {
                showToast('‡¶´‡¶æ‡¶á‡¶≤‡¶ó‡ßÅ‡¶≤‡ßã ‡¶®‡¶§‡ßÅ‡¶® PIN ‡¶¶‡¶ø‡¶Ø‡¶º‡ßá ‡¶è‡¶®‡¶ï‡ßç‡¶∞‡¶ø‡¶™‡ßç‡¶ü ‡¶ï‡¶∞‡¶æ ‡¶π‡¶ö‡ßç‡¶õ‡ßá...', 'info');
                // Implement re-encryption logic here
                setTimeout(() => {
                    localStorage.setItem('vault_pin', newPin);
                    currentPIN = newPin;
                    showToast('PIN ‡¶∏‡¶´‡¶≤‡¶≠‡¶æ‡¶¨‡ßá ‡¶™‡¶∞‡¶ø‡¶¨‡¶∞‡ßç‡¶§‡¶® ‡¶ï‡¶∞‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá', 'success');
                }, 1000);
            }
        }

        function clearLocalData() {
            if (confirm('‡¶∏‡¶ï‡¶≤ ‡¶≤‡ßã‡¶ï‡¶æ‡¶≤ ‡¶°‡¶æ‡¶ü‡¶æ ‡¶Æ‡ßÅ‡¶õ‡ßá ‡¶´‡ßá‡¶≤‡¶¨‡ßá‡¶®? ‡¶è‡¶ü‡¶ø ‡¶™‡ßÇ‡¶∞‡ßç‡¶¨‡¶¨‡¶∞‡ßç‡¶§‡ßÄ ‡¶π‡¶¨‡ßá ‡¶®‡¶æ‡•§')) {
                showToast('‡¶°‡¶æ‡¶ü‡¶æ ‡¶ï‡ßç‡¶≤‡¶ø‡¶Ø‡¶º‡¶æ‡¶∞ ‡¶ï‡¶∞‡¶æ ‡¶π‡¶ö‡ßç‡¶õ‡ßá...', 'info');
                
                // Clear IndexedDB
                indexedDB.deleteDatabase('HybridVault');
                
                // Clear local storage except login info
                const email = localStorage.getItem('user_email');
                localStorage.clear();
                if (email) {
                    localStorage.setItem('user_email', email);
                }
                
                // Reload app
                setTimeout(() => {
                    showToast('‡¶≤‡ßã‡¶ï‡¶æ‡¶≤ ‡¶°‡¶æ‡¶ü‡¶æ ‡¶ï‡ßç‡¶≤‡¶ø‡¶Ø‡¶º‡¶æ‡¶∞ ‡¶ï‡¶∞‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá', 'success');
                    location.reload();
                }, 1000);
            }
        }

        function logout() {
            if (confirm('‡¶≤‡¶ó‡¶Ü‡¶â‡¶ü ‡¶ï‡¶∞‡¶¨‡ßá‡¶®? ‡¶Ö‡¶´‡¶≤‡¶æ‡¶á‡¶® ‡¶´‡¶æ‡¶á‡¶≤‡¶ó‡ßÅ‡¶≤‡ßã ‡¶∏‡¶Ç‡¶∞‡¶ï‡ßç‡¶∑‡¶ø‡¶§ ‡¶•‡¶æ‡¶ï‡¶¨‡ßá‡•§')) {
                showToast('‡¶≤‡¶ó‡¶Ü‡¶â‡¶ü ‡¶ï‡¶∞‡¶æ ‡¶π‡¶ö‡ßç‡¶õ‡ßá...', 'info');
                
                // Sign out from Firebase
                auth.signOut();
                
                // Clear tokens but keep PIN and files
                localStorage.removeItem('drive_token');
                localStorage.removeItem('drive_token_expiry');
                localStorage.removeItem('user_email');
                localStorage.removeItem('login_time');
                
                // Reload page
                setTimeout(() => {
                    location.reload();
                }, 1000);
            }
        }

        // ================================================
        // UTILITY FUNCTIONS
        // ================================================
        function formatFileSize(bytes) {
            if (bytes === 0) return '0 Bytes';
            const k = 1024;
            const sizes = ['Bytes', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(1)) + ' ' + sizes[i];
        }

        function getFileIcon(filename) {
            const ext = filename.split('.').pop().toLowerCase();
            
            const iconMap = {
                // Images
                'jpg': 'üñºÔ∏è', 'jpeg': 'üñºÔ∏è', 'png': 'üñºÔ∏è', 'gif': 'üñºÔ∏è', 'webp': 'üñºÔ∏è', 'bmp': 'üñºÔ∏è', 'svg': 'üñºÔ∏è',
                // Videos
                'mp4': 'üé¨', 'avi': 'üé¨', 'mov': 'üé¨', 'wmv': 'üé¨', 'flv': 'üé¨', 'mkv': 'üé¨',
                // Audio
                'mp3': 'üéµ', 'wav': 'üéµ', 'aac': 'üéµ', 'flac': 'üéµ', 'm4a': 'üéµ',
                // Documents
                'pdf': 'üìï', 'doc': 'üìù', 'docx': 'üìù', 'txt': 'üìÑ', 'rtf': 'üìÑ',
                // Spreadsheets
                'xls': 'üìä', 'xlsx': 'üìä', 'csv': 'üìä',
                // Presentations
                'ppt': 'üìΩÔ∏è', 'pptx': 'üìΩÔ∏è',
                // Archives
                'zip': 'üóúÔ∏è', 'rar': 'üóúÔ∏è', '7z': 'üóúÔ∏è', 'tar': 'üóúÔ∏è', 'gz': 'üóúÔ∏è',
                // Code
                'html': 'üåê', 'css': 'üé®', 'js': '‚ö°', 'json': 'üìã', 'xml': 'üìã',
                // Default
                'default': 'üìÑ'
            };
            
            return iconMap[ext] || iconMap['default'];
        }

        function updateSyncBadge() {
            const badge = document.getElementById('syncBadge');
            if (syncQueue.length > 0) {
                badge.textContent = syncQueue.length > 9 ? '9+' : syncQueue.length.toString();
                badge.classList.remove('d-none');
            } else {
                badge.classList.add('d-none');
            }
        }

        function logEvent(eventName, data = {}) {
            const eventData = {
                event: eventName,
                timestamp: new Date().toISOString(),
                user: currentUser ? currentUser.email : 'anonymous',
                isOnline: isOnline,
                isOfflineMode: isOfflineMode,
                ...data
            };
            
            console.log('[EVENT]', eventData);
            
            // Save to Firebase if online
            if (isOnline && currentUser) {
                db.collection('events').add(eventData).catch(console.error);
            }
            
            // Save to local storage for offline
            const events = JSON.parse(localStorage.getItem('events') || '[]');
            events.push(eventData);
            if (events.length > 100) events.shift(); // Keep only last 100 events
            localStorage.setItem('events', JSON.stringify(events));
        }

        // ================================================
        // FILE PREVIEW AND DOWNLOAD
        // ================================================
        async function openFile(fileId) {
            try {
                showToast('‡¶´‡¶æ‡¶á‡¶≤ ‡¶≤‡ßã‡¶° ‡¶π‡¶ö‡ßç‡¶õ‡ßá...', 'info');
                
                // Get file from IndexedDB
                const file = await getFileById(fileId);
                if (!file) {
                    showToast('‡¶´‡¶æ‡¶á‡¶≤ ‡¶™‡¶æ‡¶ì‡¶Ø‡¶º‡¶æ ‡¶Ø‡¶æ‡¶Ø‡¶º‡¶®‡¶ø', 'error');
                    return;
                }
                
                selectedFileForPreview = file;
                
                // Show preview modal
                document.getElementById('filePreviewModal').classList.add('active');
                document.getElementById('previewFileName').textContent = file.name;
                
                // Show file info
                const size = formatFileSize(file.size);
                const date = new Date(file.uploadedAt).toLocaleString('bn-BD');
                
                document.getElementById('previewContent').innerHTML = `
                    <div style="text-align: center; padding: 20px;">
                        <div style="font-size: 4rem; margin-bottom: 20px;">${getFileIcon(file.name)}</div>
                        <div style="font-size: 1.2rem; font-weight: 600; margin-bottom: 10px;">${file.name}</div>
                        <div style="color: var(--text-secondary); margin-bottom: 5px;">‡¶Ü‡¶ï‡¶æ‡¶∞: ${size}</div>
                        <div style="color: var(--text-secondary); margin-bottom: 5px;">‡¶Ü‡¶™‡¶≤‡ßã‡¶°: ${date}</div>
                        <div style="color: var(--text-secondary); margin-bottom: 20px;">${file.encrypted ? 'üîí ‡¶è‡¶®‡¶ï‡ßç‡¶∞‡¶ø‡¶™‡ßç‡¶ü‡ßá‡¶°' : 'üîì ‡¶è‡¶®‡¶ï‡ßç‡¶∞‡¶ø‡¶™‡ßç‡¶ü‡ßá‡¶° ‡¶®‡¶Ø‡¶º'}</div>
                        <div style="background: var(--surface); padding: 15px; border-radius: 10px; text-align: left;">
                            <div style="font-weight: 600; margin-bottom: 10px;">‡¶´‡¶æ‡¶á‡¶≤ ‡¶§‡¶•‡ßç‡¶Ø:</div>
                            <div>‡¶ü‡¶æ‡¶á‡¶™: ${file.type || 'Unknown'}</div>
                            <div>‡¶∏‡¶ø‡¶ô‡ßç‡¶ï ‡¶Ö‡¶¨‡¶∏‡ßç‡¶•‡¶æ: ${file.needsSync ? '‡¶∏‡¶ø‡¶ô‡ßç‡¶ï ‡¶™‡ßç‡¶∞‡¶Ø‡¶º‡ßã‡¶ú‡¶®' : '‡¶∏‡¶ø‡¶ô‡ßç‡¶ï ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá'}</div>
                            <div>‡¶∏‡ßã‡¶∞‡ßç‡¶∏: ${file.source || '‡¶≤‡ßã‡¶ï‡¶æ‡¶≤'}</div>
                        </div>
                    </div>
                `;
                
            } catch (error) {
                console.error('Open file error:', error);
                showToast('‡¶´‡¶æ‡¶á‡¶≤ ‡¶ñ‡ßÅ‡¶≤‡¶§‡ßá ‡¶¨‡ßç‡¶Ø‡¶∞‡ßç‡¶•', 'error');
            }
        }

        async function downloadFile() {
            if (!selectedFileForPreview) return;
            
            try {
                showToast('‡¶´‡¶æ‡¶á‡¶≤ ‡¶°‡¶æ‡¶â‡¶®‡¶≤‡ßã‡¶° ‡¶™‡ßç‡¶∞‡¶∏‡ßç‡¶§‡ßÅ‡¶§ ‡¶π‡¶ö‡ßç‡¶õ‡ßá...', 'info');
                
                let fileData = selectedFileForPreview.data;
                
                // Decrypt if needed
                if (selectedFileForPreview.encrypted && currentPIN) {
                    fileData = await decryptFile(fileData, currentPIN);
                }
                
                // Create blob and download link
                const blob = new Blob([fileData], { type: selectedFileForPreview.type });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = selectedFileForPreview.name;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
                
                showToast('‡¶´‡¶æ‡¶á‡¶≤ ‡¶°‡¶æ‡¶â‡¶®‡¶≤‡ßã‡¶° ‡¶∂‡ßÅ‡¶∞‡ßÅ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá', 'success');
                
                // Log download event
                logEvent('file_downloaded', { fileName: selectedFileForPreview.name, fileSize: selectedFileForPreview.size });
                
            } catch (error) {
                console.error('Download error:', error);
                showToast(`‡¶°‡¶æ‡¶â‡¶®‡¶≤‡ßã‡¶° ‡¶¨‡ßç‡¶Ø‡¶∞‡ßç‡¶•: ${error.message}`, 'error');
            }
        }

        function shareFile() {
            if (!selectedFileForPreview) return;
            
            if (navigator.share) {
                navigator.share({
                    title: selectedFileForPreview.name,
                    text: '‡¶è‡¶á ‡¶´‡¶æ‡¶á‡¶≤‡¶ü‡¶ø Hybrid Vault ‡¶•‡ßá‡¶ï‡ßá ‡¶∂‡ßá‡¶Ø‡¶º‡¶æ‡¶∞ ‡¶ï‡¶∞‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá',
                    url: window.location.href
                }).then(() => {
                    showToast('‡¶´‡¶æ‡¶á‡¶≤ ‡¶∂‡ßá‡¶Ø‡¶º‡¶æ‡¶∞ ‡¶ï‡¶∞‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá', 'success');
                }).catch(error => {
                    showToast('‡¶∂‡ßá‡¶Ø‡¶º‡¶æ‡¶∞ ‡¶¨‡¶æ‡¶§‡¶ø‡¶≤ ‡¶ï‡¶∞‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá', 'warning');
                });
            } else {
                showToast('‡¶è‡¶á ‡¶¨‡ßç‡¶∞‡¶æ‡¶â‡¶ú‡¶æ‡¶∞‡ßá ‡¶∂‡ßá‡¶Ø‡¶º‡¶æ‡¶∞ ‡¶∏‡¶æ‡¶™‡ßã‡¶∞‡ßç‡¶ü ‡¶ï‡¶∞‡ßá ‡¶®‡¶æ', 'warning');
            }
        }

        async function deleteFile() {
            if (!selectedFileForPreview || !confirm('‡¶è‡¶á ‡¶´‡¶æ‡¶á‡¶≤‡¶ü‡¶ø ‡¶°‡¶ø‡¶≤‡¶ø‡¶ü ‡¶ï‡¶∞‡¶¨‡ßá‡¶®?')) return;
            
            try {
                showToast('‡¶´‡¶æ‡¶á‡¶≤ ‡¶°‡¶ø‡¶≤‡¶ø‡¶ü ‡¶ï‡¶∞‡¶æ ‡¶π‡¶ö‡ßç‡¶õ‡ßá...', 'info');
                
                // Delete from IndexedDB
                await deleteFileById(selectedFileForPreview.id);
                
                // Close preview
                closePreviewModal();
                
                // Reload files
                await loadFiles();
                
                showToast('‡¶´‡¶æ‡¶á‡¶≤ ‡¶°‡¶ø‡¶≤‡¶ø‡¶ü ‡¶ï‡¶∞‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá', 'success');
                
                // Log delete event
                logEvent('file_deleted', { fileName: selectedFileForPreview.name });
                
            } catch (error) {
                console.error('Delete error:', error);
                showToast('‡¶´‡¶æ‡¶á‡¶≤ ‡¶°‡¶ø‡¶≤‡¶ø‡¶ü ‡¶ï‡¶∞‡¶§‡ßá ‡¶¨‡ßç‡¶Ø‡¶∞‡ßç‡¶•', 'error');
            }
        }

        function closePreviewModal() {
            document.getElementById('filePreviewModal').classList.remove('active');
            selectedFileForPreview = null;
        }

        async function getFileById(fileId) {
            return new Promise((resolve) => {
                const request = indexedDB.open('HybridVault', 2);
                
                request.onsuccess = (e) => {
                    const db = e.target.result;
                    const transaction = db.transaction(['files'], 'readonly');
                    const store = transaction.objectStore('files');
                    const getRequest = store.get(fileId);
                    
                    getRequest.onsuccess = () => resolve(getRequest.result);
                    getRequest.onerror = () => resolve(null);
                };
                
                request.onerror = () => resolve(null);
            });
        }

        async function deleteFileById(fileId) {
            return new Promise((resolve, reject) => {
                const request = indexedDB.open('HybridVault', 2);
                
                request.onsuccess = (e) => {
                    const db = e.target.result;
                    const transaction = db.transaction(['files'], 'readwrite');
                    const store = transaction.objectStore('files');
                    const deleteRequest = store.delete(fileId);
                    
                    deleteRequest.onsuccess = () => resolve();
                    deleteRequest.onerror = () => reject(deleteRequest.error);
                };
                
                request.onerror = () => reject(request.error);
            });
        }

        // ================================================
        // INITIAL UI UPDATES
        // ================================================
        updateConnectionStatus();
        
        // Check if user was previously logged in
        const savedEmail = localStorage.getItem('user_email');
        if (savedEmail) {
            document.getElementById('loginStatus').textContent = savedEmail;
        }
        
        // Check last sync time
        const lastSync = localStorage.getItem('last_sync');
        if (lastSync) {
            document.getElementById('lastSync').textContent = new Date(lastSync).toLocaleString('bn-BD');
        }

        // Initialize tooltips and help texts
        document.addEventListener('click', function(e) {
            if (e.target.classList.contains('help-icon')) {
                const helpText = e.target.getAttribute('data-help');
                showToast(helpText, 'info', 5000);
            }
        });

        // Add help icons to important elements
        setTimeout(() => {
            const importantElements = document.querySelectorAll('.section-title, .settings-title, .login-title');
            importantElements.forEach(el => {
                if (!el.querySelector('.help-icon')) {
                    const helpIcon = document.createElement('span');
                    helpIcon.className = 'help-icon';
                    helpIcon.innerHTML = ' ‚ùì';
                    helpIcon.style.cursor = 'pointer';
                    helpIcon.style.color = 'var(--info)';
                    el.appendChild(helpIcon);
                }
            });
        }, 1000);

        // Enhanced error handling
        window.onerror = function(msg, url, lineNo, columnNo, error) {
            console.error('Global error:', msg, url, lineNo, error);
            showToast('‡¶Ö‡¶™‡ßç‡¶∞‡¶§‡ßç‡¶Ø‡¶æ‡¶∂‡¶ø‡¶§ ‡¶§‡ßç‡¶∞‡ßÅ‡¶ü‡¶ø ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá‡•§ ‡¶™‡ßá‡¶ú ‡¶∞‡¶ø‡¶´‡ßç‡¶∞‡ßá‡¶∂ ‡¶ï‡¶∞‡ßÅ‡¶®‡•§', 'error');
            return false;
        };

        // Service Worker registration for PWA
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/sw.js').then(registration => {
                    console.log('ServiceWorker registered:', registration);
                    showToast('‡¶Ö‡¶´‡¶≤‡¶æ‡¶á‡¶® ‡¶∏‡¶æ‡¶™‡ßã‡¶∞‡ßç‡¶ü ‡¶∏‡¶ï‡ßç‡¶∞‡¶ø‡¶Ø‡¶º', 'success');
                }).catch(error => {
                    console.log('ServiceWorker registration failed:', error);
                });
            });
        }

        // Add beforeunload warning for unsaved changes
        window.addEventListener('beforeunload', (e) => {
            if (syncQueue.length > 0 || selectedFiles.length > 0) {
                e.preventDefault();
                e.returnValue = '‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶ï‡¶ø‡¶õ‡ßÅ ‡¶™‡¶∞‡¶ø‡¶¨‡¶∞‡ßç‡¶§‡¶® ‡¶∏‡¶Ç‡¶∞‡¶ï‡ßç‡¶∑‡¶ø‡¶§ ‡¶π‡¶Ø‡¶º‡¶®‡¶ø‡•§ ‡¶Ü‡¶™‡¶®‡¶ø ‡¶ï‡¶ø ‡¶®‡¶ø‡¶∂‡ßç‡¶ö‡¶ø‡¶§?';
            }
        });

        // Initialize with sample data if empty
        setTimeout(async () => {
            const files = await getLocalFiles();
            if (files.length === 0 && !localStorage.getItem('first_run')) {
                showToast('‡¶∏‡ßç‡¶¨‡¶æ‡¶ó‡¶§‡¶Æ Hybrid Vault ‡¶è! ‡¶™‡ßç‡¶∞‡¶•‡¶Æ‡ßá ‡¶è‡¶ï‡¶ü‡¶ø ‡¶´‡¶æ‡¶á‡¶≤ ‡¶Ü‡¶™‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡ßÅ‡¶®‡•§', 'info', 5000);
                localStorage.setItem('first_run', 'true');
            }
        }, 2000);
    </script>
</body>
</html>
[file name]: 112.html
[file content begin]
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Drive OS Pro | Complete</title>
    
    <!-- Google Identity -->
    <script src="https://accounts.google.com/gsi/client" async defer></script>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&family=Google+Sans:wght@400;500;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons+Round" rel="stylesheet">

    <style>
        :root {
            --primary: #1a73e8;
            --primary-dark: #0d47a1;
            --primary-light: #e8f0fe;
            --secondary: #34a853;
            --accent: #fbbc04;
            --surface: #ffffff;
            --bg: #f8f9fa;
            --text-main: #202124;
            --text-sec: #5f6368;
            --border: #dadce0;
            --hover: #f1f3f4;
            --shadow: 0 1px 3px rgba(60,64,67,0.3), 0 4px 8px 3px rgba(60,64,67,0.15);
            --radius: 16px;
            --radius-sm: 8px;
            --radius-lg: 24px;
            --radius-xl: 28px;
            --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .dark-theme {
            --primary: #8ab4f8;
            --primary-dark: #669df6;
            --primary-light: #202124;
            --secondary: #81c995;
            --accent: #fdd663;
            --surface: #202124;
            --bg: #121212;
            --text-main: #e8eaed;
            --text-sec: #9aa0a6;
            --border: #3c4043;
            --hover: #2d2e30;
            --shadow: 0 1px 3px rgba(0,0,0,0.6), 0 4px 8px 3px rgba(0,0,0,0.4);
        }

        /* --- RESET & BASE --- */
        * { 
            margin: 0; padding: 0; box-sizing: border-box; 
            -webkit-tap-highlight-color: transparent; 
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }
        
        body {
            font-family: 'Roboto', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: var(--bg); color: var(--text-main);
            height: 100vh; width: 100vw;
            overflow: hidden;
            position: fixed;
            touch-action: manipulation;
            user-select: none;
            overscroll-behavior: none;
        }

        /* --- APP CONTAINER --- */
        .app-container {
            position: absolute;
            top: 0; left: 0;
            width: 100%; height: 100%;
            display: none;
            flex-direction: column;
            background: var(--bg);
            transition: var(--transition);
        }

        .app-container.active {
            display: flex;
            animation: slideUp 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }

        @keyframes slideUp {
            from { transform: translateY(30px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        /* --- SPLASH SCREEN --- */
        #splash-screen {
            position: fixed;
            top: 0; left: 0;
            width: 100%; height: 100%;
            background: linear-gradient(135deg, #1a73e8 0%, #0d47a1 100%);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            animation: fadeOut 0.5s ease 2s forwards;
        }

        @keyframes fadeOut {
            to { opacity: 0; visibility: hidden; }
        }

        .splash-logo {
            width: 80px; height: 80px;
            background: white;
            border-radius: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 20px;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        .splash-logo img {
            width: 50px; height: 50px;
        }

        .splash-text {
            color: white;
            font-family: 'Google Sans';
            font-size: 28px;
            font-weight: 700;
            letter-spacing: -0.5px;
        }

        /* --- LOCK SCREEN --- */
        #lock-screen {
            background: var(--surface);
            justify-content: center;
            align-items: center;
        }

        .lock-container {
            width: 100%;
            max-width: 320px;
            padding: 40px 20px;
            text-align: center;
        }

        .lock-logo {
            font-family: 'Google Sans';
            font-size: 32px;
            font-weight: 700;
            color: var(--text-main);
            margin-bottom: 8px;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .lock-subtitle {
            color: var(--text-sec);
            font-size: 16px;
            margin-bottom: 40px;
            font-weight: 400;
        }

        .pin-display {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-bottom: 40px;
        }

        .pin-dot {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: var(--hover);
            border: 2px solid var(--border);
            transition: var(--transition);
        }

        .pin-dot.filled {
            background: var(--primary);
            border-color: var(--primary);
            transform: scale(1.2);
        }

        .keypad {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 16px;
            margin-bottom: 24px;
        }

        .key {
            width: 72px;
            height: 72px;
            border-radius: 50%;
            background: var(--hover);
            color: var(--text-main);
            font-size: 28px;
            font-weight: 400;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto;
            cursor: pointer;
            transition: var(--transition);
            border: none;
            font-family: 'Google Sans';
        }

        .key:active {
            background: var(--border);
            transform: scale(0.95);
        }

        .key.utility {
            background: transparent;
            color: var(--text-sec);
            font-size: 14px;
        }

        .biometric-option {
            margin-top: 32px;
        }

        .biometric-btn {
            display: inline-flex;
            align-items: center;
            gap: 12px;
            padding: 12px 24px;
            background: var(--surface);
            border: 2px solid var(--border);
            border-radius: 24px;
            color: var(--text-main);
            font-size: 16px;
            cursor: pointer;
            transition: var(--transition);
        }

        .biometric-btn:active {
            background: var(--hover);
            transform: translateY(-2px);
        }

        /* --- AUTH SCREEN --- */
        #auth-screen {
            background: linear-gradient(135deg, #f8f9fa 0%, #e8f0fe 100%);
            justify-content: center;
            align-items: center;
        }

        .dark-theme #auth-screen {
            background: linear-gradient(135deg, #202124 0%, #121212 100%);
        }

        .auth-card {
            background: var(--surface);
            border-radius: var(--radius-xl);
            padding: 48px 32px;
            width: 90%;
            max-width: 440px;
            box-shadow: var(--shadow);
            text-align: center;
            border: 1px solid var(--border);
            transform: translateY(0);
            transition: var(--transition);
        }

        .auth-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
        }

        .auth-logo {
            width: 80px;
            height: 80px;
            background: linear-gradient(135deg, #1a73e8 0%, #34a853 100%);
            border-radius: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 24px;
        }

        .auth-logo img {
            width: 48px;
            height: 48px;
            filter: brightness(0) invert(1);
        }

        .auth-title {
            font-family: 'Google Sans';
            font-size: 32px;
            font-weight: 700;
            color: var(--text-main);
            margin-bottom: 12px;
            letter-spacing: -0.5px;
        }

        .auth-subtitle {
            color: var(--text-sec);
            font-size: 16px;
            line-height: 1.5;
            margin-bottom: 40px;
            max-width: 320px;
            margin-left: auto;
            margin-right: auto;
        }

        .google-signin-btn {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 16px;
            width: 100%;
            padding: 18px 24px;
            background: var(--surface);
            border: 2px solid var(--border);
            border-radius: 12px;
            font-family: 'Google Sans';
            font-size: 16px;
            font-weight: 500;
            color: var(--text-main);
            cursor: pointer;
            transition: var(--transition);
            margin-bottom: 24px;
        }

        .google-signin-btn:hover {
            background: var(--hover);
            border-color: var(--primary);
            transform: translateY(-2px);
        }

        .google-signin-btn img {
            width: 20px;
            height: 20px;
        }

        .auth-footer {
            font-size: 14px;
            color: var(--text-sec);
            line-height: 1.5;
        }

        /* --- APP HEADER --- */
        .app-header {
            height: 64px;
            background: var(--surface);
            display: flex;
            align-items: center;
            padding: 0 20px;
            border-bottom: 1px solid var(--border);
            position: relative;
            z-index: 100;
            flex-shrink: 0;
        }

        .header-left {
            display: flex;
            align-items: center;
            gap: 20px;
            flex: 1;
        }

        .app-title {
            font-family: 'Google Sans';
            font-size: 20px;
            font-weight: 500;
            color: var(--text-main);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .app-title img {
            width: 24px;
            height: 24px;
        }

        .search-container {
            flex: 1;
            max-width: 600px;
            position: relative;
        }

        .search-bar {
            background: var(--hover);
            border: 2px solid transparent;
            border-radius: 24px;
            padding: 12px 20px;
            display: flex;
            align-items: center;
            gap: 12px;
            transition: var(--transition);
        }

        .search-bar:focus-within {
            background: var(--surface);
            border-color: var(--primary);
            box-shadow: 0 0 0 3px var(--primary-light);
        }

        .search-bar input {
            flex: 1;
            background: transparent;
            border: none;
            color: var(--text-main);
            font-size: 16px;
            outline: none;
            font-family: 'Roboto';
        }

        .search-bar input::placeholder {
            color: var(--text-sec);
        }

        .header-right {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .header-btn {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            background: transparent;
            border: none;
            color: var(--text-main);
            cursor: pointer;
            transition: var(--transition);
            position: relative;
        }

        .header-btn:active {
            background: var(--hover);
            transform: scale(0.95);
        }

        .notification-badge {
            position: absolute;
            top: 4px;
            right: 4px;
            background: #ea4335;
            color: white;
            font-size: 10px;
            width: 16px;
            height: 16px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .user-avatar {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            cursor: pointer;
            border: 2px solid transparent;
            transition: var(--transition);
        }

        .user-avatar:hover {
            border-color: var(--primary);
            transform: scale(1.05);
        }

        /* --- TOOLBAR --- */
        .toolbar {
            height: 56px;
            background: var(--surface);
            display: flex;
            align-items: center;
            padding: 0 20px;
            border-bottom: 1px solid var(--border);
            gap: 20px;
            flex-shrink: 0;
        }

        .breadcrumb {
            display: flex;
            align-items: center;
            gap: 8px;
            flex: 1;
            overflow-x: auto;
            scrollbar-width: none;
        }

        .breadcrumb::-webkit-scrollbar {
            display: none;
        }

        .crumb {
            display: flex;
            align-items: center;
            gap: 8px;
            color: var(--text-main);
            font-size: 14px;
            white-space: nowrap;
        }

        .crumb-btn {
            background: transparent;
            border: none;
            color: var(--text-main);
            padding: 8px 12px;
            border-radius: var(--radius-sm);
            cursor: pointer;
            transition: var(--transition);
            font-family: 'Roboto';
            font-size: 14px;
        }

        .crumb-btn:hover {
            background: var(--hover);
        }

        .crumb-sep {
            color: var(--text-sec);
        }

        .toolbar-actions {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .action-btn {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            background: transparent;
            border: none;
            color: var(--text-sec);
            cursor: pointer;
            transition: var(--transition);
        }

        .action-btn:hover, .action-btn.active {
            background: var(--hover);
            color: var(--primary);
        }

        /* --- FILE VIEW --- */
        .file-view {
            flex: 1;
            overflow: hidden;
            position: relative;
            background: var(--bg);
        }

        .file-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
            gap: 16px;
            padding: 20px;
            overflow-y: auto;
            height: 100%;
            align-content: start;
        }

        .file-list {
            display: flex;
            flex-direction: column;
            padding: 8px;
            overflow-y: auto;
            height: 100%;
        }

        /* --- FILE ITEMS --- */
        .file-item {
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: var(--radius-sm);
            overflow: hidden;
            transition: var(--transition);
            cursor: pointer;
            position: relative;
        }

        .file-item:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow);
            border-color: var(--primary);
        }

        .file-item.selected {
            border-color: var(--primary);
            background: var(--primary-light);
        }

        .file-thumbnail {
            width: 100%;
            height: 120px;
            background: var(--hover);
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
            position: relative;
        }

        .file-thumbnail img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform 0.3s ease;
        }

        .file-item:hover .file-thumbnail img {
            transform: scale(1.05);
        }

        .file-icon {
            font-size: 48px;
            color: var(--text-sec);
        }

        .folder-icon {
            color: #fbbc04;
        }

        .image-icon { color: #34a853; }
        .video-icon { color: #ea4335; }
        .audio-icon { color: #9c27b0; }
        .doc-icon { color: #1a73e8; }
        .pdf-icon { color: #d93025; }

        .file-info {
            padding: 12px;
        }

        .file-name {
            font-size: 14px;
            font-weight: 500;
            color: var(--text-main);
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            margin-bottom: 4px;
        }

        .file-meta {
            font-size: 12px;
            color: var(--text-sec);
            display: flex;
            justify-content: space-between;
        }

        .file-size {
            font-weight: 500;
        }

        /* --- LIST VIEW --- */
        .list-item {
            display: flex;
            align-items: center;
            padding: 12px 16px;
            border-bottom: 1px solid var(--border);
            background: var(--surface);
            transition: var(--transition);
            cursor: pointer;
            gap: 16px;
        }

        .list-item:hover {
            background: var(--hover);
        }

        .list-item.selected {
            background: var(--primary-light);
            border-left: 4px solid var(--primary);
        }

        .list-icon {
            font-size: 24px;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 8px;
            background: var(--hover);
        }

        .list-info {
            flex: 1;
            min-width: 0;
        }

        .list-name {
            font-size: 14px;
            font-weight: 500;
            color: var(--text-main);
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            margin-bottom: 4px;
        }

        .list-meta {
            font-size: 12px;
            color: var(--text-sec);
            display: flex;
            gap: 12px;
        }

        .list-actions {
            display: flex;
            gap: 8px;
            opacity: 0;
            transition: var(--transition);
        }

        .list-item:hover .list-actions {
            opacity: 1;
        }

        /* --- BOTTOM NAV --- */
        .bottom-nav {
            height: 72px;
            background: var(--surface);
            border-top: 1px solid var(--border);
            display: flex;
            padding: 8px 20px;
            gap: 8px;
            flex-shrink: 0;
        }

        .nav-item {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 4px;
            background: transparent;
            border: none;
            border-radius: var(--radius-sm);
            color: var(--text-sec);
            cursor: pointer;
            transition: var(--transition);
            position: relative;
            padding: 8px 4px;
        }

        .nav-item:active {
            transform: scale(0.95);
        }

        .nav-item.active {
            color: var(--primary);
            background: var(--primary-light);
        }

        .nav-icon {
            font-size: 24px;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 12px;
            background: var(--hover);
            transition: var(--transition);
        }

        .nav-item.active .nav-icon {
            background: var(--primary);
            color: white;
        }

        .nav-label {
            font-size: 11px;
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        /* --- FAB --- */
        .fab-container {
            position: fixed;
            bottom: 88px;
            right: 20px;
            z-index: 1000;
        }

        .fab-main {
            width: 56px;
            height: 56px;
            border-radius: 16px;
            background: var(--primary);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: var(--transition);
            box-shadow: 0 8px 24px rgba(26, 115, 232, 0.3);
            border: none;
            font-size: 24px;
        }

        .fab-main:active {
            transform: scale(0.95);
            box-shadow: 0 4px 12px rgba(26, 115, 232, 0.4);
        }

        .fab-menu {
            position: absolute;
            bottom: 64px;
            right: 0;
            background: var(--surface);
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow);
            min-width: 200px;
            display: none;
            flex-direction: column;
            overflow: hidden;
            border: 1px solid var(--border);
            z-index: 1001;
        }

        .fab-item {
            padding: 16px 20px;
            display: flex;
            align-items: center;
            gap: 16px;
            color: var(--text-main);
            cursor: pointer;
            transition: var(--transition);
            border: none;
            background: transparent;
            font-family: 'Roboto';
            font-size: 14px;
            text-align: left;
        }

        .fab-item:active {
            background: var(--hover);
        }

        /* --- MINI UPLOAD BAR --- */
        .upload-bar {
            position: fixed;
            bottom: 72px;
            left: 20px;
            right: 20px;
            background: var(--surface);
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            padding: 12px 16px;
            display: none;
            align-items: center;
            gap: 12px;
            z-index: 999;
            border: 1px solid var(--border);
            transform: translateY(100px);
            transition: transform 0.3s ease;
        }

        .upload-bar.visible {
            transform: translateY(0);
            display: flex;
        }

        .upload-progress {
            flex: 1;
        }

        .upload-info {
            font-size: 12px;
            color: var(--text-sec);
            display: flex;
            justify-content: space-between;
            margin-bottom: 4px;
        }

        .upload-bar .progress {
            height: 4px;
            background: var(--hover);
            border-radius: 2px;
            overflow: hidden;
        }

        .upload-bar .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--primary), var(--secondary));
            width: 0%;
            transition: width 0.3s ease;
        }

        .upload-cancel {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            background: var(--hover);
            color: var(--text-sec);
            cursor: pointer;
            border: none;
            transition: var(--transition);
        }

        .upload-cancel:active {
            background: var(--border);
        }

        /* --- MEDIA PLAYER --- */
        .media-player {
            position: fixed;
            top: 0; left: 0;
            width: 100%; height: 100%;
            background: #000;
            z-index: 2000;
            display: none;
            flex-direction: column;
        }

        .media-header {
            padding: 20px;
            background: linear-gradient(to bottom, rgba(0,0,0,0.8), transparent);
            color: white;
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: absolute;
            top: 0; left: 0; right: 0;
            z-index: 10;
        }

        .media-title {
            font-size: 18px;
            font-weight: 500;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            max-width: 70%;
        }

        .media-controls {
            display: flex;
            gap: 16px;
        }

        .media-btn {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: rgba(255,255,255,0.1);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: var(--transition);
            border: none;
            backdrop-filter: blur(10px);
        }

        .media-btn:active {
            background: rgba(255,255,255,0.2);
            transform: scale(0.95);
        }

        .media-content {
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
        }

        .media-img {
            max-width: 100%;
            max-height: 100%;
            object-fit: contain;
        }

        .media-video {
            width: 100%;
            height: 100%;
            max-width: 100%;
            max-height: 100%;
            object-fit: contain;
        }

        .media-footer {
            padding: 20px;
            background: linear-gradient(to top, rgba(0,0,0,0.8), transparent);
            color: white;
            position: absolute;
            bottom: 0; left: 0; right: 0;
            z-index: 10;
        }

        .video-controls {
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .progress-bar {
            flex: 1;
            height: 4px;
            background: rgba(255,255,255,0.2);
            border-radius: 2px;
            cursor: pointer;
            position: relative;
        }

        .progress-played {
            height: 100%;
            background: var(--primary);
            border-radius: 2px;
            width: 0%;
        }

        .time-display {
            font-size: 14px;
            font-weight: 500;
            min-width: 100px;
            text-align: center;
        }

        /* --- MODALS --- */
        .modal-backdrop {
            position: fixed;
            top: 0; left: 0;
            width: 100%; height: 100%;
            background: rgba(0,0,0,0.5);
            backdrop-filter: blur(5px);
            display: none;
            align-items: flex-end;
            justify-content: center;
            z-index: 1500;
        }

        .modal-sheet {
            background: var(--surface);
            width: 100%;
            max-width: 600px;
            border-radius: var(--radius-xl) var(--radius-xl) 0 0;
            padding: 32px 20px 40px;
            transform: translateY(100%);
            transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            max-height: 80vh;
            overflow-y: auto;
        }

        .modal-backdrop.active .modal-sheet {
            transform: translateY(0);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 24px;
            padding-bottom: 16px;
            border-bottom: 1px solid var(--border);
        }

        .modal-title {
            font-family: 'Google Sans';
            font-size: 20px;
            font-weight: 500;
            color: var(--text-main);
        }

        .modal-close {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            background: var(--hover);
            color: var(--text-main);
            cursor: pointer;
            border: none;
            transition: var(--transition);
        }

        .modal-close:active {
            background: var(--border);
        }

        .action-list {
            display: flex;
            flex-direction: column;
        }

        .action-item {
            padding: 16px 0;
            display: flex;
            align-items: center;
            gap: 16px;
            color: var(--text-main);
            cursor: pointer;
            transition: var(--transition);
            border-bottom: 1px solid var(--border);
        }

        .action-item:last-child {
            border-bottom: none;
        }

        .action-item:active {
            background: var(--hover);
        }

        .action-item.danger {
            color: #ea4335;
        }

        /* --- SETTINGS --- */
        .settings-group {
            margin-bottom: 32px;
        }

        .settings-title {
            font-size: 12px;
            font-weight: 500;
            color: var(--text-sec);
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 16px;
        }

        .setting-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 16px 0;
            border-bottom: 1px solid var(--border);
        }

        .setting-label {
            flex: 1;
        }

        .setting-name {
            font-size: 16px;
            font-weight: 500;
            color: var(--text-main);
            margin-bottom: 4px;
        }

        .setting-desc {
            font-size: 14px;
            color: var(--text-sec);
        }

        /* --- SWITCH --- */
        .switch {
            position: relative;
            width: 52px;
            height: 32px;
        }

        .switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .slider {
            position: absolute;
            cursor: pointer;
            top: 0; left: 0; right: 0; bottom: 0;
            background-color: var(--border);
            transition: var(--transition);
            border-radius: 32px;
        }

        .slider:before {
            position: absolute;
            content: "";
            height: 24px;
            width: 24px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: var(--transition);
            border-radius: 50%;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }

        input:checked + .slider {
            background-color: var(--primary);
        }

        input:checked + .slider:before {
            transform: translateX(20px);
        }

        /* --- STORAGE INFO --- */
        .storage-info {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            border-radius: var(--radius);
            padding: 24px;
            color: white;
            margin: 20px 0;
        }

        .storage-stats {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }

        .storage-used {
            font-size: 24px;
            font-weight: 700;
        }

        .storage-total {
            font-size: 14px;
            opacity: 0.9;
        }

        .storage-bar {
            height: 8px;
            background: rgba(255,255,255,0.2);
            border-radius: 4px;
            overflow: hidden;
            margin: 16px 0;
        }

        .storage-fill {
            height: 100%;
            background: white;
            border-radius: 4px;
            width: 0%;
            transition: width 0.5s ease;
        }

        .storage-breakdown {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 12px;
            margin-top: 20px;
        }

        .storage-type {
            text-align: center;
        }

        .storage-type-name {
            font-size: 12px;
            opacity: 0.8;
            margin-bottom: 4px;
        }

        .storage-type-size {
            font-size: 16px;
            font-weight: 600;
        }

        /* --- EMPTY STATE --- */
        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: var(--text-sec);
        }

        .empty-icon {
            font-size: 64px;
            margin-bottom: 20px;
            opacity: 0.5;
        }

        .empty-title {
            font-size: 20px;
            font-weight: 500;
            margin-bottom: 8px;
            color: var(--text-main);
        }

        .empty-desc {
            font-size: 16px;
            line-height: 1.5;
            max-width: 300px;
            margin: 0 auto;
        }

        /* --- LOADING --- */
        .loading {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 60px 20px;
            color: var(--text-sec);
        }

        .loading-spinner {
            width: 40px;
            height: 40px;
            border: 3px solid var(--border);
            border-top-color: var(--primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-bottom: 20px;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* --- DRAG & DROP --- */
        .drop-zone {
            position: fixed;
            top: 0; left: 0;
            width: 100%; height: 100%;
            background: rgba(26, 115, 232, 0.1);
            border: 3px dashed var(--primary);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 9999;
            backdrop-filter: blur(10px);
            pointer-events: none;
        }

        .drop-zone.active {
            display: flex;
            animation: pulse 2s infinite;
        }

        .drop-content {
            text-align: center;
            color: var(--primary);
        }

        .drop-icon {
            font-size: 64px;
            margin-bottom: 20px;
        }

        .drop-text {
            font-size: 24px;
            font-weight: 500;
        }

        /* --- CONTEXT MENU --- */
        .context-menu {
            position: fixed;
            background: var(--surface);
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            min-width: 200px;
            display: none;
            flex-direction: column;
            overflow: hidden;
            z-index: 1000;
            border: 1px solid var(--border);
            animation: fadeIn 0.2s ease;
        }

        .context-item {
            padding: 16px 20px;
            display: flex;
            align-items: center;
            gap: 12px;
            color: var(--text-main);
            cursor: pointer;
            transition: var(--transition);
            border: none;
            background: transparent;
            font-size: 14px;
            text-align: left;
        }

        .context-item:active {
            background: var(--hover);
        }

        /* --- UTILITY CLASSES --- */
        .hidden { display: none !important; }
        .flex { display: flex; }
        .grid { display: grid; }
        .text-center { text-align: center; }
        .mt-1 { margin-top: 4px; }
        .mt-2 { margin-top: 8px; }
        .mt-3 { margin-top: 12px; }
        .mt-4 { margin-top: 16px; }
        .mt-5 { margin-top: 20px; }
        .mb-1 { margin-bottom: 4px; }
        .mb-2 { margin-bottom: 8px; }
        .mb-3 { margin-bottom: 12px; }
        .mb-4 { margin-bottom: 16px; }
        .mb-5 { margin-bottom: 20px; }
        .p-1 { padding: 4px; }
        .p-2 { padding: 8px; }
        .p-3 { padding: 12px; }
        .p-4 { padding: 16px; }
        .p-5 { padding: 20px; }

        /* --- PERFORMANCE OPTIMIZATIONS --- */
        .will-change-transform {
            will-change: transform;
        }

        .backface-hidden {
            backface-visibility: hidden;
            -webkit-backface-visibility: hidden;
        }

        /* --- IOS SAFARI FIXES --- */
        @supports (-webkit-touch-callout: none) {
            .app-container {
                height: -webkit-fill-available;
            }
        }

    </style>
</head>
<body>

    <!-- Splash Screen -->
    <div id="splash-screen">
        <div class="splash-logo">
            <img src="https://www.gstatic.com/images/branding/product/2x/drive_2020q4_48dp.png" alt="Drive">
        </div>
        <div class="splash-text">Drive OS Pro</div>
    </div>

    <!-- Lock Screen -->
    <div id="lock-screen" class="app-container">
        <div class="lock-container">
            <div class="lock-logo">Drive OS Pro</div>
            <div class="lock-subtitle">Enter PIN to continue</div>
            
            <div class="pin-display" id="pin-display">
                <div class="pin-dot"></div>
                <div class="pin-dot"></div>
                <div class="pin-dot"></div>
                <div class="pin-dot"></div>
            </div>

            <div class="keypad">
                <button class="key" onclick="Keypad.press(1)">1</button>
                <button class="key" onclick="Keypad.press(2)">2</button>
                <button class="key" onclick="Keypad.press(3)">3</button>
                <button class="key" onclick="Keypad.press(4)">4</button>
                <button class="key" onclick="Keypad.press(5)">5</button>
                <button class="key" onclick="Keypad.press(6)">6</button>
                <button class="key" onclick="Keypad.press(7)">7</button>
                <button class="key" onclick="Keypad.press(8)">8</button>
                <button class="key" onclick="Keypad.press(9)">9</button>
                <button class="key utility" onclick="Keypad.clear()">Clear</button>
                <button class="key" onclick="Keypad.press(0)">0</button>
                <button class="key utility" onclick="Keypad.backspace()">
                    <span class="material-icons-round">backspace</span>
                </button>
            </div>

            <div class="biometric-option">
                <button class="biometric-btn" onclick="Keypad.useFingerprint()">
                    <span class="material-icons-round">fingerprint</span>
                    Use Fingerprint
                </button>
            </div>
        </div>
    </div>

    <!-- Auth Screen -->
    <div id="auth-screen" class="app-container">
        <div class="auth-card">
            <div class="auth-logo">
                <img src="https://www.gstatic.com/images/branding/product/2x/drive_2020q4_48dp.png" alt="Google Drive">
            </div>
            
            <h1 class="auth-title">Welcome to Drive OS Pro</h1>
            <p class="auth-subtitle">Connect your Google Drive to access files with enhanced security and features</p>
            
            <button class="google-signin-btn" onclick="Auth.signIn()">
                <img src="https://www.gstatic.com/firebasejs/ui/2.0.0/images/auth/google.svg" alt="Google">
                Sign in with Google
            </button>
            
            <p class="auth-footer">
                By signing in, you agree to Google's Terms of Service and Privacy Policy
            </p>
        </div>
    </div>

    <!-- Main App -->
    <div id="app-screen" class="app-container">
        <!-- Drop Zone -->
        <div class="drop-zone" id="drop-zone">
            <div class="drop-content">
                <div class="drop-icon material-icons-round">cloud_upload</div>
                <div class="drop-text">Drop files here to upload</div>
            </div>
        </div>

        <!-- App Header -->
        <header class="app-header">
            <div class="header-left">
                <button class="header-btn" onclick="UI.toggleSidebar()">
                    <span class="material-icons-round">menu</span>
                </button>
                
                <div class="app-title">
                    <img src="https://www.gstatic.com/images/branding/product/2x/drive_2020q4_48dp.png" alt="">
                    Drive OS Pro
                </div>
                
                <div class="search-container">
                    <div class="search-bar">
                        <span class="material-icons-round">search</span>
                        <input type="text" placeholder="Search files..." id="search-input">
                    </div>
                </div>
            </div>
            
            <div class="header-right">
                <button class="header-btn" onclick="Drive.refresh()" title="Refresh">
                    <span class="material-icons-round">refresh</span>
                </button>
                
                <button class="header-btn" onclick="Notifications.show()" title="Notifications">
                    <span class="material-icons-round">notifications</span>
                    <span class="notification-badge">3</span>
                </button>
                
                <img class="user-avatar" id="user-avatar" src="" alt="User" onclick="Settings.open()">
            </div>
        </header>

        <!-- Toolbar -->
        <div class="toolbar">
            <div class="breadcrumb" id="breadcrumb">
                <button class="crumb-btn" onclick="Drive.navigate('root')">
                    <span class="material-icons-round">home</span>
                    My Drive
                </button>
            </div>
            
            <div class="toolbar-actions">
                <button class="action-btn" onclick="Drive.sortMenu()" title="Sort">
                    <span class="material-icons-round">sort</span>
                </button>
                <button class="action-btn active" onclick="UI.setView('grid')" title="Grid View">
                    <span class="material-icons-round">grid_view</span>
                </button>
                <button class="action-btn" onclick="UI.setView('list')" title="List View">
                    <span class="material-icons-round">view_list</span>
                </button>
                <button class="action-btn" onclick="UI.setView('gallery')" title="Gallery View">
                    <span class="material-icons-round">collections</span>
                </button>
            </div>
        </div>

        <!-- File View -->
        <main class="file-view">
            <div class="file-grid" id="file-grid">
                <!-- Files will be rendered here -->
            </div>
            
            <div class="file-list hidden" id="file-list">
                <!-- List view will be rendered here -->
            </div>
        </main>

        <!-- Bottom Navigation -->
        <nav class="bottom-nav">
            <button class="nav-item active" onclick="Nav.switch('home')">
                <div class="nav-icon material-icons-round">home</div>
                <div class="nav-label">Home</div>
            </button>
            
            <button class="nav-item" onclick="Nav.switch('photos')">
                <div class="nav-icon material-icons-round">photo</div>
                <div class="nav-label">Photos</div>
            </button>
            
            <button class="nav-item" onclick="Nav.switch('vault')">
                <div class="nav-icon material-icons-round">lock</div>
                <div class="nav-label">Vault</div>
            </button>
            
            <button class="nav-item" onclick="Nav.switch('shared')">
                <div class="nav-icon material-icons-round">share</div>
                <div class="nav-label">Shared</div>
            </button>
            
            <button class="nav-item" onclick="Nav.switch('recent')">
                <div class="nav-icon material-icons-round">schedule</div>
                <div class="nav-label">Recent</div>
            </button>
        </nav>

        <!-- FAB Menu -->
        <div class="fab-container">
            <div class="fab-menu" id="fab-menu">
                <button class="fab-item" onclick="Upload.openFilePicker()">
                    <span class="material-icons-round">upload_file</span>
                    Upload File
                </button>
                <button class="fab-item" onclick="Upload.openFolderPicker()">
                    <span class="material-icons-round">drive_folder_upload</span>
                    Upload Folder
                </button>
                <button class="fab-item" onclick="Drive.createFolder()">
                    <span class="material-icons-round">create_new_folder</span>
                    New Folder
                </button>
                <button class="fab-item" onclick="Drive.createDocument()">
                    <span class="material-icons-round">description</span>
                    New Document
                </button>
            </div>
            <button class="fab-main" onclick="UI.toggleFab()">
                <span class="material-icons-round">add</span>
            </button>
        </div>

        <!-- Mini Upload Bar -->
        <div class="upload-bar" id="upload-bar">
            <div class="upload-progress">
                <div class="upload-info">
                    <span id="upload-file-name">Uploading...</span>
                    <span id="upload-percent">0%</span>
                </div>
                <div class="progress">
                    <div class="progress-fill" id="upload-progress-fill"></div>
                </div>
            </div>
            <button class="upload-cancel" onclick="Upload.cancel()">
                <span class="material-icons-round">close</span>
            </button>
        </div>
    </div>

    <!-- Sidebar -->
    <div class="modal-backdrop" id="sidebar" onclick="UI.closeSidebar(event)">
        <div class="modal-sheet">
            <div class="modal-header">
                <h2 class="modal-title">Menu</h2>
                <button class="modal-close" onclick="UI.closeSidebar()">
                    <span class="material-icons-round">close</span>
                </button>
            </div>
            
            <div class="sidebar-content">
                <div class="settings-group">
                    <div class="settings-title">Storage</div>
                    <div class="storage-info" id="storage-info">
                        <div class="storage-stats">
                            <div class="storage-used" id="storage-used">0 GB</div>
                            <div class="storage-total" id="storage-total">15 GB</div>
                        </div>
                        <div class="storage-bar">
                            <div class="storage-fill" id="storage-fill"></div>
                        </div>
                        <div class="storage-breakdown">
                            <div class="storage-type">
                                <div class="storage-type-name">Drive</div>
                                <div class="storage-type-size" id="drive-storage">0 GB</div>
                            </div>
                            <div class="storage-type">
                                <div class="storage-type-name">Vault</div>
                                <div class="storage-type-size" id="vault-storage">0 GB</div>
                            </div>
                            <div class="storage-type">
                                <div class="storage-type-name">Photos</div>
                                <div class="storage-type-size" id="photos-storage">0 GB</div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="settings-group">
                    <div class="settings-title">Actions</div>
                    <button class="action-item" onclick="Drive.copyToVault()">
                        <span class="material-icons-round">drive_file_move</span>
                        Copy to Vault
                    </button>
                    <button class="action-item" onclick="Drive.moveToVault()">
                        <span class="material-icons-round">drive_file_move</span>
                        Move to Vault
                    </button>
                    <button class="action-item" onclick="Drive.copyToDrive()">
                        <span class="material-icons-round">drive_file_move</span>
                        Copy to Drive
                    </button>
                    <button class="action-item" onclick="Drive.moveToDrive()">
                        <span class="material-icons-round">drive_file_move</span>
                        Move to Drive
                    </button>
                </div>
                
                <div class="settings-group">
                    <div class="settings-title">Settings</div>
                    <div class="setting-item">
                        <div class="setting-label">
                            <div class="setting-name">Dark Mode</div>
                            <div class="setting-desc">Use dark theme</div>
                        </div>
                        <label class="switch">
                            <input type="checkbox" id="dark-mode-toggle" onchange="Settings.toggleDarkMode()">
                            <span class="slider"></span>
                        </label>
                    </div>
                    <div class="setting-item">
                        <div class="setting-label">
                            <div class="setting-name">External Download</div>
                            <div class="setting-desc">Open in new tab</div>
                        </div>
                        <label class="switch">
                            <input type="checkbox" id="external-download-toggle" onchange="Settings.toggleExternalDownload()">
                            <span class="slider"></span>
                        </label>
                    </div>
                    <button class="action-item" onclick="Settings.show()">
                        <span class="material-icons-round">settings</span>
                        All Settings
                    </button>
                </div>
                
                <button class="action-item danger" onclick="Auth.logout()">
                    <span class="material-icons-round">logout</span>
                    Sign Out
                </button>
            </div>
        </div>
    </div>

    <!-- Media Player -->
    <div class="media-player" id="media-player">
        <div class="media-header">
            <div class="media-title" id="media-title">Preview</div>
            <div class="media-controls">
                <button class="media-btn" onclick="MediaPlayer.download()">
                    <span class="material-icons-round">download</span>
                </button>
                <button class="media-btn" onclick="MediaPlayer.share()">
                    <span class="material-icons-round">share</span>
                </button>
                <button class="media-btn" onclick="MediaPlayer.close()">
                    <span class="material-icons-round">close</span>
                </button>
            </div>
        </div>
        
        <div class="media-content" id="media-content">
            <!-- Media content will be inserted here -->
        </div>
        
        <div class="media-footer" id="media-footer">
            <div class="video-controls">
                <button class="media-btn" onclick="MediaPlayer.togglePlay()">
                    <span class="material-icons-round" id="play-btn">play_arrow</span>
                </button>
                <div class="progress-bar" onclick="MediaPlayer.seek(event)">
                    <div class="progress-played" id="progress-played"></div>
                </div>
                <div class="time-display" id="time-display">0:00 / 0:00</div>
                <button class="media-btn" onclick="MediaPlayer.toggleMute()">
                    <span class="material-icons-round" id="volume-btn">volume_up</span>
                </button>
            </div>
        </div>
    </div>

    <!-- Context Menu -->
    <div class="context-menu" id="context-menu">
        <button class="context-item" onclick="FileActions.preview()">
            <span class="material-icons-round">visibility</span>
            Preview
        </button>
        <button class="context-item" onclick="FileActions.download()">
            <span class="material-icons-round">download</span>
            Download
        </button>
        <button class="context-item" onclick="FileActions.share()">
            <span class="material-icons-round">share</span>
            Share
        </button>
        <button class="context-item" onclick="FileActions.copyLink()">
            <span class="material-icons-round">link</span>
            Copy Link
        </button>
        <button class="context-item" onclick="FileActions.rename()">
            <span class="material-icons-round">edit</span>
            Rename
        </button>
        <button class="context-item" onclick="FileActions.move()">
            <span class="material-icons-round">drive_file_move</span>
            Move
        </button>
        <button class="context-item" onclick="FileActions.copy()">
            <span class="material-icons-round">content_copy</span>
            Copy
        </button>
        <button class="context-item danger" onclick="FileActions.delete()">
            <span class="material-icons-round">delete</span>
            Delete
        </button>
    </div>

    <!-- File Input (Hidden) -->
    <input type="file" id="file-input" multiple hidden>
    <input type="file" id="folder-input" webkitdirectory hidden>

    <script>
        // ==================== CONFIGURATION ====================
        const CONFIG = {
            proxyUrl: 'https://script.google.com/macros/s/AKfycbwZ10LXbPwx4DAKVn77TX33M9t741Cv1N50UOhq0ct-Fs6COIXhCWOfPa3WPHVnNjQo/exec',
            apiKey: 'AIzaSyB3Iy1MIbfmJ7h5rv9NlsT23ysedCwUZt4',
            clientId: '318681315152-65e9kofptt4c3bk3kmlj9gmksnasu347.apps.googleusercontent.com',
            scopes: 'https://www.googleapis.com/auth/drive https://www.googleapis.com/auth/userinfo.email',
            vaultId: '1zIyinAqjQv96QBSuanFS2F0USaG66GPn',
            appVersion: '2.0.0'
        };

        // ==================== PROXY API ====================
        const ProxyAPI = {
            async call(action, params = {}) {
                try {
                    params.action = action;
                    params.apiKey = CONFIG.apiKey;
                    
                    if (STATE.token) {
                        params.access_token = STATE.token;
                    }
                    
                    // Convert arrays to JSON strings for URL parameters
                    Object.keys(params).forEach(key => {
                        if (Array.isArray(params[key])) {
                            params[key] = JSON.stringify(params[key]);
                        }
                    });
                    
                    const queryString = Object.keys(params)
                        .map(key => `${encodeURIComponent(key)}=${encodeURIComponent(params[key])}`)
                        .join('&');
                    
                    const response = await fetch(`${CONFIG.proxyUrl}?${queryString}`);
                    const data = await response.json();
                    
                    if (!data.success) {
                        throw new Error(data.error || 'Proxy request failed');
                    }
                    
                    return data;
                } catch (error) {
                    console.error(`Proxy API Error (${action}):`, error);
                    throw error;
                }
            },
            
            async listFiles(folderId = 'root', options = {}) {
                const params = {
                    folderId: folderId,
                    pageSize: options.pageSize || 1000,
                    orderBy: options.orderBy || 'modifiedTime desc'
                };
                
                if (options.search) params.search = options.search;
                if (options.type) params.type = options.type;
                if (options.sharedWithMe) params.sharedWithMe = 'true';
                
                return await this.call('files_list', params);
            },
            
            async getFile(fileId) {
                return await this.call('file_get', { fileId });
            },
            
            async copyFile(fileId, targetId, newName = null) {
                const params = { fileId, targetId };
                if (newName) params.newName = newName;
                return await this.call('file_copy', params);
            },
            
            async moveFile(fileId, targetId) {
                return await this.call('file_move', { fileId, targetId });
            },
            
            async renameFile(fileId, newName) {
                return await this.call('file_rename', { fileId, newName });
            },
            
            async deleteFile(fileId, permanent = false) {
                return await this.call('file_delete', { 
                    fileId, 
                    permanent: permanent ? 'true' : 'false' 
                });
            },
            
            async createFolder(name, parentId = 'root') {
                return await this.call('folder_create', { name, parentId });
            },
            
            async getStorageInfo() {
                return await this.call('storage_info');
            },
            
            async getMediaPreview(fileId) {
                return await this.call('media_preview', { fileId });
            },
            
            async getMediaStream(fileId) {
                return await this.call('media_stream', { fileId });
            },
            
            async createZip(fileIds, zipName = null) {
                return await this.call('zip_create', { 
                    fileIds: JSON.stringify(fileIds),
                    zipName: zipName || `download_${Date.now()}.zip`
                });
            },
            
            async analyzeStorage(folderId = 'root') {
                return await this.call('analyze_storage', { folderId });
            },
            
            async findDuplicates(folderId = 'root') {
                return await this.call('find_duplicates', { folderId });
            },
            
            async getSystemInfo() {
                return await this.call('system_info');
            }
        };

        // ==================== STATE MANAGEMENT ====================
        const STATE = {
            // Auth
            token: localStorage.getItem('g_token'),
            user: JSON.parse(localStorage.getItem('g_user') || '{}'),
            
            // Navigation
            currentFolder: 'root',
            folderStack: [],
            currentView: 'home',
            viewMode: 'grid',
            
            // Files
            files: [],
            folders: [],
            images: [],
            selectedFile: null,
            selectedFiles: new Set(),
            
            // Settings
            settings: JSON.parse(localStorage.getItem('app_settings') || '{"darkMode": false, "externalDownload": false, "sortBy": "name", "sortOrder": "asc"}'),
            
            // Upload
            uploadQueue: [],
            isUploading: false,
            uploadProgress: 0,
            
            // Performance
            renderCache: new Map(),
            lastRenderTime: 0
        };

        // ==================== PIN SYSTEM ====================
        const Keypad = {
            pin: '',
            maxLength: 4,
            
            press(num) {
                if (this.pin.length < this.maxLength) {
                    this.pin += num;
                    this.updateDisplay();
                    
                    if (this.pin.length === this.maxLength) {
                        setTimeout(() => this.verify(), 300);
                    }
                }
            },
            
            clear() {
                this.pin = '';
                this.updateDisplay();
            },
            
            backspace() {
                this.pin = this.pin.slice(0, -1);
                this.updateDisplay();
            },
            
            updateDisplay() {
                const dots = document.querySelectorAll('.pin-dot');
                dots.forEach((dot, index) => {
                    dot.classList.toggle('filled', index < this.pin.length);
                });
            },
            
            verify() {
                const storedPin = localStorage.getItem('app_pin');
                if (!storedPin) {
                    // First time setup
                    localStorage.setItem('app_pin', btoa(this.pin));
                    this.pin = '';
                    this.updateDisplay();
                    Auth.check();
                    return;
                }
                
                if (btoa(this.pin) === storedPin) {
                    this.pin = '';
                    this.updateDisplay();
                    Auth.check();
                } else {
                    this.pin = '';
                    this.updateDisplay();
                    UI.showToast('Wrong PIN', 'error');
                }
            },
            
            useFingerprint() {
                if ('credentials' in navigator) {
                    navigator.credentials.get({
                        publicKey: {
                            challenge: new Uint8Array(32),
                            allowCredentials: [],
                            timeout: 60000,
                            userVerification: 'required'
                        }
                    }).then(cred => {
                        if (cred) {
                            Auth.check();
                        }
                    }).catch(() => {
                        UI.showToast('Fingerprint not available', 'warning');
                    });
                } else {
                    UI.showToast('Fingerprint not supported', 'warning');
                }
            }
        };

        // ==================== AUTHENTICATION ====================
        const Auth = {
            tokenClient: null,
            
            init() {
                google.accounts.id.initialize({
                    client_id: CONFIG.clientId,
                    callback: this.handleCredentialResponse.bind(this)
                });
                
                this.tokenClient = google.accounts.oauth2.initTokenClient({
                    client_id: CONFIG.clientId,
                    scope: CONFIG.scopes,
                    callback: this.handleTokenResponse.bind(this)
                });
            },
            
            handleCredentialResponse(response) {
                console.log('Google Sign-In response:', response);
            },
            
            handleTokenResponse(response) {
                if (response.error) {
                    UI.showToast('Sign-in failed', 'error');
                    return;
                }
                
                STATE.token = response.access_token;
                localStorage.setItem('g_token', STATE.token);
                localStorage.setItem('g_exp', Date.now() + 3600 * 1000);
                
                this.loadUserProfile();
            },
            
            signIn() {
                this.tokenClient.requestAccessToken();
            },
            
            async loadUserProfile() {
                try {
                    const response = await fetch('https://www.googleapis.com/oauth2/v3/userinfo', {
                        headers: { 'Authorization': `Bearer ${STATE.token}` }
                    });
                    
                    const user = await response.json();
                    STATE.user = user;
                    localStorage.setItem('g_user', JSON.stringify(user));
                    
                    document.getElementById('user-avatar').src = user.picture;
                    UI.showScreen('app-screen');
                    Drive.load('root');
                    
                    UI.showToast(`Welcome ${user.name}`, 'success');
                } catch (error) {
                    console.error('Failed to load user profile:', error);
                }
            },
            
            check() {
                const expiry = localStorage.getItem('g_exp');
                
                if (STATE.token && expiry && Date.now() < parseInt(expiry)) {
                    this.loadUserProfile();
                } else {
                    UI.showScreen('auth-screen');
                }
            },
            
            logout() {
                if (confirm('Are you sure you want to sign out?')) {
                    google.accounts.oauth2.revoke(STATE.token, () => {
                        localStorage.clear();
                        location.reload();
                    });
                }
            }
        };

        // ==================== DRIVE ENGINE ====================
        const Drive = {
            currentPath: [],
            
            async load(folderId = 'root', folderName = 'My Drive') {
                try {
                    UI.showLoading();
                    
                    if (folderId !== 'root') {
                        this.currentPath.push({ id: folderId, name: folderName });
                    } else {
                        this.currentPath = [];
                    }
                    
                    STATE.currentFolder = folderId;
                    
                    this.updateBreadcrumb();
                    
                    const data = await ProxyAPI.listFiles(folderId, {
                        pageSize: 1000,
                        orderBy: 'name'
                    });
                    
                    if (!data.files) {
                        throw new Error('No files data received');
                    }
                    
                    // Separate folders and files
                    STATE.folders = data.files.filter(f => f.isFolder);
                    STATE.files = data.files.filter(f => !f.isFolder);
                    STATE.images = STATE.files.filter(f => f.mimeType && f.mimeType.startsWith('image/'));
                    
                    this.applySorting();
                    
                    if (STATE.viewMode === 'grid') {
                        this.renderGrid();
                    } else if (STATE.viewMode === 'list') {
                        this.renderList();
                    } else if (STATE.viewMode === 'gallery') {
                        this.renderGallery();
                    }
                    
                    this.updateStorageInfo();
                    
                } catch (error) {
                    console.error('Failed to load files:', error);
                    UI.showToast('Failed to load files', 'error');
                } finally {
                    UI.hideLoading();
                }
            },
            
            renderGrid() {
                const container = document.getElementById('file-grid');
                container.innerHTML = '';
                
                STATE.folders.forEach(folder => {
                    const item = this.createFolderItem(folder);
                    container.appendChild(item);
                });
                
                STATE.files.forEach(file => {
                    const item = this.createFileItem(file);
                    container.appendChild(item);
                });
                
                if (STATE.folders.length === 0 && STATE.files.length === 0) {
                    container.innerHTML = `
                        <div class="empty-state">
                            <div class="empty-icon material-icons-round">folder_open</div>
                            <div class="empty-title">No files yet</div>
                            <div class="empty-desc">Upload files or create folders to get started</div>
                        </div>
                    `;
                }
            },
            
            renderList() {
                const container = document.getElementById('file-list');
                container.innerHTML = '';
                
                STATE.folders.forEach(folder => {
                    const item = this.createListItem(folder);
                    container.appendChild(item);
                });
                
                STATE.files.forEach(file => {
                    const item = this.createListItem(file);
                    container.appendChild(item);
                });
                
                if (STATE.folders.length === 0 && STATE.files.length === 0) {
                    container.innerHTML = `
                        <div class="empty-state">
                            <div class="empty-icon material-icons-round">folder_open</div>
                            <div class="empty-title">No files yet</div>
                            <div class="empty-desc">Upload files or create folders to get started</div>
                        </div>
                    `;
                }
            },
            
            renderGallery() {
                const container = document.getElementById('file-grid');
                container.innerHTML = '';
                
                STATE.images.forEach(image => {
                    const item = this.createGalleryItem(image);
                    container.appendChild(item);
                });
                
                if (STATE.images.length === 0) {
                    container.innerHTML = `
                        <div class="empty-state">
                            <div class="empty-icon material-icons-round">photo</div>
                            <div class="empty-title">No photos</div>
                            <div class="empty-desc">Upload images to see them in gallery view</div>
                        </div>
                    `;
                }
            },
            
            createFolderItem(folder) {
                const div = document.createElement('div');
                div.className = 'file-item';
                div.onclick = () => this.load(folder.id, folder.name);
                
                div.innerHTML = `
                    <div class="file-thumbnail">
                        <span class="file-icon material-icons-round folder-icon">folder</span>
                    </div>
                    <div class="file-info">
                        <div class="file-name">${folder.name}</div>
                        <div class="file-meta">
                            <span class="file-size">Folder</span>
                            <span>${new Date(folder.modifiedTime || Date.now()).toLocaleDateString()}</span>
                        </div>
                    </div>
                `;
                
                return div;
            },
            
            createFileItem(file) {
                const div = document.createElement('div');
                div.className = 'file-item';
                div.onclick = () => FileActions.preview(file);
                div.oncontextmenu = (e) => {
                    e.preventDefault();
                    FileActions.showContextMenu(e, file);
                };
                
                const icon = this.getFileIcon(file.mimeType);
                const size = this.formatSize(file.size || 0);
                const date = new Date(file.modifiedTime || Date.now()).toLocaleDateString();
                
                div.innerHTML = `
                    <div class="file-thumbnail">
                        ${file.thumbnailLink ? 
                            `<img src="${file.thumbnailLink}" alt="${file.name}" loading="lazy">` :
                            `<span class="file-icon material-icons-round ${icon.class}">${icon.name}</span>`
                        }
                    </div>
                    <div class="file-info">
                        <div class="file-name">${file.name}</div>
                        <div class="file-meta">
                            <span class="file-size">${size}</span>
                            <span>${date}</span>
                        </div>
                    </div>
                `;
                
                return div;
            },
            
            createListItem(item) {
                const div = document.createElement('div');
                div.className = 'list-item';
                div.onclick = () => {
                    if (item.isFolder) {
                        this.load(item.id, item.name);
                    } else {
                        FileActions.preview(item);
                    }
                };
                div.oncontextmenu = (e) => {
                    e.preventDefault();
                    FileActions.showContextMenu(e, item);
                };
                
                const icon = this.getFileIcon(item.mimeType);
                const size = item.isFolder ? 'Folder' : this.formatSize(item.size || 0);
                const date = new Date(item.modifiedTime || Date.now()).toLocaleDateString();
                
                div.innerHTML = `
                    <div class="list-icon ${icon.class}">
                        <span class="material-icons-round">${icon.name}</span>
                    </div>
                    <div class="list-info">
                        <div class="list-name">${item.name}</div>
                        <div class="list-meta">
                            <span>${size}</span>
                            <span>${date}</span>
                        </div>
                    </div>
                    <div class="list-actions">
                        <button class="action-btn" onclick="event.stopPropagation(); FileActions.download('${item.id}')">
                            <span class="material-icons-round">download</span>
                        </button>
                        <button class="action-btn" onclick="event.stopPropagation(); FileActions.share('${item.id}')">
                            <span class="material-icons-round">share</span>
                        </button>
                    </div>
                `;
                
                return div;
            },
            
            createGalleryItem(image) {
                const div = document.createElement('div');
                div.className = 'file-item';
                div.onclick = () => FileActions.preview(image);
                div.oncontextmenu = (e) => {
                    e.preventDefault();
                    FileActions.showContextMenu(e, image);
                };
                
                const thumb = image.thumbnailLink || 'https://via.placeholder.com/150x150?text=Image';
                
                div.innerHTML = `
                    <div class="file-thumbnail">
                        <img src="${thumb}" alt="${image.name}" loading="lazy">
                    </div>
                    <div class="file-info">
                        <div class="file-name">${image.name}</div>
                        <div class="file-meta">
                            <span class="file-size">${this.formatSize(image.size || 0)}</span>
                        </div>
                    </div>
                `;
                
                return div;
            },
            
            getFileIcon(mimeType) {
                if (!mimeType || mimeType === 'application/vnd.google-apps.folder') {
                    return { name: 'folder', class: 'folder-icon' };
                } else if (mimeType.startsWith('image/')) {
                    return { name: 'image', class: 'image-icon' };
                } else if (mimeType.startsWith('video/')) {
                    return { name: 'movie', class: 'video-icon' };
                } else if (mimeType.startsWith('audio/')) {
                    return { name: 'audiotrack', class: 'audio-icon' };
                } else if (mimeType.includes('pdf')) {
                    return { name: 'picture_as_pdf', class: 'pdf-icon' };
                } else if (mimeType.includes('document') || mimeType.includes('text')) {
                    return { name: 'description', class: 'doc-icon' };
                } else {
                    return { name: 'insert_drive_file', class: '' };
                }
            },
            
            formatSize(bytes) {
                if (!bytes || bytes === 0) return '0 Bytes';
                
                const k = 1024;
                const sizes = ['Bytes', 'KB', 'MB', 'GB', 'TB'];
                const i = Math.floor(Math.log(bytes) / Math.log(k));
                
                return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
            },
            
            updateBreadcrumb() {
                const container = document.getElementById('breadcrumb');
                container.innerHTML = '';
                
                const homeBtn = document.createElement('button');
                homeBtn.className = 'crumb-btn';
                homeBtn.innerHTML = '<span class="material-icons-round">home</span> My Drive';
                homeBtn.onclick = () => this.load('root');
                container.appendChild(homeBtn);
                
                this.currentPath.forEach((item, index) => {
                    const sep = document.createElement('span');
                    sep.className = 'crumb-sep material-icons-round';
                    sep.textContent = 'chevron_right';
                    container.appendChild(sep);
                    
                    const btn = document.createElement('button');
                    btn.className = 'crumb-btn';
                    btn.textContent = item.name;
                    btn.onclick = () => {
                        this.currentPath = this.currentPath.slice(0, index + 1);
                        this.load(item.id, item.name);
                    };
                    container.appendChild(btn);
                });
            },
            
            applySorting() {
                const { sortBy, sortOrder } = STATE.settings;
                
                const sortFunc = (a, b) => {
                    let aVal, bVal;
                    
                    switch (sortBy) {
                        case 'name':
                            aVal = a.name.toLowerCase();
                            bVal = b.name.toLowerCase();
                            break;
                        case 'size':
                            aVal = a.size || 0;
                            bVal = b.size || 0;
                            break;
                        case 'date':
                            aVal = new Date(a.modifiedTime || 0).getTime();
                            bVal = new Date(b.modifiedTime || 0).getTime();
                            break;
                        default:
                            return 0;
                    }
                    
                    if (sortOrder === 'asc') {
                        return aVal > bVal ? 1 : -1;
                    } else {
                        return aVal < bVal ? 1 : -1;
                    }
                };
                
                STATE.folders.sort(sortFunc);
                STATE.files.sort(sortFunc);
            },
            
            async updateStorageInfo() {
                try {
                    const data = await ProxyAPI.getStorageInfo();
                    
                    if (data && data.storage) {
                        document.getElementById('storage-used').textContent = data.storage.used || '0 GB';
                        document.getElementById('storage-total').textContent = data.storage.total || '15 GB';
                        
                        const percent = data.storage.usagePercentage || 0;
                        document.getElementById('storage-fill').style.width = `${percent}%`;
                        
                        if (data.analytics && data.analytics.byType) {
                            const types = data.analytics.byType;
                            document.getElementById('drive-storage').textContent = 
                                this.formatSize(types.document || 0) + ' + ' + this.formatSize(types.other || 0);
                            document.getElementById('vault-storage').textContent = this.formatSize(0);
                            document.getElementById('photos-storage').textContent = this.formatSize(types.image || 0);
                        }
                    }
                } catch (error) {
                    console.error('Failed to load storage info:', error);
                }
            },
            
            navigate(folderId) {
                this.load(folderId);
            },
            
            refresh() {
                this.load(STATE.currentFolder);
                UI.showToast('Refreshed', 'success');
            },
            
            async createFolder() {
                const name = prompt('Enter folder name:');
                if (!name) return;
                
                try {
                    await ProxyAPI.createFolder(name, STATE.currentFolder);
                    
                    this.refresh();
                    UI.showToast('Folder created', 'success');
                } catch (error) {
                    UI.showToast('Failed to create folder', 'error');
                }
            },
            
            createDocument() {
                window.open('https://docs.google.com/document/create', '_blank');
            },
            
            sortMenu() {
                const sortOptions = ['name', 'size', 'date'];
                const currentSort = STATE.settings.sortBy;
                const currentOrder = STATE.settings.sortOrder;
                
                const newSort = prompt(`Current: ${currentSort} (${currentOrder})\n\nEnter sort option:\n- name\n- size\n- date\n\nAdd " asc" or " desc" for order:`, `${currentSort} ${currentOrder}`);
                
                if (newSort) {
                    const [sortBy, sortOrder = 'asc'] = newSort.split(' ');
                    STATE.settings.sortBy = sortBy;
                    STATE.settings.sortOrder = sortOrder;
                    localStorage.setItem('app_settings', JSON.stringify(STATE.settings));
                    
                    this.applySorting();
                    
                    if (STATE.viewMode === 'grid') {
                        this.renderGrid();
                    } else if (STATE.viewMode === 'list') {
                        this.renderList();
                    }
                    
                    UI.showToast(`Sorted by ${sortBy} (${sortOrder})`, 'success');
                }
            },
            
            async copyToVault() {
                if (!STATE.selectedFile) {
                    UI.showToast('Select a file first', 'warning');
                    return;
                }
                
                try {
                    await ProxyAPI.copyFile(STATE.selectedFile.id, CONFIG.vaultId);
                    UI.showToast('Copied to Vault', 'success');
                } catch (error) {
                    UI.showToast('Failed to copy', 'error');
                }
            },
            
            async moveToVault() {
                if (!STATE.selectedFile) {
                    UI.showToast('Select a file first', 'warning');
                    return;
                }
                
                try {
                    await ProxyAPI.moveFile(STATE.selectedFile.id, CONFIG.vaultId);
                    this.refresh();
                    UI.showToast('Moved to Vault', 'success');
                } catch (error) {
                    UI.showToast('Failed to move', 'error');
                }
            },
            
            async copyToDrive() {
                if (!STATE.selectedFile) {
                    UI.showToast('Select a file first', 'warning');
                    return;
                }
                
                try {
                    await ProxyAPI.copyFile(STATE.selectedFile.id, 'root');
                    UI.showToast('Copied to Drive', 'success');
                } catch (error) {
                    UI.showToast('Failed to copy', 'error');
                }
            },
            
            async moveToDrive() {
                if (!STATE.selectedFile) {
                    UI.showToast('Select a file first', 'warning');
                    return;
                }
                
                try {
                    await ProxyAPI.moveFile(STATE.selectedFile.id, 'root');
                    this.refresh();
                    UI.showToast('Moved to Drive', 'success');
                } catch (error) {
                    UI.showToast('Failed to move', 'error');
                }
            }
        };

        // ==================== UPLOAD SYSTEM ====================
        const Upload = {
            queue: [],
            currentUpload: null,
            canceled: false,
            
            openFilePicker() {
                document.getElementById('file-input').click();
            },
            
            openFolderPicker() {
                document.getElementById('folder-input').click();
            },
            
            async handleFiles(files) {
                if (!files.length) return;
                
                this.queue = Array.from(files);
                this.canceled = false;
                
                UI.toggleFab();
                this.showUploadBar();
                
                // For now, show mock upload progress
                // In a real implementation, you would upload to the proxy
                for (const file of this.queue) {
                    if (this.canceled) break;
                    
                    await this.mockUpload(file);
                }
                
                this.hideUploadBar();
                Drive.refresh();
                UI.showToast('Files uploaded successfully', 'success');
            },
            
            async mockUpload(file) {
                // Mock upload for demonstration
                // In production, implement actual upload via proxy
                return new Promise(resolve => {
                    let progress = 0;
                    const interval = setInterval(() => {
                        progress += 10;
                        this.updateProgress(file.name, progress, 
                            file.size * progress / 100, file.size, 1000000);
                        
                        if (progress >= 100) {
                            clearInterval(interval);
                            resolve();
                        }
                    }, 300);
                });
            },
            
            updateProgress(fileName, percent, loaded, total, speed) {
                const bar = document.getElementById('upload-bar');
                const nameEl = document.getElementById('upload-file-name');
                const percentEl = document.getElementById('upload-percent');
                const fillEl = document.getElementById('upload-progress-fill');
                
                nameEl.textContent = fileName;
                percentEl.textContent = `${percent}%`;
                fillEl.style.width = `${percent}%`;
                
                bar.classList.add('visible');
            },
            
            showUploadBar() {
                const bar = document.getElementById('upload-bar');
                bar.classList.add('visible');
            },
            
            hideUploadBar() {
                const bar = document.getElementById('upload-bar');
                bar.classList.remove('visible');
            },
            
            cancel() {
                this.canceled = true;
                this.queue = [];
                this.hideUploadBar();
                UI.showToast('Upload canceled', 'warning');
            }
        };

        // ==================== MEDIA PLAYER ====================
        const MediaPlayer = {
            currentMedia: null,
            videoElement: null,
            
            async preview(file) {
                STATE.selectedFile = file;
                
                const player = document.getElementById('media-player');
                const content = document.getElementById('media-content');
                const title = document.getElementById('media-title');
                const footer = document.getElementById('media-footer');
                
                title.textContent = file.name;
                content.innerHTML = '';
                
                try {
                    const previewData = await ProxyAPI.getMediaPreview(file.id);
                    
                    if (file.mimeType && file.mimeType.startsWith('image/')) {
                        this.showImage(file, content, previewData);
                        footer.style.display = 'none';
                    } else if (file.mimeType && file.mimeType.startsWith('video/')) {
                        this.showVideo(file, content, previewData);
                        footer.style.display = 'flex';
                    } else if (file.mimeType && file.mimeType.startsWith('audio/')) {
                        this.showAudio(file, content, previewData);
                        footer.style.display = 'flex';
                    } else {
                        this.showIframe(file, content, previewData);
                        footer.style.display = 'none';
                    }
                    
                    player.style.display = 'flex';
                    document.body.style.overflow = 'hidden';
                } catch (error) {
                    console.error('Preview error:', error);
                    this.showFallback(file, content);
                    player.style.display = 'flex';
                    document.body.style.overflow = 'hidden';
                }
            },
            
            showImage(file, container, previewData) {
                const img = document.createElement('img');
                img.className = 'media-img';
                img.src = previewData.preview?.url || `https://drive.google.com/thumbnail?id=${file.id}&sz=w1000`;
                img.alt = file.name;
                container.appendChild(img);
            },
            
            showVideo(file, container, previewData) {
                const video = document.createElement('video');
                video.className = 'media-video';
                video.controls = true;
                video.autoplay = true;
                
                const source = document.createElement('source');
                source.src = previewData.stream?.url || `https://www.googleapis.com/drive/v3/files/${file.id}?alt=media`;
                source.type = file.mimeType;
                
                video.appendChild(source);
                container.appendChild(video);
                
                this.videoElement = video;
                this.setupVideoControls();
            },
            
            showAudio(file, container, previewData) {
                const audio = document.createElement('audio');
                audio.controls = true;
                audio.autoplay = true;
                audio.style.width = '100%';
                
                const source = document.createElement('source');
                source.src = previewData.stream?.url || `https://www.googleapis.com/drive/v3/files/${file.id}?alt=media`;
                source.type = file.mimeType;
                
                audio.appendChild(source);
                container.appendChild(audio);
                
                this.videoElement = audio;
                this.setupVideoControls();
            },
            
            showIframe(file, container, previewData) {
                const iframe = document.createElement('iframe');
                iframe.style.width = '100%';
                iframe.style.height = '100%';
                iframe.style.border = 'none';
                iframe.src = previewData.preview?.url || `https://drive.google.com/file/d/${file.id}/preview`;
                container.appendChild(iframe);
            },
            
            showFallback(file, container) {
                const message = document.createElement('div');
                message.style.color = 'white';
                message.style.textAlign = 'center';
                message.style.padding = '40px';
                message.innerHTML = `
                    <h3>${file.name}</h3>
                    <p>Preview not available for this file type</p>
                    <button onclick="MediaPlayer.download()" style="padding: 10px 20px; margin-top: 20px; background: var(--primary); color: white; border: none; border-radius: 8px; cursor: pointer;">
                        Download File
                    </button>
                `;
                container.appendChild(message);
            },
            
            setupVideoControls() {
                if (!this.videoElement) return;
                
                const video = this.videoElement;
                const playBtn = document.getElementById('play-btn');
                const volumeBtn = document.getElementById('volume-btn');
                const progressBar = document.getElementById('progress-played');
                const timeDisplay = document.getElementById('time-display');
                
                video.addEventListener('play', () => {
                    playBtn.textContent = 'pause';
                });
                
                video.addEventListener('pause', () => {
                    playBtn.textContent = 'play_arrow';
                });
                
                video.addEventListener('timeupdate', () => {
                    const percent = (video.currentTime / video.duration) * 100;
                    progressBar.style.width = `${percent}%`;
                    
                    const current = this.formatTime(video.currentTime);
                    const total = this.formatTime(video.duration);
                    timeDisplay.textContent = `${current} / ${total}`;
                });
                
                video.addEventListener('volumechange', () => {
                    volumeBtn.textContent = video.muted ? 'volume_off' : 'volume_up';
                });
            },
            
            formatTime(seconds) {
                const mins = Math.floor(seconds / 60);
                const secs = Math.floor(seconds % 60);
                return `${mins}:${secs.toString().padStart(2, '0')}`;
            },
            
            togglePlay() {
                if (!this.videoElement) return;
                
                if (this.videoElement.paused) {
                    this.videoElement.play();
                } else {
                    this.videoElement.pause();
                }
            },
            
            toggleMute() {
                if (!this.videoElement) return;
                
                this.videoElement.muted = !this.videoElement.muted;
            },
            
            seek(event) {
                if (!this.videoElement) return;
                
                const bar = event.currentTarget;
                const rect = bar.getBoundingClientRect();
                const percent = (event.clientX - rect.left) / rect.width;
                
                this.videoElement.currentTime = percent * this.videoElement.duration;
            },
            
            download() {
                if (!STATE.selectedFile) return;
                
                if (STATE.settings.externalDownload) {
                    window.open(STATE.selectedFile.webContentLink || STATE.selectedFile.downloadUrl, '_blank');
                } else {
                    const link = document.createElement('a');
                    link.href = STATE.selectedFile.webContentLink || STATE.selectedFile.downloadUrl || 
                               `https://www.googleapis.com/drive/v3/files/${STATE.selectedFile.id}?alt=media`;
                    link.download = STATE.selectedFile.name;
                    link.click();
                }
            },
            
            share() {
                if (!STATE.selectedFile) return;
                
                const link = STATE.selectedFile.webViewLink || 
                           `https://drive.google.com/file/d/${STATE.selectedFile.id}/view`;
                navigator.clipboard.writeText(link)
                    .then(() => UI.showToast('Link copied to clipboard', 'success'))
                    .catch(() => UI.showToast('Failed to copy link', 'error'));
            },
            
            close() {
                const player = document.getElementById('media-player');
                player.style.display = 'none';
                document.body.style.overflow = '';
                
                if (this.videoElement) {
                    this.videoElement.pause();
                    this.videoElement = null;
                }
            }
        };

        // ==================== FILE ACTIONS ====================
        const FileActions = {
            showContextMenu(event, file) {
                STATE.selectedFile = file;
                
                const menu = document.getElementById('context-menu');
                menu.style.left = `${event.clientX}px`;
                menu.style.top = `${event.clientY}px`;
                menu.style.display = 'flex';
                
                setTimeout(() => {
                    document.addEventListener('click', () => {
                        menu.style.display = 'none';
                    }, { once: true });
                });
            },
            
            preview(file = STATE.selectedFile) {
                if (!file) return;
                MediaPlayer.preview(file);
            },
            
            download(fileId = STATE.selectedFile?.id) {
                if (!fileId) return;
                
                const file = STATE.files.find(f => f.id === fileId) || 
                            STATE.folders.find(f => f.id === fileId);
                
                if (!file) return;
                
                if (STATE.settings.externalDownload) {
                    window.open(file.webContentLink || file.downloadUrl, '_blank');
                } else {
                    const link = document.createElement('a');
                    link.href = file.webContentLink || file.downloadUrl || 
                               `https://www.googleapis.com/drive/v3/files/${fileId}?alt=media`;
                    link.download = file.name;
                    link.click();
                }
            },
            
            share(fileId = STATE.selectedFile?.id) {
                if (!fileId) return;
                
                const file = STATE.files.find(f => f.id === fileId) || 
                            STATE.folders.find(f => f.id === fileId);
                
                if (!file) return;
                
                const link = file.webViewLink || 
                           `https://drive.google.com/file/d/${fileId}/view`;
                navigator.clipboard.writeText(link)
                    .then(() => UI.showToast('Link copied to clipboard', 'success'))
                    .catch(() => UI.showToast('Failed to copy link', 'error'));
            },
            
            copyLink() {
                if (!STATE.selectedFile) return;
                
                const link = STATE.selectedFile.webViewLink || 
                           `https://drive.google.com/file/d/${STATE.selectedFile.id}/view`;
                navigator.clipboard.writeText(link)
                    .then(() => UI.showToast('Link copied to clipboard', 'success'))
                    .catch(() => UI.showToast('Failed to copy link', 'error'));
            },
            
            async rename() {
                if (!STATE.selectedFile) return;
                
                const newName = prompt('Enter new name:', STATE.selectedFile.name);
                if (!newName || newName === STATE.selectedFile.name) return;
                
                try {
                    await ProxyAPI.renameFile(STATE.selectedFile.id, newName);
                    
                    Drive.refresh();
                    UI.showToast('Renamed successfully', 'success');
                } catch (error) {
                    UI.showToast('Failed to rename', 'error');
                }
            },
            
            move() {
                const targetFolder = prompt('Enter target folder ID (leave empty for root):', 'root');
                if (targetFolder === null) return;
                
                if (!STATE.selectedFile) {
                    UI.showToast('Select a file first', 'warning');
                    return;
                }
                
                ProxyAPI.moveFile(STATE.selectedFile.id, targetFolder || 'root')
                    .then(() => {
                        Drive.refresh();
                        UI.showToast('Moved successfully', 'success');
                    })
                    .catch(() => UI.showToast('Failed to move', 'error'));
            },
            
            copy() {
                const targetFolder = prompt('Enter target folder ID (leave empty for root):', 'root');
                if (targetFolder === null) return;
                
                if (!STATE.selectedFile) {
                    UI.showToast('Select a file first', 'warning');
                    return;
                }
                
                ProxyAPI.copyFile(STATE.selectedFile.id, targetFolder || 'root')
                    .then(() => {
                        Drive.refresh();
                        UI.showToast('Copied successfully', 'success');
                    })
                    .catch(() => UI.showToast('Failed to copy', 'error'));
            },
            
            async delete() {
                if (!STATE.selectedFile) return;
                
                if (!confirm('Are you sure you want to delete this file?')) return;
                
                try {
                    const permanent = confirm('Permanently delete? (Cancel to move to trash)');
                    
                    await ProxyAPI.deleteFile(STATE.selectedFile.id, permanent);
                    
                    Drive.refresh();
                    UI.showToast(permanent ? 'Permanently deleted' : 'Moved to trash', 'success');
                } catch (error) {
                    UI.showToast('Failed to delete', 'error');
                }
            }
        };

        // ==================== UI CONTROLLER ====================
        const UI = {
            showScreen(screenId) {
                document.querySelectorAll('.app-container').forEach(el => {
                    el.classList.remove('active');
                });
                
                document.getElementById(screenId).classList.add('active');
            },
            
            showLoading() {
                const container = document.getElementById(STATE.viewMode === 'grid' ? 'file-grid' : 'file-list');
                container.innerHTML = `
                    <div class="loading">
                        <div class="loading-spinner"></div>
                        <div>Loading...</div>
                    </div>
                `;
            },
            
            hideLoading() {
                // Loading will be replaced by actual content
            },
            
            showToast(message, type = 'info') {
                const toast = document.createElement('div');
                toast.className = `toast toast-${type}`;
                toast.textContent = message;
                toast.style.cssText = `
                    position: fixed;
                    top: 20px;
                    right: 20px;
                    background: ${type === 'error' ? '#ea4335' : type === 'success' ? '#34a853' : '#1a73e8'};
                    color: white;
                    padding: 12px 20px;
                    border-radius: 8px;
                    box-shadow: 0 4px 12px rgba(0,0,0,0.15);
                    z-index: 9999;
                    animation: slideIn 0.3s ease;
                `;
                
                document.body.appendChild(toast);
                
                setTimeout(() => {
                    toast.style.animation = 'slideOut 0.3s ease';
                    setTimeout(() => toast.remove(), 300);
                }, 3000);
            },
            
            setView(view) {
                STATE.viewMode = view;
                
                document.querySelectorAll('.toolbar-actions .action-btn').forEach(btn => {
                    btn.classList.remove('active');
                });
                
                event.currentTarget.classList.add('active');
                
                const grid = document.getElementById('file-grid');
                const list = document.getElementById('file-list');
                
                if (view === 'grid') {
                    grid.classList.remove('hidden');
                    list.classList.add('hidden');
                    Drive.renderGrid();
                } else if (view === 'list') {
                    grid.classList.add('hidden');
                    list.classList.remove('hidden');
                    Drive.renderList();
                } else if (view === 'gallery') {
                    grid.classList.remove('hidden');
                    list.classList.add('hidden');
                    Drive.renderGallery();
                }
            },
            
            toggleFab() {
                const menu = document.getElementById('fab-menu');
                menu.style.display = menu.style.display === 'flex' ? 'none' : 'flex';
            },
            
            toggleSidebar() {
                const sidebar = document.getElementById('sidebar');
                sidebar.classList.add('active');
                sidebar.style.display = 'flex';
            },
            
            closeSidebar(event) {
                if (event && event.target.classList.contains('modal-backdrop')) {
                    const sidebar = document.getElementById('sidebar');
                    sidebar.classList.remove('active');
                    setTimeout(() => sidebar.style.display = 'none', 300);
                }
            }
        };

        // ==================== NAVIGATION ====================
        const Nav = {
            switch(tab) {
                document.querySelectorAll('.nav-item').forEach(item => {
                    item.classList.remove('active');
                });
                event.currentTarget.classList.add('active');
                
                STATE.currentView = tab;
                
                switch(tab) {
                    case 'home':
                        Drive.load('root');
                        break;
                    case 'photos':
                        UI.setView('gallery');
                        break;
                    case 'vault':
                        Drive.load(CONFIG.vaultId, 'Vault');
                        break;
                    case 'shared':
                        Drive.load('shared', 'Shared with me');
                        break;
                    case 'recent':
                        // Load recent files using modifiedTime filter
                        Drive.load('root');
                        UI.showToast('Showing recent files', 'info');
                        break;
                }
            }
        };

        // ==================== SETTINGS ====================
        const Settings = {
            open() {
                UI.toggleSidebar();
            },
            
            show() {
                alert('Full settings panel would open here');
            },
            
            toggleDarkMode() {
                const toggle = document.getElementById('dark-mode-toggle');
                STATE.settings.darkMode = toggle.checked;
                localStorage.setItem('app_settings', JSON.stringify(STATE.settings));
                
                if (toggle.checked) {
                    document.body.classList.add('dark-theme');
                } else {
                    document.body.classList.remove('dark-theme');
                }
            },
            
            toggleExternalDownload() {
                const toggle = document.getElementById('external-download-toggle');
                STATE.settings.externalDownload = toggle.checked;
                localStorage.setItem('app_settings', JSON.stringify(STATE.settings));
            }
        };

        // ==================== NOTIFICATIONS ====================
        const Notifications = {
            show() {
                alert('Notifications panel would open here');
            }
        };

        // ==================== INITIALIZATION ====================
        window.addEventListener('load', () => {
            setTimeout(() => {
                document.getElementById('splash-screen').style.display = 'none';
                
                if (!localStorage.getItem('app_pin')) {
                    const pin = prompt('Set a 4-digit PIN for security:');
                    if (pin && pin.length === 4 && /^\d+$/.test(pin)) {
                        localStorage.setItem('app_pin', btoa(pin));
                        Auth.check();
                    } else {
                        localStorage.setItem('app_pin', btoa('1234'));
                        Auth.check();
                    }
                } else {
                    UI.showScreen('lock-screen');
                }
                
                Auth.init();
                SetupDragAndDrop();
                SetupFileInputs();
                
            }, 2500);
        });

        // ==================== SETUP FUNCTIONS ====================
        function SetupDragAndDrop() {
            const dropZone = document.getElementById('drop-zone');
            const appScreen = document.getElementById('app-screen');
            
            ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
                appScreen.addEventListener(eventName, (e) => {
                    e.preventDefault();
                    e.stopPropagation();
                });
            });
            
            ['dragenter', 'dragover'].forEach(eventName => {
                appScreen.addEventListener(eventName, () => {
                    dropZone.classList.add('active');
                });
            });
            
            ['dragleave', 'drop'].forEach(eventName => {
                appScreen.addEventListener(eventName, () => {
                    dropZone.classList.remove('active');
                });
            });
            
            appScreen.addEventListener('drop', (e) => {
                const files = e.dataTransfer.files;
                if (files.length) {
                    Upload.handleFiles(files);
                }
            });
        }

        function SetupFileInputs() {
            const fileInput = document.getElementById('file-input');
            const folderInput = document.getElementById('folder-input');
            
            fileInput.addEventListener('change', (e) => {
                Upload.handleFiles(e.target.files);
                e.target.value = '';
            });
            
            folderInput.addEventListener('change', (e) => {
                Upload.handleFiles(e.target.files);
                e.target.value = '';
            });
        }

        // ==================== GLOBAL EVENT LISTENERS ====================
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') {
                const player = document.getElementById('media-player');
                if (player.style.display === 'flex') {
                    MediaPlayer.close();
                }
                
                const menu = document.getElementById('context-menu');
                if (menu.style.display === 'flex') {
                    menu.style.display = 'none';
                }
                
                const fab = document.getElementById('fab-menu');
                if (fab.style.display === 'flex') {
                    fab.style.display = 'none';
                }
            }
            
            if (document.getElementById('lock-screen').classList.contains('active')) {
                if (e.key >= '0' && e.key <= '9') {
                    Keypad.press(parseInt(e.key));
                } else if (e.key === 'Backspace') {
                    Keypad.backspace();
                } else if (e.key === 'Enter' && Keypad.pin.length === 4) {
                    Keypad.verify();
                }
            }
        });

        document.addEventListener('visibilitychange', () => {
            if (!document.hidden) {
                console.log('App in foreground');
            }
        });

        document.addEventListener('touchmove', (e) => {
            if (e.scale !== 1) {
                e.preventDefault();
            }
        }, { passive: false });

        window.addEventListener('popstate', () => {
            if (Drive.currentPath.length > 0) {
                const prev = Drive.currentPath.pop();
                Drive.load(prev.id, prev.name);
            } else {
                Drive.load('root');
            }
        });

    </script>
</body>
</html>
[file content end]